////
; Copyright (c) uib GmbH (www.uib.de)
; This documentation is owned by uib
; and published under the german creative commons by-sa license
; see:
; https://creativecommons.org/licenses/by-sa/3.0/de/
; https://creativecommons.org/licenses/by-sa/3.0/de/legalcode
; english:
; https://creativecommons.org/licenses/by-sa/3.0/
; https://creativecommons.org/licenses/by-sa/3.0/legalcode
;
; credits: https://www.opsi.org/credits/
////

:Author:    uib GmbH
:Email:     info@uib.de
:Date:      08.01.2024
:Revision:  4.3
:toclevels: 6
:doctype:   book
:icons:     font
:xrefstyle: full

include::common:partial$opsi_terms.adoc[]

The `opsi-admin` command line tool allows you to interact with the opsi API. It offers both an interactive mode (`-i`) and a non-interactive mode, suitable for scripting purposes.

NOTE: Please also refer to the section on <<server-components-opsi-cli>> regarding `opsi-cli`. This tool is newer, more robust, and versatile, providing functionalities similar to `opsi-admin`. Since version 4.2.0.187, `opsi-cli` has been included in the `opsi-utils` package and is available on Linux, Windows, and macOS.

When using `opsi-admin` to access the opsi API, specify the service URL (`--address`), a username (`--username`), and the corresponding password (`--password`). If you don't provide a service URL, `opsi-admin` defaults to the one specified in `/etc/opsi/opsi.conf`. If the username and password are not included in the command, authentication will occur using the host ID and the cost key from `/etc/opsi/opsi.conf`.

TIP: You can store the access data in a personal configuration file (see section <<server-components-opsi-admin-opsirc>>).

.Call `opsi-admin -i` to start the tool in interactive mode.
image::opsi-admin-start.png["Call `opsi-admin -i` to start the tool in interactive mode.", pdfwidth=80%]

If you also specify the parameter `-c` at the start, you will receive a colored display; the complete command is then `opsi-admin -ic`. In interactive mode, you can press the [Tab] key to automatically complete commands. There is also a history that saves commands that have already been typed. You can use the arrow keys to scroll through the history. 

The two switches `-s` (shell output) and `-S` (simple output) generate an output that can be easily processed in scripts.

Use the command `method <methodname>` to execute RPC methods of the API. The command `task <taskname>` is suitable for more complex administration tasks. Further examples of the use of `opsi-admin` can be found in the section <<server-components-opsi-admin-examples>>.

[[server-components-opsi-admin-opsirc]]
=== Configuration file

You can store the access data for the opsi web service in a configuration file. This makes it possible to start a connection without having to enter the username and password on the command line.

The file is called `opsirc` and is located in the hidden folder `~/.opsi.org` in the user's home directory. It has the following structure:

[source,toml]
----
address = https://<opsi-server>:4447/rpc
username = <opsi-user>
password = <secret>
----

All information in the file is optional. If the file is empty or does not exist, `opsi-admin` uses the default settings described above.

TIP: You can use the `--opsirc` parameter to specify the path to another configuration file when calling. This allows you to prepare and use several differently configured connections.

[[server-components-opsi-admin-examples]]
=== Examples

Below we list a few examples of the use of `opsi-admin`:

* Set a product to `setup` for all clients that have the product installed: + 
[source,console]
----
opsi-admin task setupWhereInstalled <product-id>
----
* Output a simple list of the IDs of all opsi clients: +
[source,console]
----
opsi-admin -S method host_getIdents str '{"type":"OpsiClient"}'
----
* Delete an opsi client: +
[source,console]
----
opsi-admin method host_delete <client-id>
----
* Create or overwrite an opsi client (`opsi-admin ... <client-id> <opsi-host-key> <description>`): +
[source,console]
----
opsi-admin method host_createOpsiClient client1.opsi.internal null "Test client 1"
----
* Send action request to a product (`opsi-admin ... <product-id> <client-id> <action-request>`): +
[source,console]
----
opsi-admin -d method setProductActionRequest opsi-client-agent client1.opsi.internal setup
----
* List the products installed on clients: +
[source,console]
----
opsi-admin method productOnClient_getObjects [] '{"installationStatus": "installed"}'
----


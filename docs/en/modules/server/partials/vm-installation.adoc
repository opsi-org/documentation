////
; Copyright (c) uib GmbH (www.uib.de)
; This documentation is owned by uib
; and published under the german creative commons by-sa license
; see:
; https://creativecommons.org/licenses/by-sa/3.0/de/
; https://creativecommons.org/licenses/by-sa/3.0/de/legalcode
; english:
; https://creativecommons.org/licenses/by-sa/3.0/
; https://creativecommons.org/licenses/by-sa/3.0/legalcode
;
; credits: https://www.opsi.org/credits/
////

:Author:    uib GmbH
:Email:     info@uib.de
:Date:      14.12.2023
:Revision:  4.3
:toclevels: 6
:doctype:   book
:icons:     font
:xrefstyle: full

[[server-installation-base-vm]]
= Preconfigured virtual machine

We have prepared a virtual machine available for link:https://tools.43.opsi.org/{release}/opsi43-vm.zip[download]. You can operate this virtual machine using link:https://www.virtualbox.org/[VirtualBox], link:https://www.vmware.com/de/products/workstation-player.html[VMware Workstation Player], or link:https://www.vmware.com/de/products/esxi-and-esx.html[VMware ESXi].

[[server-installation-base-vm-start]]
== Download and Import

After downloading the virtual machine, unzip the file. Inside the unzipped folder, you will find three files: `opsi[...].vmdk`, `opsi[...].mf`, and `opsi[...].ovf` in the current directory.

To import the virtual machine, follow these steps:

*VMware Workstation Player*

. Select the menu item _Open a Virtual Machine_ and navigate in the file selection dialogue to the directory with the files from the zip file you have just unpacked.

. Select the menu option _Open a Virtual Machine_ and, in the file selection dialog, navigate to the directory containing the files from the recently unzipped zip file.
. Select the file with the `.ovf` extension. (If necessary, change the file type to `Virtual Machines (\*vmx, \*.ovf, \*.ova)` at the bottom of the dialog).
. Upon clicking _Open_, you can assign a name to the machine and select its storage location.
. Click _Import_ to finalize the process.
. You can now start the new VM by selecting _Power On_.

.VMware Workstation Player: Importing the Virtual Machine
image::opsiconfd/opsi-vm-vmware-import.png["VMware Workstation Player: Importing the Virtual Machine", pdfwidth=80%]

*ESXi Server*

. Start the vSphere Client.
. Create a new machine via _File_ / _Deploy OVF Template_, and then navigate to the `.ovf` file.
. Click _Open_, followed by  _Next_.
. Enter a name for the machine or accept the default setting.
. Click on _Next_ to review all settings. Click on _Finish_ to initiate the import.

*VirtualBox*

. Go to _File_ / _Import Appliance_ in the menu.
. In the file selection dialog, navigate to the `.ovf` file and click _Open_.
. After clicking _Next_, you can adjust the settings in the subsequent dialog, such as changing the name, modifying the size of the working memory, etc.
. Click on _Import_ to complete the process.

.VirtualBox: Importing the Virtual Machine
image::opsiconfd/opsi-vm-import-en.png["VirtualBox: Importing the Virtual Machine", width=800, pdfwidth=80%]

[[server-installation-base-vm-lang]]
== Booting and Language Selection

Boot the new virtual machine. In the initial dialog, you will select the language for the new opsi server. Use [Tab] to navigate to your desired language and press the space bar to select it. Then, press [Tab] again to move to the _Ok_ option, and press [Enter] to confirm your selection.

.Select the language for your new opsi server.
image::1stboot-language-selection.png["Select the language for your new opsi server.", pdfwidth=80%]

You will then see a message indicating that the installation program is adjusting the network settings of the opsi server. Confirm this step by pressing [Enter].

TIP: Depending on your environment and virtualization software, system messages might appear in the window, potentially making the installation script dialogs unreadable. In such cases, use the key combination [Ctrl]{plus}[L] to refresh and reset the display.

[[server-installation-base-vm-1stboot]]
== First boot: the script `1stboot.py`


The script `1stboot.py`, which starts automatically when the appliance is booted for the first time, supports you in configuring the network. You can call the script at any time later via `/usr/local/bin/1stboot.py` on the command line and adjust the settings. The `1stboot.py` log file can be found at `/var/lib/1stboot/1stboot.log`.

CAUTION: The script `1stboot.py` is not suitable for renaming a configured opsi server afterwards!

The script `1stboot.py` supports you with the network configuration.

image::1st-startup-mask.png["The script `1stboot.py` supports you with the network configuration.", pdfwidth=80%]

The script asks for the following information:

Server name:: Name of this opsi server (without domain), e.{nbsp}B. `opsiserver` or `opsidepot`.

Domain:: DNS domain (not Windows domain, must contain a dot), e.{nbsp}B. `mycompany.internal`.

IP address:: Address of this server, e.g. `192.168.1.50`.

Netmask:: Netmask of this server, e.g.{nbsp}B. `255.255.255.0`

Windows Workgroup/Domain:: Name of the Windows domain (not DNS domain), e.g. `OPSI`.

Gateway:: IP address of the gateway, e.g. `192.168.1.1`.

Proxy:: Address and port of the proxy server (if required), e.g. `http://myuser:mypass@192.168.1.5:8080`.

DNS:: IP address of the name server, e.g. `192.168.1.1`.

Mail-Relay:: IP address of the mail server, e.g. `192.168.1.1`.

TFTP-Server:: Normally this is the IP address of the opsi server (default).

Password for root:: The password for the local administrator user; enter the password twice to avoid possible typing errors.

Password for adminuser:: The password for the local opsi administrator; enter this password twice as well.

Then restart the virtual machine.

[[server-installation-base-vm-second-start]]
== Second start: Login and update

After the restart, log in to the graphical work environment with the user name 'adminuser' and the password you set up during the installation. The virtual machine contains three slim desktop environments which you select via the _session_ menu at the top.

After logging in, the browser starts Firefox and opens a page with further links to the manual, our forum (community support), the opsi wiki and the professional uib support.

.the graphical working environment on the opsi server

image::opsiconfd/opsi-vm-welcome-en.png["The graphical working environment on the opsi server", pdfwidth=80%]

NOTE: If the message appears that no network connection is available, this may be related to the particular configuration of the virtual appliance. Before checking for errors, it is best to restart the server once. To do this, either click on the shutdown button in the start menu or enter the command `reboot` in a terminal window.

Now bring the packages of the underlying Linux system up to date. To do this, you can use the _Update OS_ icon on the desktop background. After double-clicking on the icon, a password prompt appears; enter the password of the user `adminuser`.

Since the virtual machine is based on Ubuntu, you can alternatively update the packages via `apt`.
To do this, open a terminal and execute the following commands:

[source,console]
----
sudo apt update
sudo apt --yes --auto-remove upgrade
----

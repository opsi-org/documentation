////
; Copyright (c) uib GmbH (www.uib.de)
; This documentation is owned by uib
; and published under the german creative commons by-sa license
; see:
; https://creativecommons.org/licenses/by-sa/3.0/de/
; https://creativecommons.org/licenses/by-sa/3.0/de/legalcode
; english:
; https://creativecommons.org/licenses/by-sa/3.0/
; https://creativecommons.org/licenses/by-sa/3.0/legalcode
;
; credits: https://www.opsi.org/credits/
////

:Author:    uib GmbH
:Email:     info@uib.de
:Date:      24.05.2023
:Revision:  4.3
:toclevels: 6
:doctype:   book
:icons:     font
:xrefstyle: full
[[server-installation-base-vm]]
= Preconfigured virtual machine

We have set up a virtual machine that we offer for link:https://tools.43.opsi.org/testing/opsi43-vm.zip[download].
You can run the virtual machine under link:https://www.virtualbox.org/[VirtualBox], link:https://www.vmware.com/de/products/workstation-player.html[VMware Workstation Player] or link:https://www.vmware.com/de/products/esxi-and-esx.html[VMware ESXi].

[[server-installation-base-vm-start]]
== Download and import VM

Download the virtual machine and unzip the zip file.
You will then find the three files `opsi[...].vmdk`, `opsi[...].mf` and `opsi[...].ovf` in the current directory.

To import the virtual machine:

*VMware Workstation Player*

. Select the menu item _Open a Virtual Machine_ and navigate in the file selection dialogue to the directory with the files from the zip file you have just unpacked.
. Select the file with the extension `.ovf`. (If necessary, change the type at the bottom of the dialogue to `Virtual Machines (\*vmx, \*.ovf, \*.ova)`).
. After clicking on _Open_ you can give the machine a name and select the location.
. Finally, click on _Import_.
. You can now start the new VM via _Power On_.

.VMware Workstation Player: Import der virtuellen Maschine

image::opsiconfd/opsi-vm-vmware-import.png["VMware Workstation Player: Import der virtuellen Maschine", pdfwidth=80%]

*ESXi Server*

. Start the vSphere Client.
. Create a new machine via _File_ / _Provide _OVF Template_ and then navigate to the `.ovf` file.
. Click _Open_ and then _Next_.
. Enter a name or accept the default.
. Click on _Next_ to get an overview of all settings. Click on _Exit_ to start the import.

*VirtualBox*

. Select _File_ / _Import Appliance_ from the menu.
. In the file selection dialogue, navigate to the `.ovf` file and click on _Open_.
. After clicking on _Next_, you can edit the settings in the following dialogue and change, for example, the name, the size of the working memory, etc. .
. Finally, click on _Import_.

VirtualBox: Importing the virtual machine

image::opsiconfd/opsi-vm-import-en.png["VirtualBox: Importing the virtual machine", pdfwidth=80%]

[[server-installation-base-vm-lang]]
== Boot VM and select language

Boot the new virtual machine. In the first dialogue select the language of the new opsi server. Navigate to the desired entry with [Tab] and press the space bar to highlight it. Then press [Tab] again until you reach _Ok_ and press [Enter].

Select the language for your new opsi server.

image::1stboot-language-selection.png["Select the language for your new opsi server.", pdfwidth=80%]

You will now see a message that the installation programme adjusts the network settings of the opsi server. Confirm this with [Enter].

TIP: Depending on the environment and virtualisation software, system messages may appear in the window and the installation script dialogues may become unreadable. Reset the display with the key combination [Ctrl]+[L].

[[server-installation-base-vm-1stboot]]
== First boot: the script `1stboot.py`

The script `1stboot.py`, which starts automatically when the appliance is booted for the first time, supports you in configuring the network. You can call the script at any time later via `/usr/local/bin/1stboot.py` on the command line and adjust the settings. The `1stboot.py` log file can be found at `/var/lib/1stboot/1stboot.log`.

WARNING: The script `1stboot.py` is not suitable for renaming a configured opsi server afterwards!

The script `1stboot.py` supports you with the network configuration.

image::1st-startup-mask.png["The script `1stboot.py` supports you with the network configuration.", pdfwidth=80%]

The script asks for the following information:

Server name:: Name of this opsi server (without domain), e.{nbsp}B. `opsiserver` or `opsidepot`.

Domain:: DNS domain (not Windows domain, must contain a dot), e.{nbsp}B. `mycompany.internal`.

IP address:: Address of this server, e.g. `192.168.1.50`.

Netmask:: Netmask of this server, e.g.{nbsp}B. `255.255.255.0`

Windows Workgroup/Domain:: Name of the Windows domain (not DNS domain), e.g. `OPSI`.

Gateway:: IP address of the gateway, e.g. `192.168.1.1`.

Proxy:: Address and port of the proxy server (if required), e.g. `http://myuser:mypass@192.168.1.5:8080`.

DNS:: IP address of the name server, e.g. `192.168.1.1`.

Mail-Relay:: IP address of the mail server, e.g. `192.168.1.1`.

TFTP-Server:: Normally this is the IP address of the opsi server (default).

Password for root:: The password for the local administrator user; enter the password twice to avoid possible typing errors.

Password for adminuser:: The password for the local opsi administrator; enter this password twice as well.

Then restart the virtual machine.

[[server-installation-base-vm-second-start]]
== Second start: Login and update

After the restart, log in to the graphical work environment with the user name 'adminuser' and the password you set up during the installation. The virtual machine contains three slim desktop environments which you select via the _session_ menu at the top.

After logging in, the browser starts Firefox and opens a page with further links to the manual, our forum (community support), the opsi wiki and the professional uib support.

.the graphical working environment on the opsi server

image::opsiconfd/opsi-vm-welcome-en.png["The graphical working environment on the opsi server", pdfwidth=80%]

NOTE: If the message appears that no network connection is available, this may be related to the particular configuration of the virtual appliance. Before checking for errors, it is best to restart the server once. To do this, either click on the shutdown button in the start menu or enter the command `reboot` in a terminal window.

Now bring the packages of the underlying Linux system up to date. To do this, you can use the _Update OS_ icon on the desktop background. After double-clicking on the icon, a password prompt appears; enter the password of the user `adminuser`.

Since the virtual machine is based on Ubuntu, you can alternatively update the packages via `apt`.
To do this, open a terminal and execute the following commands:

[source,console]
----
sudo apt update
sudo apt --yes --auto-remove upgrade
----
////
; Copyright (c) uib gmbh (www.uib.de)
; This documentation is owned by uib
; and published under the german creative commons by-sa license
; see:
; https://creativecommons.org/licenses/by-sa/3.0/de/
; https://creativecommons.org/licenses/by-sa/3.0/de/legalcode
; english:
; https://creativecommons.org/licenses/by-sa/3.0/
; https://creativecommons.org/licenses/by-sa/3.0/legalcode
;
; credits: https://www.opsi.org/credits/
////
[[server-installation-base-vm]]
== Inbetriebnahme der vorkonfigurierten virtuellen Maschine

Der {opsi-server} kann problemlos als Virtuelle Maschine installiert und betieben werden. Wir haben zu diesem Zweck eine VM eingerichtet, die wir auf unserer link:https://uib.de/de/opsi/opsi-testen-download/[Website] zum Download anbieten.

Sie können die virtuelle Maschine unter link:https://www.virtualbox.org/[VirtualBox], link:https://www.vmware.com/de/products/workstation-player.html[VMware Workstation Player] oder link:https://www.vmware.com/de/products/esxi-and-esx.html[VMware ESXi] betreiben.

[[server-installation-base-vm-start]]
=== VM herunterladen und importieren

Laden Sie die virtuelle Maschine herunter und entpacken Sie die Zip-Datei. In den meisten grafischen Arbeitsumgebungen gelingt das im jeweiligen Dateimanager mit einem Rechtsklick und _Hier entpacken_ o.{nbsp}Ä. Alternativ verwenden Sie ein Programm wie link:https://www.7-zip.de/[7-Zip] (Windows) oder das Kommando `unzip` unter Linux auf der Shell. Anschließend finden Sie die drei Dateien `opsi[...].vmdk`, `opsi[...].mf` und `opsi[...].ovf` im aktuellen Verzeichnis.

So importieren Sie die virtuelle Maschine:

*VMware Workstation Player*

* Wählen Sie den Menüpunkt _Open a Virtual Maschine_ und navigieren Sie im Dateiauswahldialog ins Verzeichnis mit den Dateien aus dem gerade entpackten Zip-File.
* Wählen Sie die Datei mit der Endung `.ovf` aus. (Ggf. ändern Sie am unteren Rand des Dialogs den Typ auf _Virtual Machines (*vmx, *.ovf, *.ova)_).
* Nach einem Klick auf _Öffnen_ können Sie der Maschine einen Namen geben und den Ort auswählen.
* Klicken Sie abschließend auf _Import_.
* Sie können die neue VM nun über _Power On_ starten.

.VMware Workstation Player: Import der virtuellen Maschine
image::vmware-player-import.png["VMware Workstation Player: Import der virtuellen Maschine", pdfwidth=80%]

*ESXi-Server*

* Starten Sie den vSphere Client.
* Erstellen Sie einen neuen Rechner über _Datei_ / _OVF-Vorlage bereitstellen_ und navigieren dann zur `.ovf`-Datei.
* Klicken Sie auf _Öffnen_ und dann _Weiter_.
* Geben Sie einen Namen ein oder übernehmen Sie die Voreinstellung.
* Klicken Sie auf _Weiter_, um eine Übersicht aller Einstellungen zu erhalten. Über die Schaltfläche _Beenden_ starten Sie den Import.

*VirtualBox*

* Wählen Sie _Datei_ / _Appliance importieren_ aus dem Menü.
* Navigieren Sie im Dateiauswahldialog zur `.ovf`-Datei und klicken _Öffnen_.
* Nach einem Klick auf _Weiter_ können Sie im folgenden Dialog die Einstellungen bearbeiten und beispielsweise den Namen, die Größe des Arbeitsspeichers usw. verändern.
* Klicken Sie abschließend auf _Importieren_.

.VirtualBox: Import der virtuellen Maschine
image::virtualbox-import.png["VirtualBox: Import der virtuellen Maschine", pdfwidth=80%]

[[server-installation-base-vm-lang]]
=== VM booten und Sprache wählen

Booten Sie die neue virtuelle Maschine. Im ersten Dialog wählen Sie die Sprache des neuen {opsi-server}s aus. Navigieren Sie mit [Tab] zum gewünschten Eintrag und drücken die Leertaste, um ihn zu markieren. Anschließend betätigen Sie wieder [Tab], bis Sie _Ok_ erreichen und drücken [Eingabe].

.Wählen Sie die Sprache für Ihren neuen {opsi-server} aus.
image::1stboot-language-selection.png["Wählen Sie die Sprache für Ihren neuen {opsi-server} aus.", pdfwidth=80%]

Sie sehen nun die Meldung, dass das Installationsprogramm die Netzwerkeinstellungen des {opsi-server}s anpasst. Bestätigen Sie das mit [Eingabe].

TIP: Je nach Umgebung und Virtualisierungs-Software kann es vorkommen, dass Systemmeldungen im Fenster auftauchen und die Dialoge des Installationsskripts unlesbar werden. Mit der Tastenkombination [Strg]+[L] setzen Sie die Anzeige zurück.

[[server-installation-base-vm-1stboot]]
===  Erster Start: das Skript `1stboot.py`

Das Skript `1stboot.py`, das beim ersten Booten der Appliance automatisch startet, unterstützt Sie bei der Konfiguration des Netzwerks. Sie können das Skript jederzeit zu einem späteren Zeitpunkt über `/usr/local/bin/1stboot.py` auf der Kommandozeile aufrufen und die Einstellungen anpassen. Die Logdatei von `1stboot.py` ist `/var/lib/1stboot/1stboot.log`.

WARNING: `1stboot.py` eignet sich nicht, um einen konfigurierten {opsi-server} nachträglich umzubenennen!

.Das Skript `1stboot.py` unterstützt Sie bei der Netzwerkkonfiguration.
image::1st-startup-mask.png["Das Skript `1stboot.py` unterstützt Sie bei der Netzwerkkonfiguration.", pdfwidth=80%]

Das Skript erfragt die folgenden Informationen:

Servername:: Name diese {opsi-server}s (ohne Domain), z.{nbsp}B. `opsiserver` oder `opsidepot`

Domain:: DNS-Domain (nicht Windows-Domäne, muss einen Punkt enthalten), z.{nbsp}B. `opsi.local` oder `meinefirma.local`

IP-Adresse:: Adresse dieses Servers, z.{nbsp}B. `192.168.1.50`

Netzmaske:: Netzmaske dieses Servers, z.{nbsp}B. `255.255.255.0`

Windows Workgroup/Domain:: Name der Windows-Domäne (nicht DNS-Domain), z.{nbsp}B. `OPSI`

Gateway:: IP-Adresse des Gateways, z.{nbsp}B. `192.168.1.1`

Proxy::	Adresse und Port des Proxy-Servers (falls erforderlich), z.{nbsp}B. `\http://myuser:mypass@192.168.1.5:8080`

DNS:: IP-Adresse des Nameservers, z.{nbsp}B. `192.168.1.1`

Mail-Relay:: IP-Adresse des Mailservers, z.{nbsp}B. `192.168.1.1`

TFTP-Server:: Normalerweise ist das die IP-Adresse des {opsi-server}s (Voreinstellung).

Passwort für root:: Das Passwort für den lokalen Administrator-Benutzer; das Kennwort geben Sie zweimal ein, um eventuelle Vertipper auszuschließen.

Passwort für adminuser:: Das Passwort für den lokalen opsi-Administrator; auch dieses Kennwort geben Sie zweimal ein.

Starten Sie die virtuelle Maschine anschließend neu.

[[server-installation-base-vm-second-start]]
=== Zweiter Start: Login und Update

Nach dem Neustart melden Sie sich mit dem Benutzernamen `adminuser` und dem bei der Installation eingerichteten Kennwort an der grafischen Arbeitsumgebung an. Die virtuelle Maschine enthält drei schlanke Desktopumgebungen, die Sie über das Menü _Sitzung_ am oberen Rand auswählen.

Nach dem Einloggen startet der Browser Firefox und öffnet eine Seite mit weiterführenden Links zum Handbuch, zu unserem Forum (Community-Support), zum opsi-Wiki und zum professionellen uib-Support.

.Die grafische Arbeitsumgebung auf dem {opsi-server}
image::opsiserver_start_gui.png["Die grafische Arbeitsumgebung auf dem opsi-Server", pdfwidth=80%]

NOTE: Wenn die Meldung erscheint, dass keine Netzwerkverbindung verfügbar ist, kann das mit der besonderen Konfiguration der virtuellen Appliance zusammenhängen. Bevor Sie nach Fehlern suchen, starten Sie den Server am besten einmal neu. Dazu klicken Sie entweder auf den Ausschaltknopf im Startmenü oder geben das Kommando `reboot` in ein Terminalfenster ein.

[[server-installation-preconfigured-vm-second-start-update]]
==== {opsi-server} aktualisieren

Bringen Sie jetzt die Pakete des zugrundeliegenden Linux-Systems auf den aktuellen Stand.

Verwenden Sie hierzu das Symbol _Update OS_ auf dem Desktophintergrund.
Nach einem Doppelklick auf das Symbol geben erscheint eine Passwort-Abfrage.
Geben Sie hier das Kennwort des Benutzers `adminuser` ein.


Da die VM auf Ubuntu basiert, könne Sie die Paket alternativ über `apt` aktualisieren.
Dazu öffnen Sie ein Terminal und führen die folgenden Befehl aus:

[source,prompt]
----
sudo apt update
sudo apt --yes --auto-remove upgrade
----

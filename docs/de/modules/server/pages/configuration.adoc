////
; Copyright (c) uib gmbh (www.uib.de)
; This documentation is owned by uib
; and published under the german creative commons by-sa license
; see:
; https://creativecommons.org/licenses/by-sa/3.0/de/
; https://creativecommons.org/licenses/by-sa/3.0/de/legalcode
; english:
; https://creativecommons.org/licenses/by-sa/3.0/
; https://creativecommons.org/licenses/by-sa/3.0/legalcode
;
; credits: https://www.opsi.org/credits/
////

:Author:    uib gmbh
:Email:     info@uib.de
:Date:      02.05.2023
:Revision:  4.2
:toclevels: 6
:doctype:   book
:icons: font
:xrefstyle: full

include::common:partial$opsi_terms.adoc[]

[[opsi-getting-started-installation-config]]
= Konfiguration

Dieses Kapitel erklärt zuerst, wie Sie einen frisch installierten {opsi-server} aktualisieren und dann die Standard-Produkte einspielen. Danach geht es um die Backend- und die Samba-Konfiguration des {opsi-server}s, um Benutzer und Gruppen zur Administration, die DHCP-Konfiguration und die Namensauflösung.

NOTE: Falls Sie einen Proxy-Server zum Zugriff auf das Internet verwenden, konfigurieren Sie diesen über die Umgebungsvariablen `http_proxy` und `https_proxy` (siehe Kapitel xref:server:requirements.adoc[Voraussetzungen]).

[[opsi-getting-started-installation-config-update-opsi-product]]
== Standard-Produkte einspielen

Nach der Installation des {opsi-server}s und der Aktualisierung des zugrundeliegenden Linux-Systems spielen Sie die opsi-Standard-Produkte ein. Dazu geben Sie den folgenden Befehl in ein Terminalfenster ein:

[source,shell]
----
sudo opsi-package-updater -v install
----

Auf Aufforderung geben Sie das Passwort für den Benutzer `adminuser` ein.

Das Kommando aktualisiert alle vorhandenen opsi-Pakete inklusive der Templates für Betriebssystem-Installationen aus den opsi-Repositorys.

.Innstallieren Sie die Standard-Produkte auf Ihrem opsi-Server.
image::opsi-package-updater.png["Installieren Sie die Standard-Produkte auf Ihrem opsi-Server.", pdfwidth=80%]

TIP: Auf unserer vorkonfigurierten virtuellen Maschine können Sie alternativ das Desktop-Icon _First package installation_ doppelklicken, um die Standard-Produkte zu installieren.

[[opsi-getting-started-installation-config-update-start-configed]]
== Management-Oberfläche starten

Die Management-Oberfläche `opsi-configed` starten Sie in der virtuellen Maschine über einen Doppelklick auf das Desktopsymbol _Opsi Configuration Editor_. Weitere Informationen zu dieser grafischen Anwendung finden Sie in xref:configed:configed.adoc[Management-Oberfläche `opsi-configed`].

[[opsi-getting-started-installation-configure-mysql]]
== MySQL konfigurieren

Läuft der MySQL-Service auf der gleichen Maschine wie der opsiconfd, findet die Konfiguration des MySQL-Server in der Regel vollautomatisch statt. Falls notwendig, kann eine manuelle Konfiguration jederzeit durch den Aufruf des folgenden Befehls vorgenommen werden:

[source,shell]
----
opsiconfd setup --configure-mysql
----

Das Programm führt Sie dann interaktiv durch die Einrichtung.



[[opsi-getting-started-installation-config-dhcp-backend]]
=== Backend anpassen

Je nachdem, ob Sie den DHCP-Server auf dem {opsi-server} oder als externen Dienst verwenden, sieht die Backend-Konfiguration anders aus. In der Datei `/etc/opsi/backendManager/dispatch.conf` legen Sie fest, welche opsi-Backends zum Einsatz kommen.

Die beiden Zeilen `backend_.*` und `host_.*` steuern, ob der {opsi-server} auch die lokale DHCP-Konfiguration, also die Zuweisung von IP-Adressen zu den MAC-Adressen der Netzwerkkarten, übernimmt. Das ist dann notwendig, wenn die DHCP-Einträge der opsi-Clients durch die opsi-Konfigurations-Aufrufe erzeugt werden sollen. In dem Fall sehen die beiden Zeilen in der Datei `dispatch.conf` so aus:

[source,configfile]
----
backend_.*         : file, opsipxeconfd, dhcpd
host_.*            : file, opsipxeconfd, dhcpd
----

Stellt der {opsi-server} den DHCP-Dienst nicht bereit (weil ein anderer Server im lokalen Netz diese Aufgabe übernimmt), dann benötigen Sie das Backend `dhcpd` nicht:

[source,configfile]
----
backend_.*         : file, {opsipxeconfd}
host_.*            : file, {opsipxeconfd}
----

NOTE: Wenn Sie die Datei `dispatch.conf` bearbeitet haben, führen Sie anschließend die folgenden Befehle aus, um die Konfiguration zu initialisieren und opsi neu zu starten:

[source,shell]
----
opsi-setup --init-current-config
opsi-set-rights
systemctl restart opsiconfd.service
systemctl restart opsipxeconfd.service
----

[[opsi-getting-started-installation-config-nameresolution]]
== Namensauflösung

Um Software auf den opsi-Clients vor dem Login installieren zu können, müssen nur die Clients wissen, wie sie den {opsi-server} erreichen.

NOTE: opsi kennt inzwischen eine Reihe von Push-Funktionalitäten, wie z.{nbsp}B. On-Demand-Installationen, Nachrichten versenden, Remote-Control-Software starten, Session-Informationen abrufen usw.

Für all diese Funktionen muss der Server die Clients erreichen können und dazu deren IP-Adresse ermitteln. Im Netzwerk müssen daher DHCP und DNS entsprechend konfiguriert sein. Dazu gibt es mehrere Möglichkeiten -- zwei typische Szenarien sind diese:

. Die Clients sind nicht im DNS und haben dynamisch zugewiesene, wechselnde IP-Adressen.

. Die IP-Adressen aller laufenden Clients sind stets bekannt und lassen sich per DNS abfragen.

Um den {opsi-server} nun an die unterschiedlichen Gegebenheiten anzupassen, gibt es zwei Konfigurationsdateien, die Sie ändern können:

* `/etc/opsi/backends/hostcontrol.conf`: +
Setzen Sie `resolveHostAddress` auf `True`, dann wird beim Verbindungsaufbau vom {opsi-server} zum opsi-Client die IP-Adresse des Clients bevorzugt über die Namensauflösung ermittelt. Um die im Backend von opsi hinterlegte IP-Adresse zu bevorzugen, setzen Sie die Option hingegen auf `False`.

* `/etc/opsi/opsiconfd.conf`: +
Steht die Option `update-ip` auf `true` (Standard), dann wird die IP-Datenbank des {opsi-server}s immer aktualisiert, wenn der {opsi-server} von einem Client eine IP-Adresse empfängt, z.{nbsp}B. bei jeder Kontaktaufnahme.

Für die oben aufgeführte Variante 1 ist es sinnvoll `resolveHostAddress` auf `False` und `update-ip` auf `true` zu setzen.

Für die oben aufgeführte Variante 2 ist es besser, `resolveHostAddress` auf `True` zu setzen und `update-ip` auf `false`.

Wenn Sie an diesen Konfigurationsdateien etwas geändert haben, dann starten Sie den `opsiconfd` neu:

[source,shell]
----
systemctl restart opsiconfd.service
----

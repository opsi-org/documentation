////
; Copyright (c) uib GmbH (www.uib.de)
; This documentation is owned by uib
; and published under the german creative commons by-sa license
; see:
; https://creativecommons.org/licenses/by-sa/3.0/de/
; https://creativecommons.org/licenses/by-sa/3.0/de/legalcode
; english:
; https://creativecommons.org/licenses/by-sa/3.0/
; https://creativecommons.org/licenses/by-sa/3.0/legalcode
;
; credits: https://www.opsi.org/credits/
////

:Author:    uib GmbH
:Email:     info@uib.de
:Date:      24.10.2023
:Revision:  4.3
:toclevels: 6
:doctype:   book
:icons:     font
:xrefstyle: full

include::common:partial$opsi_terms.adoc[]

[[opsi-manual-configed]]
= Management-Oberfläche *opsi-configed*

Das Programm `opsi-configed` ist ein grafisches Interface, das per HTTPS mit dem opsi-Server kommuniziert und daher auf jedem Rechner läuft, der über dieses Protokoll Verbindung zum Server aufnehmen kann. 

[[opsi-manual-configed-preconditions]]
== Voraussetzungen

Die Management-Oberfläche `opsi-configed` benötigt `opsiconfd` 4.1 oder neuer (siehe Abschnitt xref:server:components/opsiconfd.adoc[Der Dienst *opsiconfd*]). Wenn Sie anstelle des opsi-Paketes die portable Java-Anwendung einsetzen möchten, ist eine aktuelle Java-Laufzeitumgebung erforderlich.

TIP: Wenn Sie eine virtuelle Maschine verwenden, achten Sie auf eine ausreichende Auflösung des virtuellen Bildschirms. `opsi-configed` benötigt mindestens eine Bildschirmauflösung von 1024{nbsp}x{nbsp}768 Pixeln. Für eine bessere Grafik und Bildschirmauflösung bzw. Maus- und Tastaturintegration installieren Sie am besten die VMware Tools oder die VirtualBox Gast-Erweiterungen.


[[opsi-manual-configed-client-selection]]
== Clientauswahl



[[opsi-manual-configed-client-selection-selecting]]
=== Auswahl von Clients


Zusätzlich ist noch die Abfrage von Suchen über eine Kommandozeilen-Schnittstelle möglich, um sie auch Skripten zugänglich zu machen. Dazu wird der opsi-config-editor mit dem Parameter "-qs" und anschließend dem Namen
einer Suche aufgerufen. Lässt man den Namen der Suche weg, wird eine Liste der vorhandenen Suchen ausgegeben. +



Unter dem Menüpunkt _Auswahl_ die Punkte _Fehlgeschlagene Aktionen bei Produkt..._ und _Fehlgeschlagene Aktionen_ (heute, seit gestern, ...),
gibt es die Möglichkeit, fehlerhafte Installationen zu suchen. +

._opsi-configed_: Fehlgeschlagene Aktionen
image::opsi-configed-failedactions-today.png["opsi-configed: Fehlgeschlagene Aktionen - heute", pdfwidth=60%]

Wählt man den ersten Punkt, erhält man eine Liste aller Produkte. Selektiert man ein Produkt, so werden
alle Clients markiert, bei denen die Installation dieses Produktes fehlgeschlagen ist. +
Wählt man z.B. _Fehlgeschlagene Aktionen_ - _heute_, werden all die Clients markiert, bei denen heute mindestens ein Produkt fehlgeschlagen ist.


[[opsi-manual-configed-treeview]]
== Baumansicht 

Clientauswahl und hierarchische Gruppen im _Treeview_

Clients können komfortabel gruppenweise verwaltet werden, indem die Baumansicht-Komponente auf der linken Seite des _opsi-configed_-Fensters genutzt wird.



[[opsi-manual-configed-treeview-principle]]
=== Prinzipieller Aufbau

Der Treeview hat drei Basisknoten _Gruppen_, _Directory_ und _Client-Liste_.  In der _Client-Liste_
werden automatische alle Clients der ausgewählten Depots aufgeführt.

Die ersten zwei Basisknoten unterscheiden sich darin,
wie oft ein Client in ihnen bzw. in Unterknoten von ihnen vorkommen darf.

._opsi-configed_: _Treeview_
image::opsi-configed-treeview.png["opsi-configed: Treeview", pdfwidth=30%]

Das Prinzip lauuet: Während eine Gruppe eindeutig durch ihren Namen bestimmt ist und nicht mehrfach vorkommen kann,
kann ein Client beliebig vielen Gruppen angehören. Im 'Directory'-Teilbaum hat jedoch jeder Client einen eindeutigen Ort;
solange keine explizite Zuweisung zu einer anderen Untergruppe von  'Directory' stattgefunden hat,
wird der Client automatisch in der Gruppe 'NICHT_ZUGEWIESEN' angezeigt.

Wenn ein Client markiert ist, sind alle Gruppen, denen er angehört, mit gefüllter Farbfläche ausgezeichnet.

[[opsi-manual-configed-treeview-howto]]
=== How to ...

Wenn Sie auf einen Baumknoten (eine Gruppe) klicken, so werden alle Clients, die sich unterhalb dieses Knotens befinden, in der Tabelle im _Client_-Tab angezeigt (aber kein Client zur Bearbeitung ausgewählt).

Wenn Sie auf in der Baumansicht einen Client klicken oder mehrere Clients per Strg-Klick bzw. Shift-Klick markieren, so werden diese im Client-Tab angezeigt und zur Bearbeitung markiert.

Mit __Doppelklick __ auf eine Gruppe werden die ihr angehörenden Clients in der Tabelle angezeigt und direkt ausgewählt.

Sie können auf diese Art und Weise auch den Client /oder die in Bearbeitung befindlichen Clients wechseln, während Sie in anderen Tabs (wie z.B. Logdateien) arbeiten, ohne zwischendurch zum Client-Tab zu gehen.


In diesem Treeview werden die Gruppen angezeigt, die Sie gemäß <<opsi-manual-configed-client-selection-selecting>> angelegt haben.
Sie können zusätzlich Gruppen definieren, indem Sie mit der rechten Maustaste über der Eltern-Gruppe bzw. dem Eltern-Knoten (z.B. "GRUPPEN") das Kontextmenü öffnen und 'Untergruppe erzeugen' wählen.

._opsi-configed_: Gruppe anlegen
image::opsi-configed-treeview-generate-group.png["opsi-configed: Gruppe anlegen", pdfwidth=40%]

Wenn Sie dies gemacht haben, werden Sie in einem Dialogfenster nach dem Namen der Gruppe und einer optionalen Beschreibung gefragt.

._opsi-configed_: Gruppenname eingeben
image::opsi-configed-treeview-groupname.png["opsi-configed: Gruppenname und Beschreibung eingeben", pdfwidth=40%]

Eine Gruppe können Sie nun mit Clients füllen, indem Sie mit gedrückter linker Maustaste per Drag&Drop:

* Clients aus der tabellarischen Clientliste im Tab "Clients" in die Gruppe ziehen

* Clients aus einer anderen "normalen" Gruppe, z.B. dem Hauptknoten  'CLIENT-LISTE', ziehen = kopieren

* Clients aus dem Treeview aus einer Direktory-Gruppe in eine andere Directory-Gruppe ziehen = verschieben

Eine Gruppe kann

* per Drag & Drop in eine andere Gruppe verschoben werden;

Das Kontextmenü einer Gruppe dient dazu

* Untergruppen zu erzeugen;

* die Gruppeneigenschaften zu bearbeiten;

* bei Bedarf die Gruppe (samt ihren Untergruppen und allen Clientzuordnungen) zu löschen;

* alle Clientzuordnungen entfernen, wobei die Gruppe und ihre Untergruppen erhalten bleiben;

* die enthaltenen Clients anzuzeigen und in einem Schritt auszuwählen.



[[opsi-manual-configed-client-editing]]
== Client-Bearbeitung

Im Client-Tab können Sie über den Menüpunkt 'OpsiClient' oder das Kontextmenü eine Reihe clientspezifischer Operationen starten.
Außerdem befinden sich auf der rechten Seite Eigenschaften von dem ausgewählten Client, die bei Auswahl eines Clients editierbar sind.

._opsi-configed_: Kontextmenü der Clientliste
image::opsi-configed-client-contextmenu.png["opsi-configed: Kontextmenü der Clientliste", pdfwidth=90%]

[[opsi-manual-configed-module-uefi-wan-installbyShutdown]]
=== Install By Shutdown, Uefi-Boot und WAN-Konfiguration

Einige Standard Konfigurationen für einen Client können direkt in der Client-Information gesetzt werden,
die sich rechts von der Client-Liste befindet. Zu beachten ist, dass es sich bei der UEFI-Boot-Unterstützung und bei der WAN-Konfiguration
um derzeit kostenpflichtige Erweiterungsmodule handelt. Wenn die Module nicht aktiv sind,  werden die Buttons ausgegraut.


* Install By Shutdown: +
Der herkömmliche Weg, Installationen beim Herunterfahren des Rechners zu konfigurieren, ist im xref:../modules/on-shutdown#opsi-on-shutdown[Abschnitt opsi Installation beim Shutdown ] beschrieben.
Dies wird vereinfacht durch die Buttons "An" und "Aus", welche beim Betätigen, den opsi-client-agent mit dem entsprechenden
Wert für das Product-Property "on_shutdown_install" auf setup setzten. Bislang ist es nicht möglich den Status anzeigen zu lassen, ob
ein Client beim Hoch- oder Herunterfahren die Pakete installiert.

* Uefi-Boot: +
Die Checkbox Uefi-Boot zeigt an, ob ein Client für den Uefi-Boot konfiguriert ist. Beim Aktivieren wird die Konfiguration
`clientconfig.dhcpd.filename` zu `linux/pxelinux.cfg/elilo.efi` geändert. (Weiteres im xref:modules/uefi#[Abschnitt opsi mit UEFI / GPT])

* WAN-Konfiguration: +
Der opsi-configed prüft, ob die Standard-WAN-Konfiguration für den Client vorliegt oder nicht. Entsprechend ist der Haken für WAN-Konfiguration gesetzt oder nicht.
Und wenn man den Haken manuell setzt, wird die Standard-Konfiguration eingerichtet.

Diese Konfiguration ist seit Version 4.0.7.6.5 nicht mehr hart kodiert,
sondern wird aus den Server-Hostparametern configed.meta_config.wan_mode_off* ausgelesen bzw. als deren Verneinung interpretiert.
Wenn man die automatisch eingerichteten Meta_Config.wan_mode*-Parameter beibehalten hat,
kommt die in xref:modules/wan-support#[opsi WAN/VPN-Erweiterung] beschriebene,
von der uib GmbH empfohlene Standard-WAN-Konfiguration zum Zuge.


TIP: Ob der Client als WAN-Client konfiguriert ist oder einen UEFI-Boot macht, kann in der Client-Tabelle auch in passenden Spalten dargestellt werden.
Für die laufende Session werden sie im Menüpunkt 'OpsiClient' oder im Kontextmenü aktiviert, dauerhaft über den Eintrag configed.host_displayfields
bei den Server-Hostparametern. Dann ist direkt in der Übersicht erkennbar,
für welche Clients die Eigenschaft gesetzt ist, und es kann auch danach gesucht und sortiert werden.



._opsi-configed_: Erweiterte Spaltensicht für opsi-Clients
image::opsi-configed-clientinfos.png["opsi-configed: Erweiterte Spaltensicht für opsi-Clients", pdfwidth=70%]



[[opsi-manual-configed-host-actions-wakeonlan]]
=== Wake on LAN (WoL) mit versetzten Zeiten

Bei der WOL-Funktion kann ab _opsi-configed_ Version 4.0.7 gewählt werden

* ob das Netzwerksignal direkt an alle ausgewählten Clients geschickt wird
* ob es mit einem Abstand je zwischen zwei Clients versandt werden soll
* wann der Prozess starten soll (Scheduler).

Wenn der Client einem mit dem configserver nicht identischen Depotserver zugeordnet ist, wird das Wake-on-LAN-Signal nicht direkt an den Client geschickt, sondern es wird
eine HTTPS-Verbindung zum _opsiconfd_ auf dem Depotserver aufgebaut und dieser veranlasst, in seinem Netz das Netzwerkpaket zu schicken.

._opsi-configed_: Scheduler für Wake on LAN
image::opsi-configed-wake-on-lan-scheduler.png["opsi-configed: Schedule für Wake on LAN (WoL)", pdfwidth=50%]

Zu beachten ist, dass es der _opsi-configed_ ist, der die Aktionen auslöst, d.h. das Programm darf in diesem Zeitraum nicht beendet werden.



[[opsi-manual-configed-host-actions-opsiclientd-event]]
=== Events auslösen (Push-Installation)

Über diesen Menüpunkt wird den selektierten Clients ein Aufruf an den _opsi-client-agent_ gesendet, durch den ein Event
ausgelöst wird. Wenn ein Client nicht erreichbar ist oder gerade ein anderes Event verarbeitet, was nicht unterbrochen werden kann, so meldet der _opsi-configed_ dies mit einem Fehlerhinweis.

Default-Event ist _on_demand_, das dazu führt, dass Aktionsanforderungen für den Client unmittelbar ausgeführt werden.

WARNING: Wenn ein Produktskript eine Rebootanforderung enthält, so wird der Client ohne Vorwarnung rebootet.

Seit Version 4.0.4 können auch andere Events, die in der opsiclientd.conf konfiguriert sind, ausgelöst werden. Welche zur Auswahl
angeboten werden, wird über den Server-Hostparameter configed.opsiclientd_events festgelegt.

[[opsi-configed-host-actions-delete-package-caches]]
=== Für WAN-Clients: Pakete-Cache löschen

Auf WAN-Clients kann es zu Problemen mit dem Pakete-Cache kommen.
Daher wird für sie eine Funktion angeboten, den Pakete-Cache komplett zu resetten.


[[opsi-manual-configed-client-editing-send-message]]
=== Nachrichten senden

Über die Auswahl von 'Starte Meldungsfenster auf den ausgewählten Clients' erhalten Sie die Möglichkeit,
Nachrichten an einen oder mehrere Clients zu senden.
Es erscheint zunächst ein Fenster in dem Sie die Nachricht editieren können.

._opsi-configed_: Bearbeitungsfenster einer Nachricht
image::opsi-configed-client-message-editing.png["opsi-configed: Bearbeitungsfenster einer Nachricht", pdfwidth=50%]

Durch Anklicken des roten Häkchens versenden Sie die Nachricht. Auf den selektierten Clients wird nun die Nachricht angezeigt:

._opsi-configed_: Nachrichtenfenster auf dem Client
image::opsi-configed-client-message-reading.png["opsi-configed: Nachrichtenfenster auf dem Client", pdfwidth=50%]

[[opsi-manual-configed-client-editing-sessioninfo]]
=== Sessioninfo der ausgewählten Clients

Sie können den ausgewählten Clients das Signal senden, dem opsi-configed ihre Session-Informationen mitzuteilen.
Diese Informationen werden in der entsprechenden Spalte dargestellt, soweit diese eingeblendet ist.


[[opsi-manual-configed-client-editing-shutdown]]
=== Herunterfahren / Reboot der ausgewählten Clients

Sie können den ausgewählten Clients das Signal senden, herunterzufahren bzw. zu rebooten.

WARNING: Der Client fährt ggf. ohne Rückfrage herunter.

[[opsi-manual-configed-client-remotecontrol]]
=== Externe Remotecontrol-Werkzeuge für die ausgewählten Clients aufrufen

Mit der Option _Remote Control Software_ im Kontextmenü sowie im Client-Menü (ab  _opsi-configed_ Version 4.0.1.11) können beliebige
Betriebssystem-Kommandos aufgerufen werden, parametrisiert z.B. mit dem Clientnamen.

Beispielhaft sind zwei Konfigurationen zum Anpingen des ausgewählten Hosts automatisch mitgeliefert,
und zwar ein Kommando, das unter Windows ausgeführt werden kann, und eines, das in einer graphischen
Linux-Umgebung arbeitet. Zur Verdeutlichung: Der _opsi-configed_ ruft das jeweilige Kommando
aus _seiner_ Systemumgebung auf. D.h., die Form des benötigten Kommandos hängt davon ab, ob der
_opsi-configed_ unter Windows oder Linux läuft.

._opsi-configed_: Auswahl des Remote-Control-Aufrufs
image::opsi-configed-client-remotecontrol-choice.png["opsi-configed: Auswahl des Remote-Control-Aufrufs", pdfwidth=50%]

Das Auswahlfenster ist dreigeteilt: Oben steht die Liste der Namen der verfügbaren Aufrufe.
Es folgt eine Zeile, in der das ausgewählte Kommando angezeigt wird sowie, falls zulässig, verändert werden
kann. Die Zeile enthält auch Buttons für Start und Abbruch der Aktion. Der dritte Textbereich des Fensters
gibt eventuelle Rückmeldungen des Betriebssystems beim Aufruf des Kommandos wieder.

Die Möglichkeiten, die sich bieten, sind quasi unerschöpflich. Z.B. kann ein Kommando konfiguriert werden,
das eine RemoteDesktop-Verbindung zum ausgewählten Client öffnet (sofern dieser das zulässt).
Unter Windows kann dafür z.B. der folgende Befehl verwendet werden:

`cmd.exe /c start mstsc /v:%host%`

Ein entsprechendes Linux-Kommando lautet z.B.:

`rdesktop  -a 16 %host%`

Dabei ist `%host%` eine Variable, die vom _opsi-configed_ automatisch durch den entsprechenden Wert
für den Hostnamen ersetzt wird. Weitere Variable, die im Kommando verwendet werden können, sind:

- `%ipaddress%`
- `%hardwareaddress%`
- `%opsihostkey%`
- `%inventorynumber%`
- `%depotid%`
- `%configserverid%`

Sofern das Kommando mit _editable_ `true` gekennzeichnet ist, können in der angezeigten Kommandozeile
z.B. Passwörter oder andere ad-hoc-Variationen des Befehls eingegeben werden.

WARNING: Sobald irgendein Kommando als _editable_ gekennzeichnet ist, hat faktisch der configed-Bediener
die Möglichkeit, das vorgegebene Kommando in ein 'beliebiges' Kommando umzuwandeln und
damit beliebige Programme mit Bezug auf den Client-Rechner zu starten.

Sind mehrere Clients markiert, wird das Kommando auf allen ausgewählten parallel ausgeführt.

Die Liste der
verfügbaren Kommandos wird über Server-Konfigurationseinträge bearbeitet (vgl.
<<opsi-manual-configed-hostproperties>>).

Um ein Kommando des Namens `example` zu definieren,  muss minimal ein Eintrag `configed.remote_control.example`
(oder `configed.remote_control.example.command`) erzeugt werden. Als Wert des Properties wird
das Kommando (ggfs. unter Verwendung von Variablen `%host%`, `%ipaddress%` usw.) gesetzt.
Zusätzlich kann ein Eintrag der Form `configed.remote_control.example.description` definiert werden. Der Wert
dieses Eintrags wird als Tooltip angezeigt. Mit einem Booleschen Eintrag der Form `configed.remote_control.example.editable`
kann durch Setzen des Wertes auf `false` festgelegt werden, dass das Kommando beim Aufruf nicht
verändert werden darf.


._opsi-configed_: Bearbeitung der Remote-Control-Aufrufe bei den Server-Konfigurationseinträgen
image::opsi-configed-properties-remotecontrol.png["opsi-configed: Bearbeitung der Remote-Control-Aufrufe bei den Server-Konfigurationseinträgen", pdfwidth=90%]

[[opsi-manual-configed-client-editing-manage]]
=== Clients entfernen, erstellen, umbenennen, umziehen

Sie können den ausgewählten Clients aus dem opsi-System löschen.

Sie haben hier auch die Möglichkeit, Clients neu anzulegen.
Über den Menü-Punkt _Neuen OpsiClient erstellen_, erhalten Sie eine Maske zur Eingabe der nötigen Informationen zur Erstellung eines Clients.

._opsi-configed_: Client anlegen
image::opsi-configed-client-new.png["opsi-configed: Client anlegen", pdfwidth=60%]

Diese Maske enthält auch Felder für die optionale Angabe der IP-Nummer und der Hardware- (MAC)-Adresse.
Wenn das Backend für die Konfiguration eines lokalen DHCP-Servers aktiviert ist (dies ist nicht der Default),
werden diese Informationen genutzt, um den neuen Client auch dem DHCP-Server bekannt zu machen. Ansonsten wird die MAC-Adresse im Backend gespeichert und die IP-Nummer verworfen.

Beim Anlegen von Clients kann, ab der Version 4.0.5.8.1,
für den neuen Client direkt eine Gruppe angegeben werden,
zu der er gehören soll,
sowie welches Netboot-Produkt eventuell direkt auf setup
gesetzt werden soll. Außerdem kann direkt Install by shutdown,
Uefi-Boot sowie die
(Standard-) WAN-Konfiguration aktiviert werden. Diese Einstellungen
können auch ganz einfach in der Hosts-Liste vorgenommen werden.

Seit opsi 4.0.4 können, falls die opsi-Clients z.B. über einen UCS-Service angelegt werden sollen, die Optionen zum Anlegen und
Löschen von Clients abgeschaltet werden.

Zur Steuerung dieser Option existiert ein Hostparameter (Config) `configed.host_actions_disabled`, in dem
die beiden Listenwerte

* `add client`
* `remove client`

zur Verfügung stehen, wobei Mehrfachselektion möglich ist. Default ist <leer>, also kein Wert ist gewählt.

Sie können die Default-Einstellung im _opsi-configed_ über die Serverkonfiguration oder mit folgendem Befehl so ändern, dass ein Erstellen und Löschen von Clients über den _opsi-configed_ nicht mehr möglich ist.

[source,shell]
----
opsi-admin -d method config_updateObjects '{"defaultValues": ["add client", "remove client"], "editable": false, "multiValue": true, "possibleValues": ["add client", "remove client"], "type": "UnicodeConfig", "id": "configed.host_actions_disabled"}'
----

._opsi-configed_: Mehrere Clients anlegen
Es gibt nun auch eine Möglichkeit für das erstellen von vielen Clients auf einmal im configed. Im Fenster zur Clienterstellung lässt sich durch Klicken auf `Template` ein CSV-Template erstellen. Dieses kann dann per Texteditor oder Programmen wie Microsoft Excel oder Libreoffice Calc bearbeitet werden, um beliebig viele Clients samt ihrer Eigenschaften aufzulisten. Indem über den Button `Datei` diese Liste geöffnet wird, werden alle in der Datei aufgelisteten Clients erstellt.

Sie können den ausgewählten Client innerhalb von opsi umbenennen. Sie werden dann in einem Dialogfenster nach dem neuen Namen gefragt.

Ein weiterer Dialog steht für den Umzug von einem Client oder mehreren Clients zu einem anderen Depot zur Verfügung:

._opsi-configed_: Client zu anderem Depot umziehen
image::opsi-configed-client-change-depot.png["opsi-configed: Client zu anderem Depot umziehen", pdfwidth=50%]

[[opsi-manual-configed-client-editing-productreset]]
=== Produkte zurücksetzen

Sie können alle Informationen zu allen Produkten der ausgewählten Clients löschen. Dies kann sinnvoll sein um z.B. einen Testclient auf einen definierten Zustand zu setzen.

[[opsi-manual-configed-productconfiguration]]
== Localboot-Produkte

Wechseln Sie auf den Karteireiter _Localboot-Produkte_,
so erhalten Sie die Liste der zur Softwareverteilung bereitstehenden Produkte
und des Installations- und Aktionsstatus zu den ausgewählten Clients.

Darüber hinaus finden Sie in der rechten Seitenleiste hilfreiche Informationen zu dem ausgewählten Produkt, wie Produktname und -version. Die Felder für Produktinformationen und -beschreibung unterstützen auch die Darstellung von MarkDown, sofern das für die Erstellung der Produktpakete in der control.toml-Datei verwendet wurde.

Auch Produktabhängigkeiten werden samt der Eigenschaften der Abhängigkeiten in einer Tabelle dargestellt. Darunter findet sich zudem noch ein Abhängigkeitsbaum, der die Abhängigkeiten rekursiv anzeigt. Dort kann nicht nur angezeit werden, welche anderen Produkte das ausgewählte benötigt, sondern auch, von welchen es benötigt wird. Das ist zum Beispiel nützlich, wenn Sie vor dem Entfernen eines Produktes überprüfen wollen, ob es noch von anderen benötigt wird.

._opsi-configed_: Tab Localboot-Produkte
image::opsi-configed-localbootproducts.png["opsi-configed: Tab Localboot-Produkte", pdfwidth=90%]

Seit opsi 4.0.4 wird hier eine Suchfunktion angeboten.
Mit der Suchfunktion kann nach Produktnamen bzw. - je nach Einstellung in der Auswahlbox -
nach Werten in den Feldern der Produkttabelle gesucht werden (analog zur Suche in der Client-Tabelle).
Dazu ist im Suchfeld ein Suchstring einzugeben, die Suche startet direkt und die erste Trefferzeile wird
markiert. Wenn es keinen Treffer gibt oder Zeichen aus dem Suchstring gelöscht werden, geht die
Markierung auf die erste Tabellenzeile.

Im Kontextmenü des Suchfeldes werden weitere Optionen angeboten.

._opsi-configed_: Produktsuche, mit Kontextmenü
image::configed_productsearch.png["opsi-configed: Produktsuche, mit Kontextmenü", pdfwidth=70%]

Hilfreich kann die Benutzung der Filterfunktion sein. Aktivieren des Filters reduziert die angezeigten Produkte
auf die in diesem Moment markierten. Die Auswahl bleibt erhalten, bis der Filter durch erneutes
Anklicken des Filterbuttons wieder deaktiviert wird.

Werte in der Produktliste, die für die ausgewählten Clients unterschiedlich sind, werden grau (als Darstellung des Wertes 'undefined') angezeigt.


Sie können auch für die Produktliste eine Sortierung nach einer anderen als der ersten Spalte durch Anklicken des Spaltentitels erreichen.
Verfügbar sind die folgenden Spalten:

* _Stand_ ist der letzte der Softwareverteilung gemeldete Status zu diesem Produkt und kann die Werte _installed_, _not_installed_ und _unknown_ haben.
_not_installed_ wird aus Gründen der Übersichtlichkeit nicht angezeigt.
'unknown' ist der Status üblicherweise während einer (De-)Installation sowie wenn das letzte Skript gescheitert ist.

* _Report_ ist eine Zusammenfassung der Werte der internen Statusinformationen "Installationsfortschritt" ('actionProgress'),
"Ergebnis der letzten Aktion" (_actionResult_) und "letzte angeforderte Aktion" (_lastAction_).
Während einer Installation steht hier z.B. 'installing'
Nach Abschluss einer Aktion enthält das Feld den Text _Ergebnis (letzte Aktion)_, z.B. _failed (setup)_ oder _success (uninstall)_.

* _Angefordert_ ist die Aktion, welche ausgeführt werden soll. Ein möglicher Wert ist immer _none_ (visuell ist das Feld leer).
Darüber hinaus sind die Aktionen verfügbar, für die bei diesem Produkt Skripte hinterlegt wurden. Möglich sind _setup_, _uninstall_, _update_, _once_, _always_, _custom_.

* _Prioritätsklasse_ gibt an, welche Priorität (100 bis -100) dem Produkt zugeordnet wurde (per default ist die Spalte nicht sichtbar.)

* _Position_ gibt an, in welcher Reihenfolge die Produkte installiert werden, per Default ebenfalls keine sichtbare Spalte.

* _Version_ ist die Kombination aus Produkt-Version und Package-Version, des auf dem Client installierten opsi-Softwareproduktes.

Durch das Anwählen eines Produktes erhalten Sie auf der rechten Seite des Fensters weitere Informationen zu diesem Produkt. Im Einzelnen:

* _ProduktID:_: Klartextname des Produktes

* _Software/Paketversion_: Produktversion-Paketversion der zur Verteilung bereitstehenden Software (wie sie der Paketierer angegeben hat).

* _Produktbeschreibung_: Freier Text zur im Paket enthaltenen Software.

* _Hinweise_: Freier Text mit Angaben zum Umgang mit diesem Paket.

* _Abhängigkeiten_: Eine Liste von Produkten,
zu denen das ausgewählte Produkt Abhängigkeiten aufweist mit Angabe der Art der Abhängigkeit:

- _required_ bedeutet, das ausgewählte Produkt benötigt das hier angezeigte Produkt, es besteht aber keine zwingende Installationsreihenfolge.

- _pre-required_ heißt, das hier angezeigte Produkt muss _vor_ dem Ausgewählten installiert werden.

- _post-required_ spezifiziert, das hier angezeigte Produkt muss _nach_ dem Ausgewählten installiert werden.


* _Konfiguration für den Client_: Zur clientspezifischen Anpassung der Installation können
für ein Produkt zusätzliche Properties definiert sein.
Die Darstellung und Bearbeitung der Tabelle der Properties ist in einem spezifischen Oberflächenelement realisiert:


[[opsi-manual-configed-property-editing]]
== Property-Tabellen mit Listen-Editierfenstern

Eine Property-Tabelle ist eine zweispaltige Tabelle.
In der linken Spalte stehen Property-Namen, denen jeweils in der rechten Spalte ein Property-Wert zugeordnet ist.

Die Zeilen, die nicht dem Serverdefault entsprechen, werden fett angezeigt.

Rechts oben befinden sich zwei Buttons:

* (rechts): Entferne clientspezifische Werte: +
Dieser Button löscht alle Einstellungen beim Client, so dass die Serverdefaults wirken. Werden Serverdefaults geändert wirkt sich dies somit direkt auf den Client aus.

* (links): Setze Clientwerte auf Serverdefaults: +
Dieser Button kopiert die Serverdefaults als Clienteinstellungen. Damit bleiben diese Einstellungen beim Client erhalten, auch wenn später die Serverdefaults geändert werden.

Sofern entsprechend konfiguriert, wird ein Hinweis zur Bedeutung eines Wertes sowie der Defaultwert angezeigt,
sobald der Mauszeiger über die betreffende Zeile bewegt wird ("Tooltip"):

._opsi-configed_: Property-Tabelle
image::opsi-configed-editlist1.png["opsi-configed: Property-Tabelle", pdfwidth=60%]


Beim Anklicken eines Wertes poppt ein Fenster auf, der 'Listen-Editor', und zeigt einen Wert bzw. eine Liste vorkonfigurierter Werten,
wobei der derzeit gültige Wert (bzw. die derzeit selektierte Wertekombination)  markiert ist:

._opsi-configed_: Listen-Editor, Auswahlliste
image::opsi-configed-editlist2.png["opsi-configed: Listen-Editor, Auswahlliste", pdfwidth=60%]


Durch Anklicken eines (anderen) Wertes kann die Auswahl neu gesetzt  (bzw. durch Strg-Click erweitert oder verkleinert) werden.

Sofern die Liste der zulässigen Werte erweiterbar ist (die Werte sind somit änderbar),
bietet das Fenster zusätzlich ein Editierfeld an,
in dem neue bzw. geänderte Werte eingegeben werden können.

._opsi-configed_: Listeneditor, Editierfeld
image::opsi-configed-editlist3.png["opsi-configed: Listeneditor, Editierfeld", pdfwidth=60%]

Wenn ein Wert nur modifiziert werden soll, kann er aus der Liste der Vorhandenen mit Doppelklick in das Editierfeld übernommen werden.
Sobald ein in der Liste noch nicht vorhandener Wert im Editierfeld steht,
aktiviert sich das Plus-Symbol zum Übernehmen des neuen Wertes.

Sofern - wie z.B. beim Property _additional drivers_ der Fall sein sollte - Mehrfach-Werte zulässig sind, erlaubt die Liste eine Mehrfach-Selektion.
Wenn die Liste als Mehrfach-Selektion konfiguriert ist, wird ein Wert mit Strg-Klick zur Selektion hinzugefügt bzw. ein Selektierter entfernt.
Mit dem Minus-Button kann die Selektion in einem Rutsch komplett geleert werden.

Wenn die Liste bearbeitet wurde, wechselt wie auch sonst im configed der grüne Haken nach Rot. Anklicken des Hakens übernimmt den neuen Wert (d.h. die neue Selektion als Wert). Der blaue Cancel-Knopf beendet die Bearbeitung, indem der ursprüngliche Wert zurückgesetzt wird.

[[opsi-manual-configed-property-editing-secrects]]
== Geheime Property-Werte

Für den Fall, dass Passwörter oder andere "Geheimnisse" als Property-Werte vorkommen,
ist folgende Vorkehrung getroffen (als "Hack" seit Version 4.0.7, bis ein spezifischer Datentyp eingerichtet ist):

* Wenn im Namen des Properties irgendwo 'password' vorkommt
* oder wenn der Property-Name mit 'secret' ("geheim" oder "Geheimnis") beginnt,

wird der Property-Wert bei der Anzeige durch fünf  _*_  ersetzt. Er wird erst - nach Vorwarnung - sichtbar gemacht, wenn er wie zur Bearbeitung angeklickt wird.

Die Bearbeitung findet ggfs. wie im Standardfall statt.





[[opsi-manual-configed-netbootproducts]]
== Netboot-Produkte

Die Produkte unter dem Karteireiter _Netboot-Produkte_ werden analog zum Karteireiter _Localboot-Produkte_ angezeigt und konfiguriert.

Die hier angeführten Produkte versuchen, werden sie auf _setup_ gestellt, zu den ausgewählten Clients den Start von Bootimages beim nächsten Reboot festzulegen.
Dies dient üblicherweise der OS-Installation.

._opsi-configed_: Tab Netboot-Produkte
image::opsi-configed-netbootproducts.png["opsi-configed: Tab Netboot-Produkte", pdfwidth=90%]

[[opsi-manual-configed-hardwareinformation]]
== Hardwareinformationen

Unter diesem Karteireiter erhalten Sie die letzten - entweder durch das Bootimage oder durch das Localboot-Produkt hwaudit
erhobenen - Hardwareinformationen zum ausgewählten Client.

._opsi-configed_: Tab Hardware-Information
image::opsi-configed-hardwareinformation.png["opsi-configed: Tab Hardware-Information", pdfwidth=90%]

[[opsi-manual-configed-automat-treiberintegration]]
=== Automatisierte Treiberintegration

Um vereinfacht und automatisiert Treiber von speziellen Clients auf den _opsi-Depotserver_ zu uploaden, gibt es seit
der Version 4.0.5 die Möglichkeit aus den Hardwareinformationen mögliche Pfade auszuwählen, die vom opsi-configed über den Share
übertragen werden.
Die zwei angebotenen byAudit-Treiberpfade setzten sich zusammen aus dem Hersteller und dem Produkt bzw. dem Modell, welche jeweils aus dem Computer und der Hauptplatine ausgelesen werden. Betätigt man den rechten Button zum Treiberupload, so erscheint ein neues Fenster um weitere Einstellungen zu tätigen.

image::opsi-configed-hardwareinfo-treiberintegration.png["opsi-configed: Tab Hardware-Information - Treiberupload", pdfwidth=90%]

Haben Sie den _opsi-configed_ auf einem Linux-System geöffnet, so ist es nicht direkt möglich einen Treiberupload durchzuführen, da die Verbindung über einen Share durchgeführt wird. Dies muss dann manuell getätigt werden. Jedoch sind die Methoden bzw. Verzeichnisstrukturen ein wesentlicher Aspekt der Treiberintegration.

Ohne weiteres funktioniert der Treiberupload von einem Windows-Rechner, wenn die Verbindung zum Share aktiviert ist.
Unter anderem müssen im neues Fenster Angaben getätigt werden, für welches Windows-Produkt der Treiber bereit gestellt
werden soll, welche Treiber geuploadet werden sollen und mit welcher Methode bzw. in welches Verzeichnis die Treiberintegration erfolgt. Das Zielverzeichnis wird mit Auswählen einer anderen Methode dem entsprechend geändert. Der zuvor ausgewählte byAudit-Treiberpfad findet sich in der per Default ausgewählten Methode 'byAudit' wieder, die den ausgewählten Treiber spezifisch für den Maschinentyp integriert.
Folgende Methoden bzw. Verzeichnisse sind möglich:

 * _Standard_: Treiber welche im Verzeichnis `./drivers/drivers` liegen, werden anhand der PCI-Kennungen (bzw. USB- oder HD_Audio-Kennung) in der Beschreibungsdatei des Treibers als zur Hardware passend erkannt und in das Windows Setup mit eingebunden. Der Nachteil dieser Pakete ist, das sich hier auch Treiber finden, welche zwar von der Beschreibung zu Ihrer Hardware passen, aber nicht unbedingt mit Ihrer Hardware funktionieren. Hier können Treiber hinterlegt werden, die einen Fallback für alle Clients darstellen.

 * _Preferred_: Zusätzliche bzw. geprüfte Treiber gehören in jeweils eigene Verzeichnisse (Name und Tiefe der Verzeichnisstruktur egal) unterhalb des Verzeichnisses `./drivers/drivers/preferred`. Treiber welche im Verzeichnis `./drivers/drivers/preferred` liegen, werden gegenüber den Treibern in `./drivers/drivers` bevorzugt anhand der PCI-Kennungen (bzw. USB- oder HD_Audio-Kennung) in der Beschreibungsdatei des Treibers als zur Hardware passend erkannt und in das Windows Setup mit eingebunden. Finden sich z.B. zu ein und derselben PCI-ID unterschiedliche Treiber unter `preferred`, so kann dies zu Problemen bei der Treiber Zuordnung führen. In diesem Fall ist eine direkte Zuordnung der Treiber zu den Geräten notwendig.

 * _Excluded_: Es kann vorkommen, das Treiberverzeichnisse von Herstellern Treiber für unterschiedliche Betriebssystemversionen (Vista / Win7) oder Konfigurationen (SATA / SATA-Raid) enthalten. Wenn Sie die Vermutung haben, das ein verlinkter Treiber falsch ist, so verschieben Sie diesen Treiber in das Verzeichnis `drivers/exclude` und führen `create_driver_links.py` erneut aus. Treiber die in `drivers/exclude` liegen werden bei der Treiberintegration nicht berücksichtigt.

 * _Additional_: Zusätzliche Treiber, die unabhängig von ihrer Zuordnung bzw. Erkennung über die PCI- oder USB-IDs installiert werden sollen, gehören in jeweils eigene Verzeichnisse (Name und Tiefe der Verzeichnisstruktur egal) unterhalb des Verzeichnisses `./drivers/drivers/additional`. Über das Produkt-Property 'additional_drivers' können Sie einen oder mehrere Pfade von Treiberverzeichnissen innerhalb von `./drivers/drivers/additional` einem Client zu ordnen. Im Produkt-Property 'additional_drivers' angegebene Verzeichnisse werden rekursiv durchsucht und alle enthaltenen Treiber eingebunden. Dabei wird auch symbolischen Links gefolgt. Dies können Sie nutzen, um für bestimmte Rechner-Typen ein Verzeichnis zu erstellen (z.B. dell-optiplex-815).

 * _byAudit_: In dem Verzeichnis `./drivers/drivers/additional/byAudit/<Vendor>/<Model>` hinterlegte Treiber, werden bei einer Windows-Installation nach einem Verzeichnisnamen durchsucht, der dem bei der Hardware-Inventarisierung gefundenen 'Vendor' entspricht. In diesem 'Vendor' Verzeichnis wird nun nach einem Verzeichnisnamen gesucht, das dem bei der Hardware-Inventarisierung gefundenen 'Model' entspricht. Wird ein solche Verzeichnis gefunden, so wird diese Verzeichnis genauso behandelt, als wären sie über das Produktproperty 'additional_drivers' manuell zugewiesen.



Einige Hersteller verwenden Modellbezeichnungen, die für diese Methode sehr ungünstig sind, da man einige Sonderzeichen wie / nicht in Datei- oder Verzeichnisnamen verwenden darf. Ein Beispiel dafür wäre als Modelbezeichnung: "5000/6000/7000". Ein Verzeichnis mit dieser Bezeichnung ist wegen den Sonderzeichen nicht gestattet. Seit der dritten Service Release opsi 4.0.3 werden deshalb folgende Sonderzeichen: < > ? " : | \ / *  intern durch ein _ ersetzt. +
 Mit dieser Änderung kann man oben genanntes schlechtes Beispiel als: "5000_6000_7000" anlegen und das Verzeichnis wird automatisch zu gewiesen, obwohl die Information in der Hardware-Inventarisierung nicht der Verzeichnisstruktur  enstprechen.

IMPORTANT: Nach einem Treiberupload nach `./drivers/drivers` oder `./drivers/drivers/preferred` sollte die `create_driver_links.py` auf dem 'opsi-Depotserver' aufgerufen werden!



[[opsi-manual-configed-softwareinventory]]
== Software-Inventarisierung

Unter diesem Karteireiter erhalten Sie die letzten mit swaudit ausgelesenen Informationen über installierte Software beim Client.

._opsi-configed_: Tab Software-Inventarisierung
image::opsi-configed-softwareinventory.png["opsi-configed: Tab Software-Inventarisierung", pdfwidth=90%]


[[opsi-manual-configed-logfiles]]
== Logdateien: Logs von Client und Server

Im Kartenreiter Logdateien sind die Logdateien der Clients über den opsi-configed einsehbar.

Der Level, bis zu dem die Logeinträge sichtbar sind, kann mit einem Schieberegler variiert werden, so dass Fehler
leichter gefunden werden können. Der Regler ist auch mausrad-bedienbar.

Dabei kann auch in den Logdateien gesucht werden (Fortsetzung der Suche mit _F3_ oder _Strg-L_ = last search repeated).
Die einzelnen Zeilen sind je nach Loglevel farbig hervorgehoben.

._opsi-configed_: Tab Logdateien
image::opsi-configed-logfiles.png["opsi-configed: Tab Logdateien", pdfwidth=90%]

[[opsi-manual-configed-product-defaultproperties]]
== Produkt-Defaultproperties
Um die Defaultwerte der Produkte für einzelne oder mehrere opsi-depots zu ändern, gibt es einen Reiter _Produkt-Defaultproperties_. Dieser wird erst auswählbar, wenn man zur Depotkonfiguration (zweiter Button oben rechts) wechselt. +
In der Haupttabelle werden alle Produkte mit der Produkt-Version und der Package-Version aufgelistet.
Wählt man ein Produkt aus, so werden, wie aus der Client-Produktkonfiguration gewohnt (vgl. <<opsi-manual-configed-productconfiguration>>), rechts oben die allgemeinen Informationen zum Produkt-Paket angezeigt. Darunter befindet sich die Auflistung aller Depots, die das ausgewählte Produkt besitzen.
Die unterhalb befindliche Tabelle mit den Property-Schlüsseln und Werten ist
ebenfalls bekannt aus der Client-Produktkonfiguration.

[[image-configed-product-defaultproperties]]
._opsi-configed_: Produkt-Defaultproperties
image::opsi-configed-produkt-defaultproperties-jedit-verschiedene-werte.png["opsi-configed: Produkt-Defaultproperties: jEdit", pdfwidth=90%]
Man kann ein oder mehrere Depots auswählen, um die Defaultwerte (d.h. die Depotwerte) des Produktes zu ändern. Als Voreinstellung werden alle verfügbaren Depots ausgewählt. Mit den üblichen Tastenkombinationen (_Strg-a_, _Strg-Klick_ oder _Shift-Klick_) lassen sich mehrere bzw. alle Clients markieren. +
Ist der Property-Wert ausgegraut (siehe <<image-configed-product-defaultproperties>> - ``gui_language''), so sind auf den ausgewählten Depots verschiedene Werte für diese Property gesetzt. Rechts neben den Depots befinden sich drei Buttons:

* (=+): Markiere alle Depots mit identischen Werten +
Alle Depots, die die gleichen Default-Werte haben, werden markiert.
* (++): Alle Depots werden markiert.
* (Weltkugel): Setze die Paket-Default-Werte +
Die Original-Paket-Werte des Produktes werden für das/die ausgewählte/n Depot/s gesetzt.

[[opsi-manual-configed-hostproperties]]
== Host-Parameter: Client- und Serverkonfiguration

Eine ganze Reihe von Konfigurationsvorgaben können Sie über den Tab 'Host-Parameter' setzen
und zwar als Server-Defaults im Modus Serverkonfiguration
(vgl. <<opsi-manual-configed-mode-selection>>)
und clientspezifisch in der Clientkonfiguration.

Konfigurationseinträge (config-Objekte des opsi-Servers) sind grundsätzlich Wertelisten.
Als Werkzeug zur Bearbeitung der Werte dient daher der Listeneditor
(vgl. <<opsi-manual-configed-property-editing>> )

Je nach Type des jeweiligen Konfigurationsobjekts

- können die Elemente der Liste entweder Unicode-Textwerte oder boolesche Werte (`true`/`false`) sein;

- kann die Gesamtheit der zulässigen Listenelemente fest oder erweiterbar sein;

- umfasst der DefaultValues-Eintrag des Objekts  im singleValue-Fall genau ein Listenelement,
bei multiValue-Objekten eine beliebige Auswahl aus den zulässigen Listenelementen.

Neue Konfigurationseinträge können über das Kontextmenü auf der Server-Hostparameter-Seite erstellt werden.
Ebenso können dort bestehende Objete gelöscht werden.

Das Verhältnis von Server- und Client-Hosteinträgen ist verwickelt:

- Server-Einträge liefern die Default-Werte für die Client-Einträge.

- Konsequenterweise muss, um einen Client-Eintrag zu erhalten, zuerst ein Server-Konfigurationsobjekt angelegt werden.

- Und, wenn ein Server-Eintrag (das Config-Objekt) gelöscht wird, verschwinden auch
die zugehörigen Client-Einträge (die auf ConfigState-Objekten beruhen).

- Es kann sowohl bei Abweichung des Client-Wertes vom Server-Default als auch, wenn die beiden derzeit identisch sind, einen
eigenen Eintrag des Clients in der Datenbank geben. Sofern es diesen eigenen Eintrag gibt, bleibt er auch erhalten, wenn sich der
Server-Default ändert.

- Zum Umgang mit diesem Thema gibt es daher ab configed Version 4.0.7.6.5 für die Client-Properties ein Kontextmenü
mit den beiden Optionen "Spezifischen Client-Wert entfernen" (d.h., der Clientwert ist immer der gerade aktuelle Default-Werte des Servers)
und  "Setze den jetzigen Default-Wert als (dauerhaften) Wert für den Client.

- Wenn der Client-Wert sich vom aktuellen Server-Default unterscheidet, so ist dieser fett dargestellt.

- Es kann Konfigurationsobjekte geben, für die theoretisch Client-Werte erzeugt und bearbeitet
werden können, die jedoch keinerlei Bedeutung haben, weil eigentlich nur serverbezogene Informationen gespeichert werden.
Diese Properties sind in den aktuellen configed-Versionen in der Regel ausgeblendet.

Zur besseren Übersicht sind die Host-Parameter gegliedert nach Funktionsgruppen aufgeführt.
Die Gruppen werden auf der linken Seite in einer baumartigen Struktur aufgeführt. Jeweils die zugehörigen
Parameter und ihre Werte erscheinen auf der rechten Seite.


._opsi-configed_: Tab Hostparameter (als Serverkonfiguration)
image::opsi-configed-hostparameters.png["opsi-configed: Tab Hostparameter (als Serverkonfiguration)", pdfwidth=90%]


._opsi-configed_: Tab Hostparameter (Kontextmenü eines Clienteintrags)
image::opsi-configed-hostparameter_setting.png["opsi-configed: Tab Hostparameter (Kontextmenü eines Clienteintrags)", pdfwidth=60%]



[[opsi-manual-configed-hostproperties-userroles]]
=== Verwaltung von Benutzerrechten und -rollen

Ab Version 4.0.7.5 bietet der _opsi-configed_ die Userrollen-Funktion an.

WARNING: Zur Verwendung des Features muss _user roles_ in der _modules_-Datei freigeschaltet sein.

In der Oberfläche zeigt die Existenz der Kategorie _user_ in der Übersicht der Server-Hostparameter,
dass diese Funktion verfügbar (aber noch nicht unbedingt aktiv) ist.
Im Baum der Eigenschaften steht direkt in _user_  primär der boolesche Eintrag

[source,shell]
----
user.{}.register
----


mit dem Defaultwert _false_.

Die anderen Einträge, die an dieser Stelle des Property-Baums stehen, sind die Defaultwerte für die auch userspezifisch mögliche Konfiguration der Server-Konsole
(vgl.  <<opsi-manual-configed-serverconsole>>):


Zur Aktivierung der Userrollen-Funktionalität ist

1. der Wert von _user.{}.register_ auf _true_ zu setzen;
2. eine Modules-Datei einzuspielen, die das Feature _userroles_ temporär oder dauerhaft aktiviert hat.

Bei aktiver Userrollen-Funktionalität wird für den angemeldeten User ein Eintrag im Eigenschaftsbaum erzeugt.
Die dabei für die Rechteverwaltung verwendeten Defaulteinstellungen
entsprechend den "klassischen" Vorgaben für einen Adminitrator,
d.h. zunächst werden dem User keine Einschränkungen auferlegt. Z.B. für einen User _admindepot1_
werden die Einträge

[source,shell]
----
user.{admindepot1}.privilege.host.all.registered_readonly	[false]
user.{admindepot1}.privilege.host.depotaccess.configured	[false]
user.{admindepot1}.privilege.host.depotaccess.depots		[]
user.{admindepot1}.privilege.host.opsiserver.write		[true]
----

generiert.

Die vier Einträge bedeuten:

- _admindepot1_ hat _nicht_ lediglich readonly-Zugriff auf den Server (ein reiner readonly-Zugriff wäre möglicherweise für einen Mitarbeiter aus dem Helpdesk-Bereich angemessen);
- Depotrestriktionen existieren nicht bzw. werden nicht berücksichtigt;
- entsprechend kann die Liste der für den User zugänglichen Depots leer bleiben
(aber auch wenn hier eine Auswahl aus den verfügbaren eingetragen ist, hat dies, solange _depotaccess.configured  false_, keine Wirkung);
- der User darf configserver-Einstellungen aller Art bearbeiten.

Soll künftig _admindepot1_ nur noch Zugriff auf die Rechner im Depotserver _depot1_ haben, ist folgendes einzustellen:

- _host.depotaccess.configured_ ist auf _true_ zu setzen;
- in die Liste _host.depotaccess.depots_ ist der Wert "depot1" einzutragen.

Nach einem (vollständigen) Datenreload sind für den User _admindepot1_ keine Clients aus anderen Depots mehr sichtbar
(und auch nur noch Depoteinstellungen für _depot1_ zugänglich).

WARNING:  _admindepot1_ kann alle Restriktionen selbst aufheben, solange er über das Privileg _host.opsiserver.write_ verfügt.

Um die Abriegelung komplett zu machen, ist daher für _admindepot1_ noch

- _host.opsiserver.write_ auf _false_ zu stellen.



WARNING: Die auf diese Weise gesetzten Privilegien beschränken ausschließlich die Funktionalität des _opsi-configed_.
Bei anderen Zugriffsmethoden auf das JSON-RPC-Interface des opsi-servers werden sie derzeit nicht wirksam.



[[opsi-manual-configed-depotconfiguration]]
== Depotkonfiguration

Im Modus Depotkonfiguration (vgl. <<opsi-manual-configed-mode-selection>>) öffnet sich der Tab _Depots_. Nach Auswahl eines Depotservers in der Drop-Down-Liste können Werte bearbeitet werden, die das Depot parametrisieren.

._opsi-configed_: Tab Depot-Konfiguration
image::opsi-configed-depotconfiguration.png["opsi-configed: Tab Depot-Konfiguration", pdfwidth=90%]


[[opsi-manual-configed-groupactions]]
== Gruppenaktionen

Mittels der Schaltfläche "Gruppenaktionen" (vgl. <<opsi-manual-configed-mode-selection>>)
wird ein entsprechendes Fenster für gruppenbezogene Funktionen geöffnet.

Im Moment wird nur eine Funktion angeboten, die für die opsi-localimage-Option interessant ist:

*  die Suche nach einem Betriebssystem, das auf allen PCs der selektierten Gruppe schon installiert war und daher zur Auswahl für die Inbetriebnahme (auf allen PCs der Gruppe) angeboten werden kann.

._opsi-configed_: Gruppenaktionen (für opsi-local-image)
image::configed_groupaction_localimage.png["opsi-configed: Gruppenaktionen (für opsi-local-image)", pdfwidth=90%]

[[opsi-manual-configed-packageactions]]
== Produktaktionen

Mittels der Schaltfläche "Produktaktionen"  (vgl. <<opsi-manual-configed-mode-selection>>)
wird ein entsprechendes Fenster für Produkt-/Paket-bezogene Aktionen geöffnet.

Im Moment stehen zwei Funktionen zur Verfügung:

*  Eine .opsi-Datei (ein opsi-Paket) kann ausgewählt werden bzw. der Pfad zu ihr eingegeben werden. Das Paket kann auf den opsi-Server hochgeladen werden; der standardmäßig vorhandene Netzwerk- (Samba-) Share opsi_workbench auf dem opsi-Server ist dabei der Default-Wert für das Zielverzeichnis auf dem Server. Schließlich wird bei Betätigen des Buttons versucht, das Paket mit einem Aufruf analog einem opsi-package-manager-Aufruf auf dem Server als Produkt zu installieren.

*  Die WinPE-Dateien bzw. die Installfiles für ein Windows-Produkt (ab Windows Vista) können in das Server-Produktverzeichnis (Share opsi_depot) hochgeladen werden, so dass die Windows-Produkte nicht mehr serverseitig angefasst werden müssen.

._opsi-configed_: Paket- bzw. Produktaktionen
image::configed_package-actions.png["opsi-configed: Produktaktionen", pdfwidth=90%]


[[opsi-manual-configed-serverconsole]]
== Server-Konsole

WARNING: Einige der nachfolgend beschriebenen Configed-Funktionen stehen erst ab der python-opsi-Version 4.0.7.38 zur Verfügung.
Dazu zählt vor allem die Befehlsbearbeitung (<<opsi-manual-configed-serverconsole-commandcontrol>>) sowie
die Ausführung der darüber hinterlegten Befehle im configed.

Mit der Version 4.0.7.5 ist der configed um einen neuen Hauptmenüeintrag erweitert,
die "Server-Konsole".
Damit wird die Möglichkeit geboten, vom configed aus
auch über eine SSH-Verbindung Aktionen auf dem opsi-server auszulösen.
Zum einen kann ein Terminal auf dem opsi-server gestartet werden,
zum anderen existieren Menüpunkte für vordefinierte Kommandozeilenbefehle.


._opsi-configed_: Menü: Server-Konsole
image::configed_serverkonsole.png["opsi-configed: Server-Konsole", pdfwidth=80%]

[[opsi-manual-configed-serverconsole-permissions]]
=== Verbindungsdaten und Berechtigungen

Wenn nicht anderes konfiguriert ist, wird versucht, für die SSH-Verbindung den im configed angemeldeten User und den verbundenen Configserver zu verwenden.

Ist dies nicht erwünscht, kann die Verbindung über einen SSH-Schlüssel (ggf. mit Passphrase) beim Start des Configeds gestartet werden.
Zu diesem Zweck existieren die folgenden Aufrufparameter für den configed:

* --ssh-key PATH:  z.B. --ssh-key /home/user/.ssh/id_rsa
* --ssh-passphrase PASSPHRASE: z.B. --ssh-passphrase meinpassword

Die Einstellungen lassen sich unter dem Menüpunkt  "Verbindungsdaten" ändern. +

Über Server-Hostparameter (User-Abschnitt) kann feingranular gesteuert werden,
welche der Menüpunkte sichtbar sind bzw. genutzt werden können.
Bei aktivierter Userroles-Funktionalität (vgl. <<opsi-manual-configed-hostproperties-userroles>>)
werden die Konfigurationen userspezifisch verwendet. Für einen neu angelegten User werden dabei
als Default-Werte zunächst die Werte von der allgemeinen User-Ebene gesetzt.

Folgende Configs existieren:

* user.{}.ssh.serverconfiguration.active: +
Aktiviert das Menü der SSH-Verbindungseinstellungen . (Default: false)

* user.{}.ssh.commandmanagement.active: +
Aktiviert die Bearbeitung von Menüeinträgen der SSH-konsolen-Befehle (Default: false)

* user.{}.ssh.menu_serverconsole.active: +
Gibt den Hauptmenüeintrag "Server-Konsole" als solchen frei. (Default: true)

* user.{}.ssh.terminal.active: +
Schaltet die SSH-Shell frei. (Default: true)

* user.{}.ssh.commands.active: +
Schaltet alle SSH-Menüeinträge frei, die hinterlegte Befehle darstellen. (Default: true)

[[opsi-manual-configed-serveractions-terminal]]
=== SSH-Terminal
Mithilfe des Terminals können Linux-Systembefehle auf dem verbundenen SSH-Server ausgeführt werden. +
Das Eingabe-Echo kann durch Sternchen (*) ersetzt werden (Passwort-Eingabe). +
Ein gestarteter Prozess lässt sich mit dem Button "Prozess/Verbindung beenden" oder durch "Strg+C" abbrechen. +
Wie von der Kommandozeile gewohnt, kann die "TAB"-Taste Befehle vervollständigen. Achtung: Pfade werden nicht vervollständigt - lediglich Linux-Systembefehle. +
Außerdem können Datenquellen aus dem configed-Kontext angegeben werden, die bei der Befehlsausführung durch die konkreten Werte ersetzt werden.
(Mehr zu dieser Funktionalität: <<opsi-manual-configed-serverconsole-commandcontrol>> - Punkt: Datenquellen)

._opsi-configed_: SSH-Terminal
image::configed_serverkonsole-terminal.png["opsi-configed: SSH-Terminal", pdfwidth=80%]

[[opsi-manual-configed-serveractions-parametercommands]]
=== Vordefinierte Befehle mit Eingabemasken
//Als vorgegebene Befehle befinden sich unter der Menügruppe "opsi" 4 Befehle, die während der Laufzeit unterschiedliche Parameter benötigen (gekennzeichnet durch "...").
Unter der Menügruppe "opsi" stehen einige Befehle unabhängig von den selbst definierbaren Befehlen mit einer eigenen Eingabe-Oberfläche zur Verfügung. Diese vereinfachen den Umgang mit diversen Skripten.

* Datei-Download ... +
Eine beliebige Datei kann aus dem Internet mittels "wget"-Befehl heruntergeladen und in ein Zielverzeichnis auf dem Server abgelegt werden. Anwendung findet der Befehl beispielsweise für konkrete opsi-Pakete von download.uib.de.

* Erstellung opsi-Produkt ... +
Voraussetzung für diesen Befehl ist ein opsi-utils-Paket mit der Version >=4.0.7.7.
Über diesen Menüpunkt kann dann, mit Angabe eines Server-Verzeichnis, aus diesem ein opsi-Paket erstellt werden.
Außerdem können die in der Control-Datei gefundenen Versionen (Paket- und Produkt-Version) über einen Button angezeigt und überschrieben
sowie eine md5-Summe und/oder eine zsync-Datei erstellt werden.
Beim Ausführen wird eine .opsi-Datei gebaut.
Zwecks Installation auf dem Server bzw. Depot leitet der Button "Das neu erstellte Paket installieren" zum opsi-package-manager weiter.

* Opsi-Rechte setzen ... +
Dieser Menüpunkt bildet den opsi-Befehl opsi-set-rights ab. Nach der Möglichkeit einen bestimmten (optionalen) Pfad einzugeben in dem das Skript ausgeführt werden soll, wird nach dem root-Passwort gefragt und das Skript im seperaten Fenster ausgeführt.

* Paket-Installation ... +
Durch diesen Befehl können opsi-Pakete mittels "opsi-package-manager" auf allen Depots oder einem Depot installiert werden.
Dabei kann der Server-Pfad zum Paket angegeben werden, in dem sich das opsi-Paket befindet. +
Durch Auswahl eines Paketes aus dem Internet wird die Funktionalität des Befehls "Datei download ..." aufgegriffen und anschließend das heruntergeladene Paket auf dem Depot installiert.
Außerdem sind die Parameter "--update" und "--setup" des opsi-package-manager implementiert.
Sollen die zsync und md5-Dateien eines opsi-Paketes heruntergeladen werden, kann der Schalter "zsync- und md5 einschließen"  aktiviert werden.
Dann wird die url der Pakete entsprechend ergänzt und die zusätzlichen Dateien werden ebenfalls gezogen. +
Mehr zum opsi-package-manager finden Sie unter xref:server/configuration-tools#opsi-manual-configuration-tools-opsi-package-manager[Werkzeug 'opsi-package-manager': opsi-Pakete (de-)installieren]

* Paket-Deinstallation ... +
Aus einer Liste der installierten Pakete kann eines ausgewählt und deinstalliert werden. +
Siehe xref:server/configuration-tools#opsi-manual-configuration-tools-opsi-package-manager[Werkzeug 'opsi-package-manager': opsi-Pakete (de-)installieren]

* Verteilung opsi-client-agent ... +
Möchte man existierende Rechner zu opsi hinzufügen, muss der opsi-client-agent auf dem Zielrechner installiert werden. Wählt man die betreffenden Clients im configed aus und ruft diesen Befehl auf, werden die Client-Namen in das entsprechende Feld übernommen. Wenn der Befehl für mehrere Clients mit einem Aufruf ausgeführt werden soll, müssen die Login-Daten bei den beteiligten Rechnern gleich sein. +
Achtung: Das Skript zum Deployen der Client muss im Verzeichnis _/var/lib/opsi/depot/opsi-client-agent/_ liegen und den Namen _opsi-deploy-client-agent_ haben.
Genauere Informationen finden Sie im Handbuch 'opsi-getting-started' im Kapitel 'Erste Schritte'.

TIP: Einige Oberflächen beinhalten eine Auswahlkomponente für Pfade in der Verzeichnisstruktur. Wird der Button "Ermittle Unterverzeichnisse" betätigt werden alle Verzeichnisse bzw. Dateien aufgelistet, die in dem angegebem Pfad enthalten sind. Für weitere Ebenen muss der Button wiederholt betätigt werden. Diese Funktionalität befindet sich u.a. in der "Opsi-Rechte setzen" oder "Paket-Installation"-Oberfläche.

[[opsi-manual-configed-serverconsole-commandcontrol]]
=== Befehle definieren
Zusätzlich zu den vordefinierten Befehlen lassen sich eigene Serverkonsolenbefehle erstellen
bzw. verändern oder entfernen, die über Menüpunkte aufgerufen werden können.
Dabei ist zu beachten, dass unterschiedliche Linux-Systeme unter Umständen nicht die gleichen Kommandozeilenbefehle ausführen können. Deswegen muss der Administrator sicherstellen, dass die Befehle entsprechend dem adressierten Linux-System funktionieren.


._opsi-configed_: Befehle definieren
image::configed_serverkonsole-defcommands.png["opsi-configed: Befehle definieren", pdfwidth=90%]

Folgende Daten müssen bzw. können (gekennzeichnet durch ein "*") für einen Befehl angegeben werden:

* Menü-Text: +
Beim Erstellen eines Befehls _muss_ darauf geachtet werden, dass der Menütext noch nicht für einen anderen Befehl verwendet wurde. Wenn ein Menütext geändert werden soll, muss der Befehl mit dem Minus-Button gelöscht und ein neuer Befehl erstellt werden.

* Beschreibung*: +
Wird eine genauere Beschreibung hinterlegt, taucht diese als Tooltip-Text des Befehls auf.

* übergeordnetes Menü*: +
Legt fest, in welchem Menü der neue Befehl als Menüeintrag erscheinen soll. Bleibt das Feld leer, wird der Menüeintrag direkt dem Menü "Server-Konsole" zugeordnet.

* Position*: +
Die Position bestimmt die Reihenfolge (kleine Zahlen zuerst) der Menüpunkte insgesamt und damit innerhalb des jeweiligen Menüs.
// Zunächst wird nach Positionen sortiert, wobei die niedrigste Zahl als erstes unter dem Menüpunkt "Server-Konsole" angezeigt wird. Erst alle einzelnen Befehle, anschließend die immer vorhandene Menügruppe "opsi" und weitere (nach der Position geordnete) Menügruppen. Es lässt sich somit nur eine Ebene von Menügruppen unter der "Server-Konsole" erstellen.  +
Ist eine alphabetische Reihenfolge erwünscht, müssen alle Positionen identisch gesetzt sein (z.B. alle 0). Bleibt das Feld leer, wird standardmäßig die Position 0 vergeben.

* "sudo"-Rechte*: +
Wenn einer der Befehle in der Befehlsliste administrative Rechte benötigt, muss das Häkchen bei "Benötigt root-Rechte" gesetzt sein, dann werden die Befehle in der Liste automatisch um das Schlüsselwort "sudo" ergänzt.

* Befehlsliste: +
Bei der Befehlsliste müssen die Linux-Befehle zeilenweise eingetragen werden, damit sie sequentiell ausgeführt werden können.
Achtung: Der Befehl kann mittels Button direkt auf dem verbundenen SSH-Server getestet / ausgeführt werden, ohne ihn als Menüpunkt zu erstellen.

* Datenquellen* (für die Befehlsliste): +
Zusätzlich können Methoden als Datenquelle hinterlegt werden, d.h. vor Ausführung des Befehls werden Parameter mit dem Ergebnis einer Methode überschrieben. folgende Methoden sind möglich:
    - Interaktive Eingabe: +
    Es ist möglich, für die Befehle Parameter nicht fest vorzugeben, sondern für eine interaktive Eingabe zu kennzeichnen. Dies geschieht in der Form $$"<<<Dieser Text wird dem Benutzer angezeigt und durch die Benutzereingabe ersetzt>>>"$$ , wobei empfohlen wird, eine Beispieleingabe für den Parameter zum Benutzertext hinzuzuschreiben.
    - Ausgewählte Client-Namen / Ausgewählte Client-IP-Adressen
    - Ausgewählte Depot-Namen / Ausgewählte Depot-IP-Adressen
    - Configserver-Name
    - Verbundener SSH-Servername +
Hinweis: Außer für die "Interaktive Eingabe" kann die Rückgabe der Methoden formatiert werden, beispielsweise in eine kommaseparierte Liste.
In der Oberfläche kann die Datenquelle sowohl getestet, als auch an die im Feld der Befehlsliste markierten Stelle eingefügt werden.

._opsi-configed_: Befehl ausführen - Parameterabfrage
image::configed_serverkonsole-exec.png["opsi-configed: Befehl ausführen - Parameterabfrage", pdfwidth=90%]

TIP: -- Unter Linux lassen sich Befehle mithilfe von zwei kaufmännischen Unds ("&&") kombinieren. Dabei muss jedoch darauf geachtet werden, dass zum zweiten Befehl, falls benötigt ein sudo ergänzt wird, da dies nicht automatisch geschieht. Beispiel: Benötigt root-Rechte:"aktiviert" , Befehlsliste: "apt-get update --yes && sudo apt-get upgrade --yes". +
 -- Während der Ausführung lassen sich keine Benutzereingaben tätigen. Es ist notwendig, alle Eingaben über die Befehls\-parameter zu steuern (Beispiel: "--yes" -Option bei "apt-get upgrade")



[[opsi-manual-configed-validation-opsi-modules]]
== Validierungsstatus der opsi-Module

Im Menüpunkt _Hilfe_ kann unter _Validierungsstatus der opsi-Module_ der aktuelle Lizenzierungsstand der opsi-Module eingesehen werden.

._opsi-configed_: Validierungsstatus der opsi-Module
image::configed_validierung-opsi-module.png["opsi-configed: Validierungsstatus der opsi-Module", pdfwidth=90%]

In der Tabelle wird zu jedem Modul angezeigt, ob das Modul erworben wurde bzw. verfügbar ist.
Die grüne Spalte hebt den aktuellen Zeitraum hervor und zeigt an, für wie viele Clients das Modul aktuell lizenziert ist.
Jede Spalte zeigt den Stand ab dem jeweiligen Datum an.
Die Spalten mit Datum in der Zukunft stellen zukünftige Änderungen dar, z.B. wenn eine Lizenz ausläuft oder eine neue Lizenz gültig wird. +
Durch Auswählen der Checkbox 'Vollständiger zeitlicher Verlauf' kann man zusätzlich die Zustände in der Vergangenheit einsehen.

Im weiteren Teil des Fensters ist eine Legende zu den Warnungen und Warngrenzen zu finden. +
Es können drei verschiedene Warngrenzen konfiguriert werden, ab denen der User eine Warnung erhält.
Diese Warnungen sollen darauf aufmerksam machen, wenn die Lizenzgrenze (bald) erreicht ist oder wenn eine Lizenz (bald) ausläuft.
Die Warngrenze 'Clients Anzahl' legt die absolute Differenz der Clientzahl zu der lizenzierten Anzahl fest, ab der gewarnt werden soll.
Die Warngrenze 'Clients prozentual' legt die prozentuale Menge der Clientzahl zu der lizenzierten Anzahl fest, ab der gewarnt werden soll.
Die Warngrenze 'Tage bis Lizenzende' legt die Anzahl der verbleibenden Tage bis Lizenzende fest, ab denen gewarnt werden soll. +
Die Warngrenzen können in der Server-Konfiguration mittels der Configs _licensing.client_limit_warning_absolute_, _licensing.client_limit_warning_percent_ und _licensing.client_limit_warning_days_ bearbeitet werden.

Wenn eine Warngrenze für ein Modul überschritten wird, wird das entsprechende Feld in der Tabelle in gelb markiert.
Wenn für ein Modul nicht mehr genug Lizenzen existieren oder die Lizenz abgelaufen ist, wird das entsprechende Feld in rot markiert.
Dann muss eine neue Lizenz erworben werden. +
Beim Starten des opsi-configed wird auf existierende Warnzustände hingewiesen.

Im unteren Teil des Fensters befinden sich Informationen zu den Clients und den Kundendaten, für die die Lizenzen ausgestellt wurden. +
Der Checksum-Wert ist zum Abgleich, ob die Daten in der Umgebung mit den Daten bei uib übereinstimmen.

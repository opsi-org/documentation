////
; Copyright (c) uib GmbH (www.uib.de)
; This documentation is owned by uib
; and published under the german creative commons by-sa license
; see:
; https://creativecommons.org/licenses/by-sa/3.0/de/
; https://creativecommons.org/licenses/by-sa/3.0/de/legalcode
; english:
; https://creativecommons.org/licenses/by-sa/3.0/
; https://creativecommons.org/licenses/by-sa/3.0/legalcode
;
; credits: https://www.opsi.org/credits/
////

:Author:    uib GmbH
:Email:     info@uib.de
:Date:      24.10.2023
:Revision:  4.3
:toclevels: 6
:doctype:   book
:icons:     font
:xrefstyle: full

include::common:partial$opsi_terms.adoc[]

[[opsi-manual-configed]]
= Management-Oberfläche *opsi-configed*

Das Programm `opsi-configed` ist ein grafisches Interface, das per HTTPS mit dem opsi-Server kommuniziert und daher auf jedem Rechner läuft, der über dieses Protokoll Verbindung zum Server aufnehmen kann. 

[[opsi-manual-configed-preconditions]]
== Voraussetzungen

Die Management-Oberfläche `opsi-configed` benötigt `opsiconfd` 4.1 oder neuer (siehe Abschnitt xref:server:components/opsiconfd.adoc[Der Dienst *opsiconfd*]). Wenn Sie anstelle des opsi-Paketes die portable Java-Anwendung einsetzen möchten, ist eine aktuelle Java-Laufzeitumgebung erforderlich.

TIP: Wenn Sie eine virtuelle Maschine verwenden, achten Sie auf eine ausreichende Auflösung des virtuellen Bildschirms. `opsi-configed` benötigt mindestens eine Bildschirmauflösung von 1024{nbsp}x{nbsp}768 Pixeln. Für eine bessere Grafik und Bildschirmauflösung bzw. Maus- und Tastaturintegration installieren Sie am besten die VMware Tools oder die VirtualBox Gast-Erweiterungen.


== ab hier kürze ich und teile auf



[[opsi-manual-configed-depotconfiguration]]
== Depotkonfiguration

Im Modus Depotkonfiguration (vgl. <<opsi-manual-configed-mode-selection>>) öffnet sich der Tab _Depots_. Nach Auswahl eines Depotservers in der Drop-Down-Liste können Werte bearbeitet werden, die das Depot parametrisieren.

._opsi-configed_: Tab Depot-Konfiguration
image::opsi-configed-depotconfiguration.png["opsi-configed: Tab Depot-Konfiguration", pdfwidth=90%]


[[opsi-manual-configed-groupactions]]
== Gruppenaktionen

Mittels der Schaltfläche "Gruppenaktionen" (vgl. <<opsi-manual-configed-mode-selection>>)
wird ein entsprechendes Fenster für gruppenbezogene Funktionen geöffnet.

Im Moment wird nur eine Funktion angeboten, die für die opsi-localimage-Option interessant ist:

*  die Suche nach einem Betriebssystem, das auf allen PCs der selektierten Gruppe schon installiert war und daher zur Auswahl für die Inbetriebnahme (auf allen PCs der Gruppe) angeboten werden kann.

._opsi-configed_: Gruppenaktionen (für opsi-local-image)
image::configed_groupaction_localimage.png["opsi-configed: Gruppenaktionen (für opsi-local-image)", pdfwidth=90%]

[[opsi-manual-configed-packageactions]]
== Produktaktionen

Mittels der Schaltfläche "Produktaktionen"  (vgl. <<opsi-manual-configed-mode-selection>>)
wird ein entsprechendes Fenster für Produkt-/Paket-bezogene Aktionen geöffnet.

Im Moment stehen zwei Funktionen zur Verfügung:

*  Eine .opsi-Datei (ein opsi-Paket) kann ausgewählt werden bzw. der Pfad zu ihr eingegeben werden. Das Paket kann auf den opsi-Server hochgeladen werden; der standardmäßig vorhandene Netzwerk- (Samba-) Share opsi_workbench auf dem opsi-Server ist dabei der Default-Wert für das Zielverzeichnis auf dem Server. Schließlich wird bei Betätigen des Buttons versucht, das Paket mit einem Aufruf analog einem opsi-package-manager-Aufruf auf dem Server als Produkt zu installieren.

*  Die WinPE-Dateien bzw. die Installfiles für ein Windows-Produkt (ab Windows Vista) können in das Server-Produktverzeichnis (Share opsi_depot) hochgeladen werden, so dass die Windows-Produkte nicht mehr serverseitig angefasst werden müssen.

._opsi-configed_: Paket- bzw. Produktaktionen
image::configed_package-actions.png["opsi-configed: Produktaktionen", pdfwidth=90%]


[[opsi-manual-configed-serverconsole]]
== Server-Konsole

CAUTION: Einige der nachfolgend beschriebenen Configed-Funktionen stehen erst ab der python-opsi-Version 4.0.7.38 zur Verfügung.
Dazu zählt vor allem die Befehlsbearbeitung (<<opsi-manual-configed-serverconsole-commandcontrol>>) sowie
die Ausführung der darüber hinterlegten Befehle im configed.

Mit der Version 4.0.7.5 ist der configed um einen neuen Hauptmenüeintrag erweitert,
die "Server-Konsole".
Damit wird die Möglichkeit geboten, vom configed aus
auch über eine SSH-Verbindung Aktionen auf dem opsi-server auszulösen.
Zum einen kann ein Terminal auf dem opsi-server gestartet werden,
zum anderen existieren Menüpunkte für vordefinierte Kommandozeilenbefehle.


._opsi-configed_: Menü: Server-Konsole
image::configed_serverkonsole.png["opsi-configed: Server-Konsole", pdfwidth=80%]

[[opsi-manual-configed-serverconsole-permissions]]
=== Verbindungsdaten und Berechtigungen

Wenn nicht anderes konfiguriert ist, wird versucht, für die SSH-Verbindung den im configed angemeldeten User und den verbundenen Configserver zu verwenden.

Ist dies nicht erwünscht, kann die Verbindung über einen SSH-Schlüssel (ggf. mit Passphrase) beim Start des Configeds gestartet werden.
Zu diesem Zweck existieren die folgenden Aufrufparameter für den configed:

* --ssh-key PATH:  z.B. --ssh-key /home/user/.ssh/id_rsa
* --ssh-passphrase PASSPHRASE: z.B. --ssh-passphrase meinpassword

Die Einstellungen lassen sich unter dem Menüpunkt  "Verbindungsdaten" ändern. +

Über Server-Hostparameter (User-Abschnitt) kann feingranular gesteuert werden,
welche der Menüpunkte sichtbar sind bzw. genutzt werden können.
Bei aktivierter Userroles-Funktionalität (vgl. <<opsi-manual-configed-hostproperties-userroles>>)
werden die Konfigurationen userspezifisch verwendet. Für einen neu angelegten User werden dabei
als Default-Werte zunächst die Werte von der allgemeinen User-Ebene gesetzt.

Folgende Configs existieren:

* user.{}.ssh.serverconfiguration.active: +
Aktiviert das Menü der SSH-Verbindungseinstellungen . (Default: false)

* user.{}.ssh.commandmanagement.active: +
Aktiviert die Bearbeitung von Menüeinträgen der SSH-konsolen-Befehle (Default: false)

* user.{}.ssh.menu_serverconsole.active: +
Gibt den Hauptmenüeintrag "Server-Konsole" als solchen frei. (Default: true)

* user.{}.ssh.terminal.active: +
Schaltet die SSH-Shell frei. (Default: true)

* user.{}.ssh.commands.active: +
Schaltet alle SSH-Menüeinträge frei, die hinterlegte Befehle darstellen. (Default: true)

[[opsi-manual-configed-serveractions-terminal]]
=== SSH-Terminal
Mithilfe des Terminals können Linux-Systembefehle auf dem verbundenen SSH-Server ausgeführt werden. +
Das Eingabe-Echo kann durch Sternchen (*) ersetzt werden (Passwort-Eingabe). +
Ein gestarteter Prozess lässt sich mit dem Button "Prozess/Verbindung beenden" oder durch "Strg+C" abbrechen. +
Wie von der Kommandozeile gewohnt, kann die "TAB"-Taste Befehle vervollständigen. Achtung: Pfade werden nicht vervollständigt - lediglich Linux-Systembefehle. +
Außerdem können Datenquellen aus dem configed-Kontext angegeben werden, die bei der Befehlsausführung durch die konkreten Werte ersetzt werden.
(Mehr zu dieser Funktionalität: <<opsi-manual-configed-serverconsole-commandcontrol>> - Punkt: Datenquellen)

._opsi-configed_: SSH-Terminal
image::configed_serverkonsole-terminal.png["opsi-configed: SSH-Terminal", pdfwidth=80%]

[[opsi-manual-configed-serveractions-parametercommands]]
=== Vordefinierte Befehle mit Eingabemasken
//Als vorgegebene Befehle befinden sich unter der Menügruppe "opsi" 4 Befehle, die während der Laufzeit unterschiedliche Parameter benötigen (gekennzeichnet durch "...").
Unter der Menügruppe "opsi" stehen einige Befehle unabhängig von den selbst definierbaren Befehlen mit einer eigenen Eingabe-Oberfläche zur Verfügung. Diese vereinfachen den Umgang mit diversen Skripten.

* Datei-Download ... +
Eine beliebige Datei kann aus dem Internet mittels "wget"-Befehl heruntergeladen und in ein Zielverzeichnis auf dem Server abgelegt werden. Anwendung findet der Befehl beispielsweise für konkrete opsi-Pakete von download.uib.de.

* Erstellung opsi-Produkt ... +
Voraussetzung für diesen Befehl ist ein opsi-utils-Paket mit der Version >=4.0.7.7.
Über diesen Menüpunkt kann dann, mit Angabe eines Server-Verzeichnis, aus diesem ein opsi-Paket erstellt werden.
Außerdem können die in der Control-Datei gefundenen Versionen (Paket- und Produkt-Version) über einen Button angezeigt und überschrieben
sowie eine md5-Summe und/oder eine zsync-Datei erstellt werden.
Beim Ausführen wird eine .opsi-Datei gebaut.
Zwecks Installation auf dem Server bzw. Depot leitet der Button "Das neu erstellte Paket installieren" zum opsi-package-manager weiter.

* Opsi-Rechte setzen ... +
Dieser Menüpunkt bildet den opsi-Befehl opsi-set-rights ab. Nach der Möglichkeit einen bestimmten (optionalen) Pfad einzugeben in dem das Skript ausgeführt werden soll, wird nach dem root-Passwort gefragt und das Skript im seperaten Fenster ausgeführt.

* Paket-Installation ... +
Durch diesen Befehl können opsi-Pakete mittels "opsi-package-manager" auf allen Depots oder einem Depot installiert werden.
Dabei kann der Server-Pfad zum Paket angegeben werden, in dem sich das opsi-Paket befindet. +
Durch Auswahl eines Paketes aus dem Internet wird die Funktionalität des Befehls "Datei download ..." aufgegriffen und anschließend das heruntergeladene Paket auf dem Depot installiert.
Außerdem sind die Parameter "--update" und "--setup" des opsi-package-manager implementiert.
Sollen die zsync und md5-Dateien eines opsi-Paketes heruntergeladen werden, kann der Schalter "zsync- und md5 einschließen"  aktiviert werden.
Dann wird die url der Pakete entsprechend ergänzt und die zusätzlichen Dateien werden ebenfalls gezogen. +
Mehr zum opsi-package-manager finden Sie unter xref:server/configuration-tools#opsi-manual-configuration-tools-opsi-package-manager[Werkzeug 'opsi-package-manager': opsi-Pakete (de-)installieren]

* Paket-Deinstallation ... +
Aus einer Liste der installierten Pakete kann eines ausgewählt und deinstalliert werden. +
Siehe xref:server/configuration-tools#opsi-manual-configuration-tools-opsi-package-manager[Werkzeug 'opsi-package-manager': opsi-Pakete (de-)installieren]

* Verteilung opsi-client-agent ... +
Möchte man existierende Rechner zu opsi hinzufügen, muss der opsi-client-agent auf dem Zielrechner installiert werden. Wählt man die betreffenden Clients im configed aus und ruft diesen Befehl auf, werden die Client-Namen in das entsprechende Feld übernommen. Wenn der Befehl für mehrere Clients mit einem Aufruf ausgeführt werden soll, müssen die Login-Daten bei den beteiligten Rechnern gleich sein. +
Achtung: Das Skript zum Deployen der Client muss im Verzeichnis _/var/lib/opsi/depot/opsi-client-agent/_ liegen und den Namen _opsi-deploy-client-agent_ haben.
Genauere Informationen finden Sie im Handbuch 'opsi-getting-started' im Kapitel 'Erste Schritte'.

TIP: Einige Oberflächen beinhalten eine Auswahlkomponente für Pfade in der Verzeichnisstruktur. Wird der Button "Ermittle Unterverzeichnisse" betätigt werden alle Verzeichnisse bzw. Dateien aufgelistet, die in dem angegebem Pfad enthalten sind. Für weitere Ebenen muss der Button wiederholt betätigt werden. Diese Funktionalität befindet sich u.a. in der "Opsi-Rechte setzen" oder "Paket-Installation"-Oberfläche.

[[opsi-manual-configed-serverconsole-commandcontrol]]
=== Befehle definieren
Zusätzlich zu den vordefinierten Befehlen lassen sich eigene Serverkonsolenbefehle erstellen
bzw. verändern oder entfernen, die über Menüpunkte aufgerufen werden können.
Dabei ist zu beachten, dass unterschiedliche Linux-Systeme unter Umständen nicht die gleichen Kommandozeilenbefehle ausführen können. Deswegen muss der Administrator sicherstellen, dass die Befehle entsprechend dem adressierten Linux-System funktionieren.


._opsi-configed_: Befehle definieren
image::configed_serverkonsole-defcommands.png["opsi-configed: Befehle definieren", pdfwidth=90%]

Folgende Daten müssen bzw. können (gekennzeichnet durch ein "*") für einen Befehl angegeben werden:

* Menü-Text: +
Beim Erstellen eines Befehls _muss_ darauf geachtet werden, dass der Menütext noch nicht für einen anderen Befehl verwendet wurde. Wenn ein Menütext geändert werden soll, muss der Befehl mit dem Minus-Button gelöscht und ein neuer Befehl erstellt werden.

* Beschreibung*: +
Wird eine genauere Beschreibung hinterlegt, taucht diese als Tooltip-Text des Befehls auf.

* übergeordnetes Menü*: +
Legt fest, in welchem Menü der neue Befehl als Menüeintrag erscheinen soll. Bleibt das Feld leer, wird der Menüeintrag direkt dem Menü "Server-Konsole" zugeordnet.

* Position*: +
Die Position bestimmt die Reihenfolge (kleine Zahlen zuerst) der Menüpunkte insgesamt und damit innerhalb des jeweiligen Menüs.
// Zunächst wird nach Positionen sortiert, wobei die niedrigste Zahl als erstes unter dem Menüpunkt "Server-Konsole" angezeigt wird. Erst alle einzelnen Befehle, anschließend die immer vorhandene Menügruppe "opsi" und weitere (nach der Position geordnete) Menügruppen. Es lässt sich somit nur eine Ebene von Menügruppen unter der "Server-Konsole" erstellen.  +
Ist eine alphabetische Reihenfolge erwünscht, müssen alle Positionen identisch gesetzt sein (z.B. alle 0). Bleibt das Feld leer, wird standardmäßig die Position 0 vergeben.

* "sudo"-Rechte*: +
Wenn einer der Befehle in der Befehlsliste administrative Rechte benötigt, muss das Häkchen bei "Benötigt root-Rechte" gesetzt sein, dann werden die Befehle in der Liste automatisch um das Schlüsselwort "sudo" ergänzt.

* Befehlsliste: +
Bei der Befehlsliste müssen die Linux-Befehle zeilenweise eingetragen werden, damit sie sequentiell ausgeführt werden können.
Achtung: Der Befehl kann mittels Button direkt auf dem verbundenen SSH-Server getestet / ausgeführt werden, ohne ihn als Menüpunkt zu erstellen.

* Datenquellen* (für die Befehlsliste): +
Zusätzlich können Methoden als Datenquelle hinterlegt werden, d.h. vor Ausführung des Befehls werden Parameter mit dem Ergebnis einer Methode überschrieben. folgende Methoden sind möglich:
    - Interaktive Eingabe: +
    Es ist möglich, für die Befehle Parameter nicht fest vorzugeben, sondern für eine interaktive Eingabe zu kennzeichnen. Dies geschieht in der Form $$"<<<Dieser Text wird dem Benutzer angezeigt und durch die Benutzereingabe ersetzt>>>"$$ , wobei empfohlen wird, eine Beispieleingabe für den Parameter zum Benutzertext hinzuzuschreiben.
    - Ausgewählte Client-Namen / Ausgewählte Client-IP-Adressen
    - Ausgewählte Depot-Namen / Ausgewählte Depot-IP-Adressen
    - Configserver-Name
    - Verbundener SSH-Servername +
Hinweis: Außer für die "Interaktive Eingabe" kann die Rückgabe der Methoden formatiert werden, beispielsweise in eine kommaseparierte Liste.
In der Oberfläche kann die Datenquelle sowohl getestet, als auch an die im Feld der Befehlsliste markierten Stelle eingefügt werden.

._opsi-configed_: Befehl ausführen - Parameterabfrage
image::configed_serverkonsole-exec.png["opsi-configed: Befehl ausführen - Parameterabfrage", pdfwidth=90%]

TIP: -- Unter Linux lassen sich Befehle mithilfe von zwei kaufmännischen Unds ("&&") kombinieren. Dabei muss jedoch darauf geachtet werden, dass zum zweiten Befehl, falls benötigt ein sudo ergänzt wird, da dies nicht automatisch geschieht. Beispiel: Benötigt root-Rechte:"aktiviert" , Befehlsliste: "apt-get update --yes && sudo apt-get upgrade --yes". +
 -- Während der Ausführung lassen sich keine Benutzereingaben tätigen. Es ist notwendig, alle Eingaben über die Befehls\-parameter zu steuern (Beispiel: "--yes" -Option bei "apt-get upgrade")



[[opsi-manual-configed-validation-opsi-modules]]
== Validierungsstatus der opsi-Module

Im Menüpunkt _Hilfe_ kann unter _Validierungsstatus der opsi-Module_ der aktuelle Lizenzierungsstand der opsi-Module eingesehen werden.

._opsi-configed_: Validierungsstatus der opsi-Module
image::configed_validierung-opsi-module.png["opsi-configed: Validierungsstatus der opsi-Module", pdfwidth=90%]

In der Tabelle wird zu jedem Modul angezeigt, ob das Modul erworben wurde bzw. verfügbar ist.
Die grüne Spalte hebt den aktuellen Zeitraum hervor und zeigt an, für wie viele Clients das Modul aktuell lizenziert ist.
Jede Spalte zeigt den Stand ab dem jeweiligen Datum an.
Die Spalten mit Datum in der Zukunft stellen zukünftige Änderungen dar, z.B. wenn eine Lizenz ausläuft oder eine neue Lizenz gültig wird. +
Durch Auswählen der Checkbox 'Vollständiger zeitlicher Verlauf' kann man zusätzlich die Zustände in der Vergangenheit einsehen.

Im weiteren Teil des Fensters ist eine Legende zu den Warnungen und Warngrenzen zu finden. +
Es können drei verschiedene Warngrenzen konfiguriert werden, ab denen der User eine Warnung erhält.
Diese Warnungen sollen darauf aufmerksam machen, wenn die Lizenzgrenze (bald) erreicht ist oder wenn eine Lizenz (bald) ausläuft.
Die Warngrenze 'Clients Anzahl' legt die absolute Differenz der Clientzahl zu der lizenzierten Anzahl fest, ab der gewarnt werden soll.
Die Warngrenze 'Clients prozentual' legt die prozentuale Menge der Clientzahl zu der lizenzierten Anzahl fest, ab der gewarnt werden soll.
Die Warngrenze 'Tage bis Lizenzende' legt die Anzahl der verbleibenden Tage bis Lizenzende fest, ab denen gewarnt werden soll. +
Die Warngrenzen können in der Server-Konfiguration mittels der Configs _licensing.client_limit_warning_absolute_, _licensing.client_limit_warning_percent_ und _licensing.client_limit_warning_days_ bearbeitet werden.

Wenn eine Warngrenze für ein Modul überschritten wird, wird das entsprechende Feld in der Tabelle in gelb markiert.
Wenn für ein Modul nicht mehr genug Lizenzen existieren oder die Lizenz abgelaufen ist, wird das entsprechende Feld in rot markiert.
Dann muss eine neue Lizenz erworben werden. +
Beim Starten des opsi-configed wird auf existierende Warnzustände hingewiesen.

Im unteren Teil des Fensters befinden sich Informationen zu den Clients und den Kundendaten, für die die Lizenzen ausgestellt wurden. +
Der Checksum-Wert ist zum Abgleich, ob die Daten in der Umgebung mit den Daten bei uib übereinstimmen.

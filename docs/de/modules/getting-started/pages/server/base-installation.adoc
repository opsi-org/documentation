////
; Copyright (c) uib gmbh (www.uib.de)
; This documentation is owned by uib
; and published under the german creative commons by-sa license
; see:
; https://creativecommons.org/licenses/by-sa/3.0/de/
; https://creativecommons.org/licenses/by-sa/3.0/de/legalcode
; english:
; https://creativecommons.org/licenses/by-sa/3.0/
; https://creativecommons.org/licenses/by-sa/3.0/legalcode
;
; credits: https://www.opsi.org/credits/
////

:toc:

:Author:    uib gmbh
:Email:     info@uib.de
:Revision:  4.2
:Date:      22.03.2023
:doctype: book

include::common:partial$opsi_terms.adoc[]

[[opsi-getting-started-installation-base]]
= Installation

Dieses Kapitel stellt verschiedene Varianten zur Installation des opsi-Servers vor. Als Erstes erklärt es die <<opsi-getting-started-installation-base-vm>>, danach geht es um 
//<<opsi-getting-started-installation-base-docker>> und um
die <<opsi-getting-started-installation-base-packages>> unter Debian, Ubuntu, Univention Corporate Server (UCS), openSUSE/Suse Linux Enterprise Server (SLES), CentOS, Red Hat Enterprise Linux (RHEL), Alma Linux und Rocky Linux.

TIP: Als Alternative zum schnellen Einstieg empfehlen wir das Programm opsi-QuickInstall. Es richtet in wenigen Schritten über ein grafisches Setup-Programm oder auf der Kommandozeile einen opsi-Server unter Linux ein (siehe Kapitel xref:quickinstall[opsi-QuickInstall]).

NOTE: Falls Sie einen Proxy-Server zum Zugriff auf das Internet verwenden, denken Sie daran, diesen auch auf Ihrem opsi-Server einzutragen. Nutzen Sie dazu die Umgebungsvariablen `http_proxy` und `https_proxy`, wie in Kapitel xref:server/requirements[Voraussetzungen] beschrieben.

[[opsi-getting-started-installation-base-vm]]
== Inbetriebnahme der vorkonfigurierten virtuellen Maschine

Der opsi-Server hat vergleichsweise geringe Anforderungen an die Rechengeschwindigkeit. Daher ist es problemlos möglich, ihn als virtuelle Maschine zu installieren und betreiben. Wir haben zu diesem Zweck eine VM eingerichtet, die wir auf unserer link:https://uib.de/de/opsi/opsi-testen-download/[Website] zum Download anbieten.

Sie können die virtuelle Maschine unter VirtualBox oder VMware (link:https://www.vmware.com/de/products/workstation-player.html[VMware Workstation Player], link:https://www.vmware.com/de/products/esxi-and-esx.html[VMware ESXi]) betreiben.

[[opsi-getting-started-installation-base-vm-start]]
=== VM herunterladen und auspacken

Laden Sie die virtuelle Maschine herunter und entpacken Sie die Zip-Datei. In den meisten grafischen Arbeitsumgebungen gelingt das im jeweiligen Dateimanager mit einem Rechtsklick und _Hier entpacken_ o.{nbsp}Ä. Alternativ verwenden Sie ein Programm wie link:https://www.7-zip.de/[7-Zip] (Windows) oder das Kommando `unzip` unter Linux auf der Shell. Anschließend finden Sie die drei Dateien `opsi[...].vmdk`, `opsi[...].mf` und `opsi[...].ovf` im aktuellen Verzeichnis.

So importieren Sie die virtuelle Maschine:

*VMware Workstation Player*

* Wählen Sie den Menüpunkt _Open a Virtual Maschine_ und navigieren Sie im Dateiauswahldialog ins Verzeichnis mit den Dateien aus dem gerade entpackten Zip-File. 
* Wählen Sie die Datei mit der Endung `.ovf` aus. (Ggf. ändern Sie am unteren Rand des Dialogs den Typ auf _Virtual Machines (*vmx, *.ovf, *.ova)_).
* Nach einem Klick auf _Öffnen_ können Sie der Maschine einen Namen geben und den Ort auswählen.
* Klicken Sie abschließend auf _Import_.
* Sie können die neue VM nun über _Power On_ starten.

.VMware Workstation Player: Import der virtuellen Maschine
image::vmware-player-import.png["VMware Workstation Player: Import der virtuellen Maschine", pdfwidth=80%]

*ESXi-Server*

* Starten Sie den vSphere Client.
* Erstellen Sie einen neuen Rechner über _Datei_ / _OVF-Vorlage bereitstellen_ und navigieren dann zur `.ovf`-Datei.
* Klicken Sie auf _Öffnen_ und dann _Weiter_.
Erstellen Sie sich einen neuen Rechner über 'Datei' / 'OVF-Vorlage bereitstellen....' und die Beantwortung der Folge-Dialoge.
* Geben Sie einen Namen ein oder übernehmen Sie die Voreinstellung.
* Klicken Sie auf _Weiter_, um eine Übersicht aller Einstellungen zu erhalten. Über die Schaltfläche _Beenden_ starten Sie den Import.

*VirtualBox*

* Öffnen Sie _Datei_ / _Appliance importieren_.
* Navigieren Sie im Dateiauswahldialog zur `.ovf`-Datei und klicken _Öffnen_.
* Nach einem Klick auf _Weiter_ können Sie im folgenden Dialog die Einstellungen bearbeiten und beispielsweise den Namen, die Größe des Arbeitsspeichers usw. verändern.
* Klicken Sie abschließend auf _Importieren_.

.VirtualBox: Import der virtuellen Maschine
image::virtualbox-import.png["VirtualBox: Import der virtuellen Maschine", pdfwidth=80%]

[[opsi-getting-started-installation-base-vm-lang]]
=== VM booten und Sprache wählen

Booten Sie die neue virtuelle Maschine. Im ersten Dialog wählen Sie die Sprache des neuen opsi-Servers aus. Navigieren Sie mit [Tab] zum gewünschten Eintrag und drücken die Leertaste, um ihn zu markieren. Anschließend betätigen Sie wieder [Tab], bis Sie _Ok_ erreichen und drücken [Eingabe].

.Wählen Sie die Sprache für Ihren neuen opsi-Server aus.
image::1stboot-language-selection.png["Wählen Sie die Sprache für Ihren neuen opsi-Server aus.", pdfwidth=80%]

Sie sehen nun die Meldung, dass das Installationsprogramm die Netzwerkeinstellungen des opsi-Servers anpasst. Bestätigen Sie das mit [Eingabe].

TIP: Je nach Umgebung und Virtualisierungs-Software kann es vorkommen, dass Systemmeldungen im Fenster auftauchen und die Dialoge des Installationsskripts unlesbar werden. Mit der Tastenkombination [Strg]+[L] setzen Sie die Anzeige zurück.

[[opsi-getting-started-installation-base-vm-1stboot]]
===  Erster Start

Das Skript `1stboot.py`, das beim ersten Booten der Appliance automatisch startet, unterstützt Sie bei der Konfiguration des Netzwerks. Sie können das Skript jederzeit zu einem späteren Zeitpunkt über `/usr/local/bin/1stboot.py` auf der Kommandozeile aufrufen und die Einstellungen anpassen. Die Logdatei von `1stboot.py` ist `/var/lib/1stboot/1stboot.log`.

WARNING: `1stboot.py` eignet sich nicht, um einen konfigurierten {opsi-Server} nachträglich umzubenennen!

.Das Skript `1stboot.py` unterstützt Sie bei der Netzwerkkonfiguration.
image::1st-startup-mask.png["Das Skript `1stboot.py` unterstützt Sie bei der Netzwerkkonfiguration.", pdfwidth=80%]

Füllen Sie die folgenden Dialoge aus:

Servername:: Name diese opsi-Servers (ohne Domain), z.{nbsp}B. `opsiserver` oder `opsidepot`

Domain:: DNS-Domain (nicht Windows-Domäne, muss einen Punkt enthalten), z.{nbsp}B. `opsi.local` oder `meinefirma.local`

IP-Adresse:: Adresse dieses Servers, z.{nbsp}B. `192.168.1.50`

Netzmaske:: Netzmaske dieses Servers, z.{nbsp}B. `255.255.255.0`

Windows Workgroup/Domain:: Name der Windows-Domäne (nicht DNS-Domain), z.{nbsp}B. `OPSI`

Gateway:: IP-Adresse des Gateways, z.{nbsp}B. `192.168.1.1`

Proxy::	Adresse und Port des Proxy-Servers (falls erforderlich), z.{nbsp}B. `http://myuser:mypass@192.168.1.5:8080`

DNS:: IP-Adresse des Nameservers, z.{nbsp}B. `192.168.1.1`

Mail-Relay:: IP-Adresse des Mailservers, z.{nbsp}B. `192.168.1.1`

TFTP-Server:: Normalerweise ist das die IP-Adresse des opsi-Servers (Voreinstellung).

Passwort für root:: Das Passwort für den lokalen Administrator-Benutzer; das Kennwort geben Sie zweimal ein, um eventuelle Vertipper auszuschließen.

Passwort für adminuser:: Das Passwort für den lokalen opsi-Administrator; auch dieses Kennwort geben Sie zweimal ein.

Starten Sie die virtuelle Maschine anschließend neu.

[[opsi-getting-started-installation-base-vm-second-start]]
=== Zweiter Start

Nach dem Neustart melden Sie sich mit dem Benutzernamen `adminuser` und dem bei der Installation eingerichteten Kennwort an der grafischen Arbeitsumgebung an. Die virtuelle Maschine enthält drei schlanke Desktopumgebungen, die Sie über das Menü _Sitzung_ am oberen Rand auswählen.

Nach dem Einloggen startet der Browser Firefox und öffnet eine Seite mit weiterführenden Links zum Handbuch, zu unserem Forum (Community-Support), zum opsi-Wiki und zum professionellen uib-Support.

.Die grafische Arbeitsumgebung auf dem opsi-Server
image::opsiserver_start_gui.png["Die grafische Arbeitsumgebung auf dem opsi-Server", pdfwidth=80%]

NOTE: Wenn die Meldung erscheint, dass keine Netzwerkverbindung verfügbar ist, kann das mit der besonderen Konfiguration der virtuellen Appliance zusammenhängen. Bevor Sie nach Fehlern suchen, starten Sie den Server am besten einmal neu. Dazu klicken Sie entweder auf den Ausschaltknopf im Startmenü oder geben das Kommando `reboot` in ein Terminalfenster ein.

[[opsi-getting-started-installation-base-vm-term]]
=== Auf der Kommandozeile arbeiten

Im weiteren Verlauf des Kapitels (und auch in den übrigen Kapiteln dieses Handbuchs) gibt es einige Befehle, die Sie über die Kommandozeile eingeben. Sie können das über eine Terminal-Anwendung direkt auf dem Server erledigen oder von einem anderen Rechner aus per SSH zugreifen. Unter Linux und macOS dient dazu der Befehl `ssh`, den Sie in ein Termimal eingeben. Unter Windows verwenden Sie beispielsweise das Programm link:https://www.chiark.greenend.org.uk/~sgtatham/putty/[PuTTY]. Als Benutzernamen verwenden Sie `root` und authentifizieren sich mit dem bei der Installation angelegten Root-Passwort.

Auf dem opsi-Server gibt es unterschiedliche Möglichkeiten, ein Terminalfenster zu öffnen:

* Doppelklicken Sie das LXTerminal-Symbol in der grafischen Arbeitsoberfläche.

* Öffnen Sie das Startmenü und navigieren bis zu einer Terminal-Anwendung (Menü _Systemwerkzeuge_).

* Betätigen Sie die Tastenkombination [Alt]+[F2]; auf den meisten Desktops öffnet das einen Schnellstarter. Geben Sie `terminal` ein, um installierte Terminal-Programme aufzulisten, und wählen dann die gewünschte Anwendung aus.

TIP: Befehle aus diesem Handbuch sind so formatiert, dass Sie diese direkt per Copy{nbsp}&{nbsp}Paste in ein Terminalfenster übertragen können, sofern das Terminal-Programm das unterstützt.

Beispiele aus Konfigurationsdateien sind wie folgt formatiert:
[source,configfile]
----
depoturl = smb://smbhost/sharename/path
----

Befehle sind so hervorgehoben:
[source,prompt]
----
cd /tmp
ls -l
----

In `<spitzen Klammern>` stehen Bezeichnungen, die Sie durch ihre Bedeutung ersetzen müssen. So heißt die Dateifreigabe mit den opsi-Paketen z.{nbsp}B. `<opsi-depot-share>`. Auf einem realen Server liegt sie in der Regel in `/var/lib/opsi/depot`. Das Softwarepaket `<opsi-depot-share>/ooffice` befindet sich also unter `/var/lib/opsi/depot/ooffice`.

[[opsi-getting-started-installation-base-vm-update-server]]
=== opsi-Server aktualisieren

Bevor Sie den opsi-Server konfigurieren, bringen sie zunächst die Pakete des zugrundeliegenden Linux-Systems auf den aktuellen Stand. Die von uns bereitgestellte virtuelle Maschine basiert auf der letzten LTS-Version von Ubuntu und nutzt das Paketverwaltungs-Tool APT.

Falls Sie bereits mit APT vertraut sind, können Sie den Server mit den folgenden Kommandos in einem Terminal aktualisieren:

[source,prompt]
----
sudo apt update
sudo apt upgrade
sudo apt autoremove
----

Alternativ haben wir auf dem Desktop-Hintergrund ein Symbol namens _Update OS_ hinterlegt, das bei einem Doppelklick genau diese Befehle in einem Terminal ausführt.

NOTE: Falls Sie einen Proxy-Server zum Zugriff auf das Internet verwenden, konfigurieren Sie diesen über die Umgebungsvariablen `http_proxy` und `https_proxy` (siehe Kapitel xref:server/requirements[Voraussetzungen]). Zusätzlich tragen Sie den Proxy in die Konfigurationsdatei `/etc/apt/apt.conf` ein. Sie bearbeiten diese Datei als Benutzer `root` in einem Texteditor Ihrer Wahl, z.{nbsp}B. über den Befehl `nano /etc/apt/apt.conf`.

Tragen Sie in die Konfigurationsdatei Folgendes ein:

[source,prompt]
----
Acquire::http::proxy "http://<proxy-address>:<port>/";
Acquire::https::proxy "https://<proxy-address>:<port>/";
----

Ist eine Authentifizierung erforderlich, lauten die beiden Einträge so:

[source,prompt]
----
Acquire::http::proxy "http://<user>:<password>@<proxy-address>:<port>/";
Acquire::https::proxy "https://<user>:<password>@<proxy-address>:<port>";
----

Starten Sie danach den Server neu.

[[opsi-getting-started-installation-base-vm-update-opsi-product]]
=== Standard-Produkte einspielen

Danach installieren Sie die opsi-Standard-Produkte. Auch dazu haben wir einen Starter auf dem Desktop platziert. Doppelklicken Sie das Symbol _First package installation_ und geben Sie auf Aufforderung das Passwort für den Benutzer `adminuser` ein.

Alternativ rufen Sie in einem Terminal den folgenden Befehl auf:

[source,prompt]
----
sudo opsi-package-updater -v install
----

Das Kommando aktualisiert alle vorhandenen opsi-Pakete inklusive der Templates für Betriebssystem-Installationen aus den opsi-Repositorys.

Installieren Sie die Standard opsi-Produkte durch Doppelklick auf das Icon 'First package installation'. Bitte geben Sie das Passwort für den +adminuser+ ein.
Hierdurch werden automatisiert die aktuellen opsi-Pakete, incl. Templates für Betriebssysteminstallationen, aus den opsi-Repositorys geholt und auf dem Server installiert.

Für weitere Informationen siehe auch xref:server/minimal-products#opsi-getting-started-installation-config-get-essential-products[Einspielen der minimalen opsi-Produkte].


[[opsi-getting-started-installation-base-vm-start-configed]]
=== Management-Oberfläche starten

Die Management-Oberfläche können Sie durch einen Doppelklick auf das Icon 'opsi Management GUI' aufrufen.
Zur Beschreibung der Management-Oberfläche gehen Sie zu xref:opsiconfiged.adoc#firststeps-software-deployment-configed-start[Installation der Management-Oberfläche opsi-configed]

Damit ist die grundlegende Server-Konfiguration beendet.

Sie können nun fortfahren mit:

* xref:adding-clients.adoc#firststeps-software-deployment-client-integration[Integration vorhandener Windows-Clients in ops]

* xref:os-installation.adoc#firststeps-osinstall[Betriebssysteminstallation]

[[opsi-getting-started-installation-base-docker]]
== opsi als Docker-Container

Seit 2022 gibt es ein link:https://github.com/opsi-org/opsi-docker[Docker-Image], mit dem Sie einen Config-Server oder einen Depot-Server einrichten können. 

NOTE: Beachten Sie, dass ausschließlich WebDAV als Protokoll zur Kommunikation mit dem opsi-Depot zum Einsatz kommt; eine Samba-Unterstützung gibt es in dieser Variante (noch) nicht.

[[opsi-getting-started-installation-base-docker-quick]]
=== Quick Start

Um den Docker-Container in Betrieb zu nehmen, sind lediglich drei Befehle nötig:

[source,prompt]
----
git clone https://github.com/opsi-org/opsi-docker.git
cd opsi-docker/opsi-server
./opsi-server.sh start
----

[[opsi-getting-started-installation-base-docker-compose]]
=== Docker Compose

Unser Docker-Image setzt auf das Orchestrierungswerkzeug Docker Compose, das es ermöglicht, mehrere Container zu definieren, diese miteinander zu verbinden und auf einem beliebigen Docker Host auszuführen.

NOTE: Sie benötigen mindestens Docker Compose 1.17.0 und die Docker-Engine 17.09.0 oder neuer.

Die Datei `docker-compose.yml` definiert vier Dienste (Abschnitt `services`):

* `mysql`: installiert den Datenbankserver MariaDB
* `redis`: installiert die In-Memory-Datenbank Redis mit dem RedisTimeSeries-Modul
* `grafana`: spielt ein aktuelles Grafana ein
* `opsi-server`: installiert die Pakete `opsiconfd`, `opsipxeconfd`, `opsi-tftpd-hpa` und `opsi-utils` in der jeweils aktuellsten Version


[[opsi-getting-started-installation-base-packages]]
== Paketbasierte Installation

einleitendes Geplänkel

[[opsi-getting-started-installation-base-prerequires]]
=== Vorbereitungen


Der opsi-Server benötigt ab Version 4.2 Zugriff auf eine Redis- und eine Grafana-Instanz.
Sollen diese Dienste ebenfalls auf dem opsi-Server bereitgestellt werden, empfehlen wir das Paket 'opsi-server-full' für die Installation zu nutzen. Dieses Paket installiert und konfiguriert alles notwendige auf dem opsi-Server (im folgenden wird dies als Single-Server-Setup beschrieben). Diese Empfehlung gilt für alle unterstützten Betriebssysteme, außer bei Univention UCS. Auf diesen Systemen sollte nach wie vor das opsi4ucs Paket installiert werden.

NOTE: Das `opsi-server-full`-Paket installiert alle benötigten Komponenten zum Betrieb von opsi auf einem Server. +
Sollen gewisse Komponenten nicht installiert werden, beispielsweise wenn Redis, MySQL oder Grafana auf einem anderen Server laufen sollen, +
können stattdessen die Pakete `opsi-server` oder `opsi-server-expert` verwendet werden.

Wir empfehlen für Grafana die offiziellen Grafana-Repositorys zu nutzen:

==== Debian/Ubuntu/UCS

[source,bash]
----
sudo mkdir -p /usr/local/share/keyrings
REPO_URL=https://packages.grafana.com
REPO_KEY=/usr/local/share/keyrings/grafana.gpg
sudo apt install -y apt-transport-https software-properties-common curl gpg
curl -fsSL ${REPO_URL}/gpg.key | gpg --dearmor | sudo tee ${REPO_KEY} > /dev/null
echo "deb [signed-by=${REPO_KEY}] ${REPO_URL}/oss/deb stable main" > /etc/apt/sources.list.d/grafana.list
----

==== RHEL/CentOS/Alma Linux/Rocky Linux

[source,bash]
----
yum install wget
cd /etc/yum.repos.d
cat <<EOF > grafana.repo
[grafana]
name=grafana
baseurl=https://rpm.grafana.com/
repo_gpgcheck=1
enabled=1
gpgcheck=1
gpgkey=https://rpm.grafana.com/gpg.key
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
EOF
----

==== openSUSE/SLES

[source,bash]
----
zypper install wget
cd /etc/zypp/repos.d
cat <<EOF > grafana.repo
[grafana]
name=grafana
baseurl=https://rpm.grafana.com
repo_gpgcheck=1
enabled=1
gpgcheck=1
gpgkey=https://rpm.grafana.com/gpg.key
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
EOF
----

==== MySQL statt MariaDB

Möchten Sie statt `mariaDB` mysql verwenden, dann muss bei `opsi-setup --configure-mysql` ein Benutzer mit `mysql_native_password` angegeben werden. 

Um mysql_native_password bei dem Benutzer root zu aktivieren sind folgende Schritte notwendig: 

* `skip-grant-tables` in der mysql Konfiguration unter `[mysqld]` eintragen
* mysql Service neustarten
* als root mit mysql -u root -p einlogen
* `flush privileges;` und
* `ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'NewPassword';` ausführen.
* `skip-grant-tables` wieder entfernen und Service neustarten



[[opsi-getting-started-installation-base-deb]]
=== Installation unter Debian/Ubuntu

In diesem Abschnitt wird davon ausgegangen, dass Sie mit dem Debian-Paketsystem vertraut sind (Informationen zu diesem Thema finden Sie in den einschlägigen Büchern, in den man-pages oder unter link:https://www.debiananwenderhandbuch.de/[debiananwenderhandbuch.de]).

IMPORTANT: Beachten Sie unbedingt die xref:server/requirements.adoc#opsi-getting-started-requirements[Voraussetzungen] und <<opsi-getting-started-installation-base-prerequires,Vorbereitung>>!

Wir empfehlen zunächst folgende Installationen:

[source,bash]
----
apt install host pigz apt-transport-https software-properties-common curl gpg
mkdir -p /usr/local/share/keyrings
----

Weiterhin muss Samba installiert sein:

[source,bash]
----
apt install samba samba-common smbclient cifs-utils
----

Um nun opsi zu installieren muss das opsi-Repository für apt eingetragen werden:

*Ubuntu 22.04 LTS _Jammy Jellyfish_:*
[source,bash]
[subs="attributes"]
----
REPO_URL=https://download.opensuse.org/repositories/home:/uibmz:/opsi:/4.2:/{release}/xUbuntu_22.04
REPO_KEY=/usr/local/share/keyrings/opsi.gpg
echo "deb [signed-by=${REPO_KEY}] ${REPO_URL}/ /" > /etc/apt/sources.list.d/opsi.list
curl -fsSL ${REPO_URL}/Release.key | gpg --dearmor | sudo tee ${REPO_KEY} > /dev/null
----

*Ubuntu 20.04 LTS _Focal Fossa_:*
[source,bash]
[subs="attributes"]
----
REPO_URL=https://download.opensuse.org/repositories/home:/uibmz:/opsi:/4.2:/{release}/xUbuntu_20.04
REPO_KEY=/usr/local/share/keyrings/opsi.gpg
echo "deb [signed-by=${REPO_KEY}] ${REPO_URL}/ /" > /etc/apt/sources.list.d/opsi.list
curl -fsSL ${REPO_URL}/Release.key | gpg --dearmor | sudo tee ${REPO_KEY} > /dev/null
----

*Ubuntu 18.04 LTS _Bionic Beaver_:*
[source,bash]
[subs="attributes"]
----
REPO_URL=https://download.opensuse.org/repositories/home:/uibmz:/opsi:/4.2:/{release}/xUbuntu_18.04
REPO_KEY=/usr/local/share/keyrings/opsi.gpg
echo "deb [signed-by=${REPO_KEY}] ${REPO_URL}/ /" > /etc/apt/sources.list.d/opsi.list
curl -fsSL ${REPO_URL}/Release.key | gpg --dearmor | sudo tee ${REPO_KEY} > /dev/null
----

*Debian 11 _Bullseye_:*
[source,bash]
[subs="attributes"]
----
REPO_URL=https://download.opensuse.org/repositories/home:/uibmz:/opsi:/4.2:/{release}/Debian_11
REPO_KEY=/usr/local/share/keyrings/opsi.gpg
echo "deb [signed-by=${REPO_KEY}] ${REPO_URL}/ /" > /etc/apt/sources.list.d/opsi.list
curl -fsSL ${REPO_URL}/Release.key | gpg --dearmor | sudo tee ${REPO_KEY} > /dev/null
----

*Debian 10 _Buster_:*
[source,bash]
[subs="attributes"]
----
REPO_URL=https://download.opensuse.org/repositories/home:/uibmz:/opsi:/4.2:/{release}/Debian_10
REPO_KEY=/usr/local/share/keyrings/opsi.gpg
echo "deb [signed-by=${REPO_KEY}] ${REPO_URL}/ /" > /etc/apt/sources.list.d/opsi.list
curl -fsSL ${REPO_URL}/Release.key | gpg --dearmor | sudo tee ${REPO_KEY} > /dev/null
----

Prüfen Sie ob der Import erfolgreich war:
[source,bash]
----
gpg /usr/local/share/keyrings/opsi.gpg 2>/dev/null
----

sollte unter anderem enthalten:
[source,bash]
----
pub   rsa2048 2017-09-30 [SC] [expires: 2023-11-09]
      2E98F7B5A5B2C8FE7F609705D1F933E6D8361F81
uid           home:uibmz:opsi OBS Project <home:uibmz:opsi@build.opensuse.org>
----

include::apt-proxy-config.adoc[]

Stellen Sie vor Installation der opsi-Pakete sicher, dass ihr Server einen gültigen FQDN besitzt (siehe: <<opsi-getting-started-requirements-software-dns-domainname>>). Führen Sie nun folgende Befehle aus um opsi auf dem Server zu installieren:

*Single-Server-Setup:*
[source,prompt]
----
apt update
apt install opsi-server-full
----

*Manuelles Setup:*
[source,prompt]
----
apt update
apt install redis-server redis-timeseries grafana mariadb-server
systemctl daemon-reload
systemctl enable grafana-server
systemctl start grafana-server
apt install opsi-server
apt install opsi-windows-support
----

Falls Sie bei der Installation von opsi-tftp-hpa nach dem Tftp-Basisverzeichnis gefragt werden, beantworten Sie diese Frage mit `/tftpboot`.

Da Sie opsi auf einer existierenden Maschine eingespielt haben, gehen wir davon aus, dass Ihre Netzwerkkonfiguration korrekt ist. +
Machen Sie daher mit dem Punkt <<opsi-getting-started-installation-config>> weiter.


[[opsi-getting-started-installation-base-ucs]]
=== Installation unter Univention Corporate Server (UCS)

//vielleicht ganz umschreiben

IMPORTANT: Beachten Sie unbedingt die xref:server/requirements.adoc#opsi-getting-started-requirements[Voraussetzungen] und <<opsi-getting-started-installation-base-prerequires,Vorbereitung>>!

Die Installation auf einem Univention Corporate Server ist sowohl über das dort vorhandene App Center als auch auf klassischem Wege über die von uib gepflegten Repositorys möglich.

Beides sind gleichwertige Installationsmöglichkeiten. Wir empfehlen pro Server nur jeweils eine davon zu verwenden.
Werden neue Betriebssystempakete veröffentlicht, so stehen diese bei der Verwendung der uib-Repositorys schneller zur Verfügung als über das App Center.
Bei der Verwendung des App-Center wird der Wechsel auf eine neue UCS-Version (bspw. von UCS 4.4 nach UCS 5) vom Betriebssystem blockiert, bis alle installierten Apps unter der neuen Betriebssystemversion zur Verfügung stehen.

Im Rahmen von opsi 4.2 wurde der UCS-Support den anderen Distributionen angepasst. Die Funktion von opsi4ucs übernimmt ab opsi 4.2 das opsi-server Paket und dessen Varianten.
Das opsi4ucs Paket existiert in opsi 4.2 als Transitionpaket, um die Migration von opsi 4.1 Installationen zu vereinfachen. Während des Upgradeprozesses wird das opsi4ucs Paket automatisch durch die opsi-server Pakete ersetzt.

Auf dem ersten {opsi-Server} in einer Umgebung wird das Backend zur Verwendung des vorhandenen MySQL-Servers konfiguriert.
Alle nachfolgenden Server werden in opsi als Depots registriert werden.

////
[[opsi-getting-started-installation-base-ucs-appcenter]]
=== Installation mittels Univention App-Center

Über das Univention App-Center steht eine automatisierte Installation des {opsi-server}s zur Verfügung.
Die Installations-App für opsi befindet sich in der UCS-Management-Oberfläche in der Kategorie 'System'.

Falls Sie ein Update einer vorhandenen opsi-Umgebung durchführen möchten, lesen Sie bitte auch das darauf folgende Kapitel.

Zur Installation des {opsi-server}s werden automatisch weitere Pakete installiert: 'opsi-tftpd-hpa', 'opsi-windows-support', 'univention-mariadb' bzw. 'univention-mysql'.

Falls ein existierender {opsi-server} entdeckt wird, so wird 'opsi-package-updater' so konfiguriert, dass er die Pakete von diesem Server bezieht.
Der 'opsi-package-updater' wird bei der Installation - nicht bei einer Aktualisierung - zum Einspielen der minimalen opsi-Produkte aufgerufen.
Im Rahmen eines Major- oder Minor-Update werden Paketaktualisierungen eingespielt.

Bitte beachten Sie, dass anschließend kein automatischer Transfer von Clients nach opsi stattfindet.
Mehr Informationen unter <<opsi-getting-started-installation-base-ucs-listener>>.

Die opsi-Installation auf einem UCS-Server über das Univention App-Center ist damit abgeschlossen.
Weiter geht es mit <<firststeps-software-deployment-client-integration>>


[[opsi-getting-started-installation-upgrade-appcenter]]
=== Update vorhandener opsi-Installation von einem UCS 3 auf UCS 4 (über App-Center)

Eine der wichtigsten Änderungen, die mit dem Update für opsi 4.0.5 gekommen ist, ist die Unterstützung der Gruppe 'opsifileadmins'. Diese Gruppe ersetzt in UCS zukünftig die Gruppe 'pcpatch'.
'Opsifileadmins' wurde zwar schon mit der Unterstützung von UCS 3.0 eingeführt, es wurde allerdings nur auf Installationen eingerichtet, die mit Samba 4 und den Univention Directory Services (Samba4-AD) installiert wurden.
Auf allen anderen Varianten und Rollen, wurde bisher die Gruppe als 'pcpatch' angelegt. +
Da dieser Umstand nicht nur im Installationshandling ein Problem darstellt, sondern auch Probleme bei möglichen Migrationen (besonders von Samba3 auf Samba4) verursachen kann, wird seit opsi 4.0.5 die Gruppe 'pcpatch' als 'opsifileadmins' angelegt.

WARNING: Um diese Anforderungen sauber in das Integrationspaket implementieren zu können, wird die Gruppe 'pcpatch', falls vorhanden, automatisch über das Integrationspaket in 'opsifileadmins' umbenannt.
Dies geschieht über das join-Skript. Falls Ihr Configserver auf einem 'Master' oder 'Backup' betrieben wird, wird das Join-Skript automatisch ausgeführt. +
 +
Der Hauptgrund für diese drastische Maßnahme ist, dass die manuelle Umbenennung dieser Gruppe nicht trivial ist, da es sich um eine primäre Gruppe handelt. Wir empfehlen vor dem Einspielen dieses Updates zu überprüfen, ob Ihre Gruppe noch 'pcpatch' heißt. Wenn dem so ist, sollte das Update - angefangen beim Configserver - auf allen Depotservern zeitnah eingespielt werden, da ansonsten der Betrieb der Multidepot Umgebung gestört wird. Wenn Ihre Gruppe schon 'opsifileadmins'
heißt, sollten keine Beeinträchtigungen auftreten. Dennoch wird empfohlen, nach dem Einspielen der Updates alle opsi-Server auf Funktion zu überprüfen.
////

[[opsi-getting-started-installation-base-ucs-manually]]
==== Manuelle opsi-Installation unter UCS (ohne App-Center)

Notwendige Vorbereitungen:

* Samba muss konfiguriert sein. Für den Einsatz auf einem Server in der Rolle 'Member' muss `univention-samba` anstatt `univention-samba4` zum Einsatz kommen.

* `univention-mariadb` oder `univention-mysql` muss installiert sein

* Soll die Maschine auch als DHCP-Server eingesetzt werden, muss der Daemon dhcpd konfiguriert und am Laufen sein.

Die Installation von opsi ist möglich auf den Rollen 'Master', 'Backup', 'Slave' und 'Member'.
Für die Installation auf einem 'Member' beachten Sie unbedingt <<opsi-getting-started-installation-base-ucs-member>>!

Die folgende Dokumentation geht von einer Installation auf der Rolle 'Master' mit Samba 4 aus.

CAUTION: Wird die Installation auf einem 'Slave' ausgeführt, muss dieser bereits gegenüber dem 'Master' gejoint und während der Grundinstallation Samba 4 installiert worden sein. +
Die UCS-Konfiguration wird überlicherweise auf dem 'Master' vorgenommen, während die Installation und Konfiguration von opsi auf dem 'Slave' geschieht.

Die klassischen Installationsvariante mit dem Benutzer: 'pcpatch' mit der primären Gruppe 'pcpatch' kann unter UCS nicht eingehalten werden. Da Samba4 den grundlegenden Restriktionen von Active-Directory unterliegt, sind Gruppen mit der gleichen Bezeichnung wie User (wie in Unix/Linux üblich) nicht mehr erlaubt.
Aus diesem Grund wurde für UCS 3 die neue Konfigurationsdatei `/etc/opsi/opsi.conf` eingeführt, über welche gesteuert wird, wie die Gruppe für den Samba-Zugriff auf die Freigaben bestimmt wird. Seit UCS 3 wird über diese Datei der Gruppenname 'pcpatch' umbenannt und heißt von nun an: 'opsifileadmins'.
Das bedeutet, dass die User, die Zugriffsrechte für die Freigaben von opsi erhalten müssen (opsi-Paketierer) nicht Mitglied der Gruppe 'pcpatch', sondern Mitglied der Gruppe 'opsifileadmins' sein müssen. Diese Besonderheit gilt nur für UCS und unterscheidet sich von den anderen Distributionen und in weiterführenden Kapiteln der opsi-Dokumentationen. Unter UCS wird der User 'pcpatch' als vollwertiger Domänenbenutzer angelegt.
Nähere Informationen über diese neue Konfigurationsdatei können Sie dem Handbuch entnehmen.

* Um opsi zu installieren, tragen Sie das entsprechende Repository ein:

*Univention UCS 4.4:*
[source,bash]
[subs="attributes"]
----
REPO_URL=https://download.opensuse.org/repositories/home:/uibmz:/opsi:/4.2:/{release}/Univention_4.4
REPO_KEY=/usr/local/share/keyrings/opsi.gpg
echo "deb [signed-by=${REPO_KEY}] ${REPO_URL}/ /" > /etc/apt/sources.list.d/opsi.list
curl -fsSL ${REPO_URL}/Release.key | gpg --dearmor | sudo tee ${REPO_KEY} > /dev/null
----


*Univention UCS 5.0:*
[source,bash]
[subs="attributes"]
----
REPO_URL=https://download.opensuse.org/repositories/home:/uibmz:/opsi:/4.2:/{release}/Univention_5.0
REPO_KEY=/usr/local/share/keyrings/opsi.gpg
echo "deb [signed-by=${REPO_KEY}] ${REPO_URL}/ /" > /etc/apt/sources.list.d/opsi.list
curl -fsSL ${REPO_URL}/Release.key | gpg --dearmor | sudo tee ${REPO_KEY} > /dev/null
----



Für die Installation führen Sie nun folgende Befehle aus:

*Single-Server-Setup:*
[source,bash]
----
univention-install opsi-server-full
----

*Manuelles Setup:*
[source,bash]
----
univention-install redis-server redis-timeseries grafana
systemctl daemon-reload
systemctl enable grafana-server
systemctl start grafana-server
univention-install opsi-server
----

Ist die Rolle des Zielsystems eine andere als 'Master' oder 'Backup', muss nun noch das opsi4ucs Join-Skript ausgeführt werden:

[source,bash]
----
univention-run-join-scripts
----

Unter der URL `https://<servername>:4447` finden Sie nun einen Link zur opsi Management Oberfläche.

Um den opsi-Konfigurations-Editor verwenden zu können, muss ein Benutzer Mitglied der Gruppe {opsi-admin-group} sein. Die Gruppenzugehörigkeit eines Users kann über Univention-Admin bearbeitet werden. Der Benutzer Administrator wird während der Installation automatisch in diese Gruppe aufgenommen.

Abschliessend muss noch im UDM unter dem Punkt Freigaben für die 'opsi_depot' -Freigabe unter Erweiterte Einstellungen -> Erweiterte Samba-Einstellungen: Die Option: 'follow symlinks' auf 'yes' gesetzt werden. Das gleiche sollte man am besten auch für die 'opsi_depot_rw' -Freigabe erledigen, damit später die Treiberintegration keine Probleme verursacht. Sollte sich das `/var/lib/opsi/depot` -Verzeichnis auf einer extra Partition oder Festplatte befinden, muss man noch zusätzlich für diese Freigaben die Option wide links auf 'yes' setzen.

Um sicher zu stellen, dass alle Einstellungen von opsi nun korrekt übernommen wurden, sollte man noch folgende Befehle ausführen:

[source,bash]
----
opsi-setup --init-current-config
opsi-set-rights
systemctl restart opsiconfd.service
systemctl restart opsipxeconfd.service
----

Bei samba4 handelt es sich um einen zentralen Dienst, daher wird dieser nicht automatisch vom Paket neugestartet, sondern muss nachträglich manuell durchgeführt werden. Nach dem Neustart von samba kann es zu einer kleinen Verzögerung beim Zugriff auf die neuen Freigaben kommen, wir bitten dies zu berücksichtigen.

Da es keinen direkten Kontakt zwischen Univention-LDAP und dem opsi-Backend gibt, müssen alle Clients erst im LDAP über udm angelegt werden und danach nochmal mit opsi im opsi-System mit allen Informationen (insbesondere der MAC-Addresse) angelegt werden. Das Löschen des Clients im Univention-LDAP sorgt nicht dafür, dass der Client unter opsi auch gelöscht wird.
Dieses Problem wird in  <<opsi-getting-started-installation-base-ucs-listener>> genauer beleuchtet.

Da Sie opsi auf einer existierenden Maschine eingespielt haben, gehen wir davon aus, dass Ihre Netzwerkkonfiguration korrekt ist. +
Machen Sie daher mit dem Punkt <<opsi-getting-started-installation-config>> weiter.

WARNING: Die verwendeten Unix-Befehle in den folgenden Kapiteln beziehen sich auf Debian-Systeme, Sie müssen sie evtl. durch die entsprechenden UCS-Befehle ersetzen.

[[opsi-getting-started-installation-base-ucs-member]]
==== Hinweise zur opsi-Installation auf einem UCS-Server in der Rolle 'Member'

Die Installation von opsi auf einem Server in der Rolle 'Member' ist möglich.

Nach einer Installation muss sicher gestellt werden, dass der für den Depotzugriff verwendete Benutzer mitsamt Domäne aufgeführt ist.
Dazu muss der Hostparameter `clientconfig.depot.user` kontrolliert werden.
Ist die Domäne `backstage`, so muss der Wert `backstage\pcpatch` lauten. Lautet er `memberserver\pcpatch`, so muss der Wert korrigiert werden.

Das Setzen des Kennworts für den Benutzer `pcpatch` über `opsi-admin` scheitert auf Grund der fehlenden AD-Schreibberechtigungen eines 'Member'-Servers.
Daher muss die Änderung des Kennworts des technischen Benutzers `pcpatch` *zusätzlich* auf einem Server mit Schreibrechten im AD vorgenommen werden - ein 'Master', 'Backup' oder 'Slave'.


[[opsi-getting-started-installation-base-ucs-pxepolicy]]
==== Konfiguration des PXE-Boot für Betriebssysteminstallationen

Wenn der PXE-Boot für die Betriebssysteminstallation eingesetzt werden soll, muss der DHCP-Dienst auf dem entsprechenden UCS-System umkonfiguriert werden. Hier gibt es zwei Besonderheiten, die UCS von den anderen unterstützten Distributionen unterscheidet.

* Die Konfiguration wird nicht automatisch vorgenommen, da bei einer Installation von opsi in eine produktive UCS-Infrastruktur in der Regel schon diese Konfigurationen existieren.
* Ist der opsi-tftpd-hpa so konfiguriert, dass er nicht wie sonst das Verzeichnis `/tftpboot` als Basisverzeichnis nutzt, sondern `/var/lib/univention-client-boot`. Alle wichtigen Dateien vom {opsi-linux-bootimage} werden deshalb vom `/tftpboot` in das Basisverzeichnis verschobem. Dies hat den Nebeneffekt, dass die DHCP-Option: Filename `pxelinux.0` statt `linux/pxelinux.0` lauten muss.

Um die oben genannte Konfigurationen um zu setzen, muss im UCS-System eine Richtlinie erstellt werden. Diese Einstellung ist abhängig von den schon vorhandenen Richtlinien und müssen entsprechend umgesetzt werden. Wenn opsi auf einem UCS-Testsystem installiert wurde und keine Richtlinien entsprechend existieren, sollte erst geprüft werden ob der DHCP-Dienst installiert ist, wenn nicht muss das noch nachgeholt werden. Wenn der DHCP-Dienst schon installiert wurde, ist der einfachste Weg die Richtlinie in der UMC-Webschnittstelle (Univention Management Console) vom UCS-Server zu erstellen. Dazu wählt man den die Kategorie "Domäne" und darunter das Modul DHCP-Server. Als nächstes muss man den Service wählen (Bei einem Testsystem gibt es in der Regel nur einen Eintrag). In der folgenden Detailansicht wählt man den Menüpunkt Richtlinien. Die Richtlinie, die hier benötigt wird ist eine DHCP-Boot Richtlinie. Bei der Richtlinienkonfiguration wählt man nun den Defaulteintrag `cn=default-settings` (sollte der einzige Eintrag sein) und wählt bearbeiten. Unter Grundeinstellungen - DHCP Boot für die Option Bootserver die IP vom {opsi-server} ein und bei Boot-Dateiname muss `pxelinux.0` eingetragen werden.

WARNING: Wenn man die Richtlinie wie oben beschrieben setzt, gilt das für jedes Gerät, welches per DHCP von diesem Server bedient wird. Deshalb noch mal der Hinweis, dass diese Beschreibung nur für Evaluierer gedacht ist, die im Zuge von opsi auch ucs Testen. Bei Installationen in produktive UCS-Umgebungen sollte man diese Richtlinie nicht auf diese Weise setzen.

Optional lassen sich diese Einstellungen auch auf der Konsole mit dem udm-Kommando erledigen. Nähere Informationen dazu entnehmen Sie bitte der entsprechenden UCS-Dokumentation.


[[opsi-getting-started-installation-base-ucs-listener]]
==== LDAP-Daten nach opsi überführen

In einer opsi4ucs-Installation müssen die Windows-Clients erst im UDM angelegt werden und können erst im folgenden Schritt im {opsi-configed} erstellt werden.
Änderungen von Clients im UDM werden nicht an opsi weitergegeben.
Wenn ein Client zum Beispiel im LDAP eine neue Mac-Addresse bekommt, wird dies im opsi-System nicht bemerkt. Wenn man nun versucht ein Netboot-Produkt für diesen Client auf setup zu setzen, würde opsi die Bootkonfiguration mit der falschen Mac-Addresse im Bootsystem hinterlegen.

Die Lösung hierzu ist die Erweiterung 'opsi-directory-connector'.
Weitere Informationen hierzu enthält das Handbuch.


[[opsi-getting-started-installation-base-opensuse-sles]]
=== Installation unter openSUSE/SLES

IMPORTANT: Beachten Sie unbedingt die xref:server/requirements.adoc#opsi-getting-started-requirements[Voraussetzungen] und <<opsi-getting-started-installation-base-prerequires,Vorbereitung>>!


Notwendige Vorbereitungen:

* Samba muss installiert und konfiguriert sein.

* `mariadb-server` muss installiert sein.

* Soll die Maschine auch als DHCP-Server eingesetzt werden, muss der Daemon dhcpd konfiguriert und am Laufen sein.

Hinzufügen des opsi-Repositorys per zypper:

*openSUSE Leap 15.1:*
[source,prompt]
[subs="attributes"]
----
zypper addrepo https://download.opensuse.org/repositories/home:uibmz:opsi:4.2:{release}/openSUSE_Leap_15.1/home:uibmz:opsi:4.2:{release}.repo
----

*openSUSE Leap 15.2:*
[source,prompt]
[subs="attributes"]
----
zypper addrepo https://download.opensuse.org/repositories/home:uibmz:opsi:4.2:{release}/openSUSE_Leap_15.2/home:uibmz:opsi:4.2:{release}.repo
----

*openSUSE Leap 15.3:*
[source,prompt]
[subs="attributes"]
----
zypper addrepo https://download.opensuse.org/repositories/home:uibmz:opsi:4.2:{release}/openSUSE_Leap_15.3/home:uibmz:opsi:4.2:{release}.repo
----

*SLES 15SP1:*
[source,prompt]
[subs="attributes"]
----
zypper addrepo http://download.opensuse.org/repositories/home:uibmz:opsi:4.2:{release}/SLE_15_SP1/home:uibmz:opsi:4.2:{release}.repo
----

*SLES 15SP2:*
[source,prompt]
[subs="attributes"]
----
zypper addrepo http://download.opensuse.org/repositories/home:uibmz:opsi:4.2:{release}/SLE_15_SP2/home:uibmz:opsi:4.2:{release}.repo
----

*SLES 15SP3:*
[source,prompt]
[subs="attributes"]
----
zypper addrepo http://download.opensuse.org/repositories/home:uibmz:opsi:4.2:{release}/SLE_15_SP3/home:uibmz:opsi:4.2:{release}.repo
----



Nach dem Hinzufügen der Repositorys kann die Installation gestartet werden:

*Single-Server-Setup:*
[source,prompt]
----
zypper refresh
  Wollen Sie den Schlüssel (a)bweisen, ihm (t)emporär oder (i)mmer vertrauen? [a/t/i/?] (a): i
zypper -v install opsi-server-full
----

*Manuelles Setup:*
[source,prompt]
----
zypper refresh
zypper install redis-server redis-timeseries grafana
systemctl daemon-reload
systemctl enable grafana-server
systemctl start grafana-server
zypper -v install opsi-server
zypper -v install opsi-windows-support
----

Bitte stellen Sie sicher, daß Ihre Firewall-Konfiguration die folgenden Ports erlaubt:

* tftp: 69/UDP
* opsi: 4447/TCP und 4441/TCP

Falls Sie die Netzwerkkonfiguration mit Hilfe der Tools yast oder autoyast vorgenommen haben kann es sein, dass dieses Tool einen Eintrag in die Datei `/etc/hosts` einen Eintrag nach folgendem Muster angelegt hat:
[source,configfile]
----
127.0.0.2 <fqdn> <hostname>
----

Falls Sie opsi die Konfiguration des DHCP Servers überlassen wollen muss dieser Eintrag auf die öffentliche IP-Adresse geändert werden, über die der Server erreichbar ist.

Machen Sie mit dem Punkt xref:server/configuration.adoc#opsi-getting-started-installation-config[Konfigurieren des {opsi-Server}s] weiter.

WARNING: Die verwendeten Unix-Befehle in den folgenden Kapiteln beziehen sich auf Debian-Systeme. Sie müssen sie durch die entsprechenden Suse-Befehle ersetzen.


[[opsi-getting-started-installation-base-centos-rhel]]
=== Installation unter CentOS, RHEL, Alma Linux und Rocky Linux

Die Installation von opsi auf CentOS, Red Hat Enterprise Linux (RHEL), Alma Linux oder Rocky Linux unterscheidet sich nur durch das verwendete Repository.


IMPORTANT: Beachten Sie unbedingt die xref:server/requirements.adoc#opsi-getting-started-requirements[Voraussetzungen] und <<opsi-getting-started-installation-base-prerequires,Vorbereitung>>!

Im Fall von Red Hat Enterprise Linux müssen Sie sich beim Red Hat Network registrieren, um Zugriff auf alle benötigten Pakete in den Repositorys von Red Hat zu haben:

[source,prompt]
----
subscription-manager register
subscription-manager attach --auto
----

Notwendige Vorbereitungen:
////
* Wget installieren und MariaDB-Repository eintragen, da die Version in den offiziellen Repos stark veraltet ist.
+
[source,prompt]
----
yum install wget
cd /etc/yum.repos.d/
cat <<'EOF' > mariadb.repo
[mariadb-main]
name = MariaDB Server
baseurl = https://downloads.mariadb.com/MariaDB/mariadb-10.5/yum/rhel/$releasever/$basearch
gpgkey = file:///etc/pki/rpm-gpg/MariaDB-Server-GPG-KEY
gpgcheck = 1
enabled = 1
EOF
cd /etc/pki/rpm-gpg
wget https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
yum makecache
----
////

* Samba und Datenbankserver installieren:
+
[source,prompt]
----
yum install mariadb-server samba samba-client
----

* Samba und Datenbankserver konfigurieren:
+
[source,prompt]
----
systemctl start smb.service
systemctl start nmb.service
systemctl start mariadb.service
systemctl enable smb.service
systemctl enable nmb.service
systemctl enable mariadb.service
mysql_secure_installation
----

* Soll die Maschine auch als DHCP-Server eingesetzt werden, muss der Daemon dhcpd konfiguriert und am Laufen sein.

Hinzufügen des Repositorys:

*CentOS 8:*
[source,prompt]
[subs="attributes"]
----
cd /etc/yum.repos.d/
wget https://download.opensuse.org/repositories/home:uibmz:opsi:4.2:{release}/CentOS_8/home:uibmz:opsi:4.2:{release}.repo
yum makecache
----

*RHEL 8:*
[source,prompt]
[subs="attributes"]
----
cd /etc/yum.repos.d/
wget https://download.opensuse.org/repositories/home:uibmz:opsi:4.2:{release}/RHEL_8/home:uibmz:opsi:4.2:{release}.repo
yum makecache
----

*Alma 8:*
[source,prompt]
[subs="attributes"]
----
cd /etc/yum.repos.d/
wget https://download.opensuse.org/repositories/home:uibmz:opsi:4.2:{release}/AlmaLinux_8/home:uibmz:opsi:4.2:{release}.repo
yum makecache
----

*Rocky 8:*
[source,prompt]
[subs="attributes"]
----
cd /etc/yum.repos.d/
wget https://download.opensuse.org/repositories/home:uibmz:opsi:4.2:{release}/RockyLinux_8/home:uibmz:opsi:4.2:{release}.repo
yum makecache
----


Nach dem Hinzufügen der Repositorys kann die Installation gestartet werden:

*Single-Server-Setup:*
[source,prompt]
----
yum install opsi-server-full
----

*Manuelles Setup:*
[source,prompt]
----
yum makecache
yum install redis-server redis-timeseries grafana.x86_64
systemctl daemon-reload
systemctl enable grafana-server
systemctl start grafana-server
yum install opsi-server
yum install opsi-windows-support
----


Es kann vorkommen, dass eine Nachfrage zum Importieren des GPG-Schlüssel des Repositorys angezeigt wird.
Die Meldung ähnelt der folgenden:
[source,prompt]
----
   Importing GPG key 0xD8361F81 "home:uibmz OBS Project <home:uibmz@build.opensuse.org>" from http://download.opensuse.org/repositories/home:/uibmz:/opsi:/4.2:/stable/CentOS_8/repodata/repomd.xml.key
   Is this ok [y/N]: y
----
Bitte beantworten Sie diese Nachfrage mit 'y'.

Bitte stellen Sie sicher, dass Ihre iptables- und SELinux-Konfiguration die folgenden Ports erlaubt:

* tftp: 69/UDP
* opsi: 4447/TCP und 4441/TCP

Da Sie opsi auf einer existierenden Maschine eingespielt haben, gehen wir davon aus, dass Ihre Netzwerkkonfiguration korrekt ist. +
Machen Sie daher mit dem Punkt xref:server/configuration.adoc#opsi-getting-started-installation-config[Konfigurieren des {opsi-Server}s] weiter.


WARNING: Die verwendeten Unix-Befehle in den folgenden Kapiteln beziehen sich auf Debian-Systeme. Sie müssen sie durch die entsprechenden CentOS-/RHEL-/Alma-/Rocky-Befehle ersetzen.


TIP: Bei Problemen können Sie sich an den durch die Community bereitgestellten link:https://forum.opsi.org[Freien Support] wenden.

////
; Copyright (c) uib GmbH (www.uib.de)
; This documentation is owned by uib
; and published under the german creative commons by-sa license
; see:
; https://creativecommons.org/licenses/by-sa/3.0/de/
; https://creativecommons.org/licenses/by-sa/3.0/de/legalcode
; english:
; https://creativecommons.org/licenses/by-sa/3.0/
; https://creativecommons.org/licenses/by-sa/3.0/legalcode
;
; credits: http://www.opsi.org/credits/
////

:Author:    uib GmbH
:Email:     info@uib.de
:Date:      07.09.2023
:Revision:  4.3
:toclevels: 6
:doctype:   book
:icons:     font
:xrefstyle: full

include::common:partial$opsi_terms.adoc[]

[[firststeps-osinstall]]
= Windows mit opsi installieren

Dieses Kapitel beschreibt, wie Sie Windows auf einem bisher nicht mit einem Betriebssystem ausgestatteten Computer per opsi installieren. Als Client-Rechner eignen sich physische Computer oder virtuelle Rechner mit den folgenden Voraussetzungen:

* 2{nbsp}GByte RAM oder mehr
* Netzwerkkarte mit Netzboot-Unterstützung (das heißt, sie unterstützen das PXE-Protokoll zum Laden von Bootmedien via Netzwerk)

NOTE: Überprüfen Sie die Einstellungen im BIOS. Netzboot muss aktiviert sein und an erster Stelle der Bootoptionen stehen, damit Sie Windows per opsi installieren können.

Die Windows-Standardtreiber unterstützen virtuelle Hardware in der Regel gut. Wenn Sie Windows auf neueren physischen Rechnern installieren möchten, müssen Sie möglicherweise vorab zusätzliche Treiber integrieren (siehe Abschnitt <<firststeps-osinstall-driverintegration>>).

Um die in diesem Kapitel vorgestellten Schritte nachvollziehen zu können, sollten Sie vorher einen Windows-Client in die opsi-Umgebung aufgenommen haben (siehe Kapitel xref:clients:windows-client/adding-clients.adoc#add-new-clients[Neue Clients hinzufügen]).

[[firststeps-osinstall-fill-base-packages]]
== opsi-Produkte vervollständigen

Die von uns zur Installation von Windows angebotenen Netboot-Produkte sind lediglich Wrapper (Hüllen), denen ein entscheidender Teil fehlt: die Inhalte der Installations-Medien. Diese kopieren Sie selbst ins Verzeichnis `installfiles` (siehe Abschnitt <<firststeps-osinstall-structure-dirs>>) auf dem opsi-Depotserver, das in der Voreinstellung noch leer ist. 

Sie benötigen ebenfalls den Windows-Produktschlüssel. Diesen können Sie vor der Installation hinterlegen (siehe Abschnitt <<firststeps-osinstall-productkey>>), aber auch nach der Installation bei der Aktivierung des Windows-Systems eingeben.

[[firststeps-osinstall-fill-base-packages-nt6]]
== Vorbereitungen

Um Windows zu installieren, benötigen Sie ein Windows PE (WinPE), das als Live-System genutzt wird. Sie können das <<firststeps-osinstall-fill-base-packages-nt6-pe-opsi>> oder das <<firststeps-osinstall-fill-base-packages-nt6-pe-manual>>.

NOTE: Grundsätzlich ist die im WinPE verwendete Windows-Version unabhängig von der zu installierenden Windows-Version. An dieser Stelle ist vor allem wichtig, dass alle Treiber für Festplatten, Netzwerkkarten usw. verfügbar sind. Verwenden Sie ein 32-Bit PE für 32-Bit-Installationen und ein 64-Bit PE für 64-Bit-Installationen. Weitere Informationen finden Sie in diesem link:https://learn.microsoft.com/de-de/windows-hardware/manufacture/desktop/winpe-intro[Artikel] bei Microsoft Learn.

In jedem Fall benötigen Sie ein Windows Assessment and Deployment Kit (Windows ADK) und das WinPE-Add-on, das Sie auf einem Windows-Rechner (bevorzugt 64{nbsp}Bit) in den vorgeschlagenen Pfad unter `Program Files (x86)` installieren. Wählen Sie nur die _Windows-Vorinstallationsumgebung (Windows PE)_; Abhängigkeiten werden automatisch aufgelöst.

IMPORTANT: Die 32-Bit-Versionen von Windows PE sind ab dem ADK für Windows 11 (Version 22H2) nicht mehr in den WinPE-Add-ons enthalten. Die letzte unterstützte 32-Bit-Version ist im WinPE-Add-on für Windows 10 (Version 2004) verfügbar. Weitere Informationen: link:https://learn.microsoft.com/de-de/windows-hardware/get-started/adk-install[Herunterladen und Installieren des Windows ADKs]

[[firststeps-osinstall-fill-base-packages-nt6-pe]]
=== WinPE erstellen

Im einfachsten Fall haben Sie bereits einen Windows-Computer, auf dem der opsi-Client-Agent und das Windows ADK installiert sind. In dem Fall können Sie das <<firststeps-osinstall-fill-base-packages-nt6-pe-opsi>>. Als Alternative beschreibt der Abschnitt <<firststeps-osinstall-fill-base-packages-nt6-pe-manual>> den manuellen Weg.

[[firststeps-osinstall-fill-base-packages-nt6-pe-opsi]]
==== WinPE automatisch mit opsi erstellen

So gehen Sie vor, um das WinPE automatisch mit opsi zu erstellen:

. Installieren Sie das Paket `opsi-winpe` auf dem opsi-Server: +
`opsi-package-updater -v install opsi-winpe`
. Setzen Sie das Localboot-Produkt `opsi-winpe` für den Windows-Client auf `once`. Wählen Sie gegebenenfalls in den Produkt-Propertys rechts unten `x86` statt `x64` aus und speichern Sie die Änderungen über einen Rechtsklick / _Speichern_.
. Wenn Sie Treiber für Massenspeicher (Festplatten) integrieren wollen, lesen Sie den Abschnitt <<firststeps-osinstall-fill-base-packages-nt6-extendpe-opsi>>.
. Lösen Sie das Installations-Event für den Client aus, z.{nbsp}B. per Rechtsklick /  _on-demand_ oder durch einen Reboot. 
. Anschließend verschieben oder kopieren Sie den Inhalt des auf dem Client neu entstandenen Verzeichnisses `C:\winpe_<ARCH>\media\` ins bestehende Verzeichnis des zu installierenden Betriebssystems (`\\opsiserver\opsi_depot_rw\<Betriebssystem>\winpe\`).
. Zum Schluss führen Sie diesen Kommandozeilenbefehl auf dem opsi-Server aus: 

[source,console]
----
opsi-set-rights
----


[[firststeps-osinstall-fill-base-packages-nt6-pe-manual]]
==== WinPE von Hand erstellen (Windows ADK)

Step-by-Step

Manuelles Erstellen eines PE für Windows 10 & Windows 11 (ADK)

Die Befehle für 32- und 64-Bit sind nahezu identisch, nur müssen die Einträge *<ARCH>* mit entweder *x86* , *amd64* oder *ia64* ersetzt werden.

Führen Sie Start => Programme => Windows Kits => Windows ADK => "Umgebung für Bereitstellungs- und Imageerstellungstools" aus; eine Eingabe-Aufforderung erscheint (in dieser sind in der Folge benötigte Umgebungsvariablen gesetzt)

* WinPE kopieren:
[source,shell]
----
copype.cmd <ARCH> C:\winpe
----

* Image mounten/einhängen: +
[source,shell]
----
dism /Mount-Wim /WimFile:C:\winpe\media\sources\boot.wim /index:1 /MountDir:c:\winpe\mount
----

* Startnet.cmd ersetzen:
[source,shell]
----
echo c:\opsi\startnet.cmd > "C:\winpe\mount\Windows\System32\startnet.cmd"
----
(Hinweis: `c:\opsi\startnet.cmd` wird vom opsi-linuxbootimage in der `setup.py` erstellt nebst dem oben entfernten wpeinit-Aufruf).

* Image wieder aushängen:
[source,shell]
----
dism /Unmount-Wim /MountDir:c:\winpe\mount /Commit
----

* Den Inhalt von `C:\winpe\ISO` nach `/var/lib/opsi/depot/<productid>/winpe` kopieren. +
Rechte anpassen (z.B.):
[source,shell]
----
opsi-setup --set-rights /var/lib/opsi/depot/<productid>/winpe
----

////
===== Manuelles Erstellen eines PE für Windows 7 (WAIK)

Die Befehle für 32- und 64-Bit sind nahezu identisch, nur müssen die Einträge *<ARCH>* mit entweder *x86* , *amd64* oder *ia64* ersetzt werden.

Alles als Administrator aus der Eingabeaufforderung mit erweiterten Rechten ausführen.

* WinPE kopieren:
[source,shell]
----
"%ProgramFiles%\Windows AIK\Tools\PETools\copype.cmd" <ARCH> C:\winpe
----

* Image mounten/einhängen: +
[source,shell]
----
"%ProgramFiles%\Windows AIK\Tools\<ARCH>\imagex.exe" /mountrw "C:\winpe\winpe.wim" 1 "C:\winpe\mount"
----

* Startnet.cmd ersetzen:
[source,shell]
----
echo c:\opsi\startnet.cmd > "C:\winpe\mount\Windows\System32\startnet.cmd"
----
(Hinweis: `c:\opsi\startnet.cmd` wird vom opsi-linuxbootimage in der `setup.py` erstellt nebst dem oben entfernten wpeinit-Aufruf).

* Image wieder aushängen:
[source,shell]
----
"%ProgramFiles%\Windows AIK\Tools\<ARCH>\imagex.exe" /commit /unmount "C:\winpe\mount"
----

* Verschieben des fertigen WinPE (von dort werden mehrere Files auf den Server verschoben).
[source,shell]
----
move "C:\winpe\winpe.wim" "C:\winpe\ISO\sources\boot.wim"
----

* Den Inhalt von `C:\winpe\media`  nach `/var/lib/opsi/depot/<productid>/winpe` kopieren. +
Rechte anpassen (z.B.):
[source,shell]
----
opsi-setup --set-rights /var/lib/opsi/depot/<productid>/winpe
----
////
[[firststeps-osinstall-fill-base-packages-nt6-extendpe]]
=== WinPE erweitern

Manchmal ist es sehr nützlich, das Windows PE zu erweitern. Besonders bei Hardware, welche nicht per Default vom PE unterstützt wird.

[[firststeps-osinstall-fill-base-packages-nt6-extendpe-opsi]]
==== WinPE mit opsi erweitern

Während der automatischen Erzeugung des PE mit dem Produkt opsi-winpe gibt es auch die Möglichkeit Treiber zu integrieren. +
Integrieren Sie nur Treiber welche *unbedingt* notwendig für die Windowsinstallation sind (also ohne die die Windowsinstallation scheitert). Das sind überlicherweise Netzwerk- oder Storage-Treiber die beim Installationsvorgang benötigt werden.

Kopieren Sie die Treiber nach `\\opsiserver\opsi_depot_rw\opsi-winpe\drivers\` und setzten Sie danach die Dateirecht durch den Aufruf von:
[source,prompt]
----
opsi-set-rights /var/lib/opsi/depot/opsi-winpe
----

Danach folgen Sie dem Vorgehen wie hier beschrieben:
<<firststeps-osinstall-fill-base-packages-nt6-pe-opsi>>
Wenn alles funktioniert hat, wird der von Ihnen integrierte Treiber im Logfile erwähnt. Hier ein Beispiel mit einem VirtIO Massenspeicher-Treiber:
[source,opsiscript]
----
comment: Driver           : oem0.inf
comment: OriginalFileName : C:\winpe_amd64\mount\Windows\System32\DriverStore\FileRepository\viostor.inf_amd64_aa6c91b5db55ab62\
comment:                    viostor.inf
comment: Inbox            : False
comment: ClassName        : SCSIAdapter
comment: BootCritical     : True
comment: ProviderName     : Red Hat, Inc.
comment: Date             : 15-11-2022 00:00:00
comment: Version          : 100.92.104.22900
----

[[firststeps-osinstall-fill-base-packages-nt6-extendpe-manual]]
==== WinPE von Hand erweitern

//in SFS umwandeln,

Für Dell-Hardware gibt es Netzwerk- und Storage-Treiber, welche speziell für den PE-Einsatz empfohlen werden. Folgende Anleitung beschreibt, wie man ein PE mit Treibern erweitern kann. 
// Diese Anleitung funktioniert nur ab Windows 7. (Windows Vista beinhaltet nicht das benötige dism - Deployment Image Servicing and Management.)  
//
Weiterhin setzt diese Anleitung voraus, dass die Schritte im vorigen Kapitel zum Erstellen des PE ausgeführt wurden.


NOTE: Windows Automated Installation Kit wird für folgende Schritte nicht benötigt.

Herunterladen von Dell-PE-Treibersammlung. 
// Bitte beachten, dass für Windows 7 die WINPE 3.0 Treiber benötigt werden. 
//
Die heruntergeladene CAB-Datei muss nun lokal ausgepackt werden. Dies kann man mit 7zip oder aber mit dem Kommandozeilentool expand erledigen. Für die Übersichtlichkeit wird empfohlen ein Verzeichnis wie zum Beispiel dell-driver auf C: an zu legen und die CAB-Datei dort aus zu packen.


* Nun wird zunächst das Image untersucht. Als Administrator die Eingabeaufforderung starten und folgenden Befehl eingeben:

[source,shell]
----
dism /Get-WimInfo /WimFile:C:\winpe\ISO\sources\boot.wim
----

Aus der Ausgabe des Befehls braucht man für den nächsten Schritt den Index. Da in der Regel ein winpe aus einem einzigen Image besteht, sollte in der Regel der Index 1 immer funktioneren.

* Mit folgendem Befehl wird das Image gemountet:
[source,shell]
----
dism /Mount-Wim /WimFile:C:\winpe\ISO\sources\boot.wim /index:1 /MountDir:c:\winpe\mount
----

* Nun wird das PE mit den dafür ausgepackten Treibern erweitert:
[source,shell]
----
dism /Image:C:\winpe\mount  /Add-Driver /Driver:c:\dell-driver\winpe\x64 /Recurse
----

Für 32-Bit muss das `x64` durch `x86` ersetzt werden. Die Driver-CAB von Dell beinhaltet die Treiber für beide Architekturen.

NOTE: Wenn man nur einen Treiber integrieren möchte, kann man die Option `/Recurse` weglassen und statt ein Verzeichnis direkt die inf-Datei des Treibers angeben. Weiterhin ist es möglich mit dem Parameter `/ForceUnsigned` auch nicht signierte Treiber in ein PE zu integrieren.

* Zum Schluss wird das Image wieder ausgehängt und die Änderungen übernommen:
[source,shell]
----
dism /Unmount-Wim /MountDir:c:\winpe\mount /Commit
----

* Das Verzeichnis `C:\winpe\ISO` als Verzeichnis `winpe` nach `/var/lib/opsi/depot/<productid>/` kopieren. +
Rechte anpassen (z.B.):
[source,shell]
----
opsi-set-rights /var/lib/opsi/depot/<productid>/winpe
----


[[firststeps-osinstall-fill-base-packages-nt6-unattend]]
=== Die Datei *unattend.xml*

Für unbeaufsichtigte Installationen gibt es eine Steuerdatei namens `unattend.xml`. 
Sie finden diese im Verzeichnis `custom`, z.{nbsp}B. unter `/var/lib/opsi/depot/<productid>/custom`. 
Die von uns mitgelieferte Datei `unattend.xml` enthält Verweise auf die Eigenschaften der Netboot-Produkte, darunter Platzhalter für den Namen des Administrator-Accounts und des dazugehörigen Passworts.

Mögliche Modifikationen an dieser Datei sollten in diesem Verzeichnis und nicht im opsi Verzeichnis gemacht werden.

////
Dokumente zur Unattend.xml finden sich nach Installation des WAIK in
`c:\Program Files\Windows\Waik\docs\chms`
////

[[firststeps-osinstall-fill-base-packages-nt6-drivers]]
=== Treiber integrieren

Die Treiberintegration verläuft wie hier: <<firststeps-osinstall-driverintegration>> beschrieben.

[[firststeps-osinstall-fill-base-packages-nt6-installfiles]]
=== Installationsmedien bereitstellen

Kopieren der Installations-DVD nach +
`/var/lib/opsi/depot/<productid>/installfiles`
und passen Sie Rechte/Eigentümer an:

[source,shell]
----
opsi-set-rights /var/lib/opsi/depot/<productid>/installfiles
----

[[firststeps-osinstall-fill-base-packages-nt6-logfiles]]
=== Logdateien 

* `c:\Windows\Panther\setupact.log`: +
Log bis Ende Setup-Phase 4 (läuft unter WinPE)

* `c:\Windows\Panther\setupact.err`: +
Fehler-Log bis Ende Setup-Phase 4 (läuft unter WinPE)

* `c:\Windows\Panther\UnattendGC\setupact.log`: +
Log ab Specialize-Phase

* `c:\Windows\Panther\UnattendGC\setupact.err`: +
Fehler-Log ab Specialize-Phase

* `c:\Windows\System32\Winevt\Logs\*`

* `c:\Windows\ntbtlog.txt` (nur nach aktivierter Startprotokollierung)

[[firststeps-osinstall-productkey]]
== Windows-Produktschlüssel hinterlegen

Wenn Sie über das Modul opsi-Lizenzmanagement verfügen, können Sie die Windows Lizenzschlüssel über das Lizenzmanagement Modul verwalten. Lesen Sie dazu das Lizenzmanagement Handbuch bzw. das entsprechende Kapitel im opsi-Handbuch.
//wenn die Erweiterung genutzt wird, sieht das Netboot-Produkt das und wird von sich aus sagen: oh, es gibt ein Lizenzmanagement, ich frag den opsi-Server mal, ob es für mich als Netboot-Produkt einen Lizenzpool gibt und ob da Lizenzen liegen, das heißt, der würde anfragen: ich bin ein Win10, da gibt's nen Pool, den Key beziehe ich von da, dann interessiert auch nicht, was da im Produkt-Key steht, 

Haben Sie kein Lizenzmanagement oder wollen dieses nicht verwenden, gehen Sie wie folgt vor.

Wenn Sie bereits opsi-Clients eingerichtet haben, können Sie im opsi-Konfigurationseditor einen Windows-Produktschlüssel per Client eintragen:

* einen Client auswählen
* zum Tab Netboot-Produkte wechseln
* dort zB. das Produkt win10-x64 auswählen
* rechts in der Schalter-Liste in die Property-Zeile productkey gehen
* in das Value-Feld den Schlüssel eintragen und mit Klick auf  "+" hinzufügen
* durch Klick auf das "rote Häckchen" speichern und das Feld verlassen
* die Änderungen im Backend speichern ("rotes Häckchen" oben rechts).


Oder Sie vergeben einen Default für den Windows-Produktschlüssel für das komplette opsi-Depot, was ebenfalls über den opsi-Konfigurationseditor erledigt werden kann:

* im Konfigurationseditor die Depoteigenschaften auswählen (Kachel rechts oben)
* zum Tab Produkt-Defaultproperties wechseln
* dort zB. das Produkt win10-x64 auswählen
* rechts in der Schalter-Liste in die Property-Zeile productkey gehen
* in das Value-Feld den Schlüssel eintragen und mit Klick auf  "+" hinzufügen
* durch Klick auf das "rote Häckchen" speichern und das Feld verlassen
* die Änderungen im Backend speichern ("rotes Häckchen" oben rechts).

[[firststeps-osinstall-start]]
== Windows-Installation starten

Zum Starten einer Windows-Installation wählen Sie nun im opsi-configed den betreffenden Client aus, setzen unter dem Karteireiter 'Netboot-Produkte' für die gewünschten Betriebssystem (z.B. win10-x64) die Aktion auf 'setup' und klicken auf den roten Haken (der wieder grün wird).

Der Client sollte jetzt beim Booten ein Linux Bootimage übers Netz ziehen, in dem Sie nochmal die PC-Neu-Installation bestätigen müssen. Dann sollte alles automatisch weiter laufen, bis schließlich die Logon-Aufforderung des installierten Windows auf dem Bildschirm steht.

NOTE: Sollte nach dem Laden des Bootimages der Bildschirm schwarz bleiben oder die Netzwerkkarte nicht (korrekt) funktionieren, so muss für diese konkrete Hardware evtl. die Startparameter des Bootimages angepasst werden. +
Dies können Sie im 'opsi-configed' im Tab 'Hostparameter' am Eintrag 'opsi-linux-bootimage.append' tun. +
Details hierzu finden Sie im opsi Handbuch im Kapitel 'Netboot Produkte'.

WARNING: Vorsicht bei Clients mit einer über 2TB großen Festplatte. In einem nicht UEFI-System beträgt die maximale Partitionsgröße 2 Terabyte. Sofern eine größere Partition angelegt werden soll schlägt die Installation fehl. Dies ist technisch durch die standard Partitionstabelle bedingt. Sie müssen die Festplatte in zwei Partitionen aufteilen. Dies können Sie über die Product-Properties steuern. Oder Sie erwerben das UEFI-Modul, wodurch diese technische Limietierung entfällt.

[[firststeps-osinstall-structure]]
== Aufbau der Netboot-Produkte 

Dieser Abschnitt beschreibt den Aufbau der Windows-Netboot-Produkte zur unbeaufsichtigten Installation.

[[firststeps-osinstall-structure-dirs]]
=== Übersicht des Verzeichnisbaums

//ändern, von meinem Server übernehmen
[source]
----
<productid>-
           |-i386/				NT5 only: Installations files
           |-installfiles/		        NT6 only: Installations files
           |-winpe/				NT6 only
           |-opsi/				Scripte und Templates by opsi.org
           |  |-$oem$/					NT5 only: $oem$ gemaess MS
           |  |-postinst.d/				Scripte nach OS-Install by opsi.org
           |  !-unattend.(txt/xml).template		Template by opsi.org
           |-custom/				Scripte und Templates by customer
           |  |-$oem$/					NT5 only: $oem$ gemaess MS by customer
           |  |-postinst.d/				Scripte nach OS-Install by customer
           |  !-unattend.(txt/xml)			unattend.txt by customer
           |-drivers/				drivers Verzeichnis
        user   |  |-drivers/			drivers Verzeichnis
           |  |-pciids/				Symlinkbaum zu Treibern
           |  |-vendors/			Symlinkbaum zu Treibern
           |  |-classes/			Symlinkbaum zu Treibern
           |  |-usbids/				Symlinkbaum zu Treibern
           |  |-hdaudioids/			Symlinkbaum zu Treibern
           |  |-pci.ids				PCI-IDs DB
           |  !-usb.ids				USB-IDs DB
           |-setup.py				Installationsscript
           |-<productid>_<version>.control	Meta Daten (nur zur Info)
           |-<productid>.files			Dateiliste (automatisch erstellt)
           |-create_driver_links.py		Script zur Treiberverwaltung
           |-show_drivers.py			Script zur Treiberverwaltung
           !-extract_driver_pack.py		Script zur Treiberverwaltung
----

[[firststeps-osinstall-structure-files]]
=== Skripte und andere Dateien

* `setup.py` +
Dies ist das Installationsskript, welches vom Bootimage ausgeführt wird.
* `<productid>_<version>.control` +
enthält die Metadaten des Produkts, so wie sie vom Paketierer bereitgestellt wurden. Die Datei liegt hier nur zu Informationszwecken, d.h. Änderungen an dieser Datei haben keinerlei Auswirkungen auf das System.

* `<productid>.files` +
Diese Datei wird automatisch erzeugt und sollte nicht verändert werden.

* `create_driver_links.py` +
`show_drivers.py` +
//Links nach unten richtig setzen
Dies sind Scripte zur Treiberintegration, die im Kapitel <<firststeps-osinstall-driverintegration,Vereinfachte Treiberintegration in die automatische Windowsinstallation>>, näher erläutert werden.

[[firststeps-osinstall-structure-i386]]
=== Verzeichnisse *installfiles* und *winpe*

* `installfiles` +
Enthält den Inhalt der Installations-CD.

* `winpe` +
Enthält ein bootbares winpe Image.

[[firststeps-osinstall-structure-opsicustom]]
=== Verzeichnisse *opsi* und *custom*

Diese beiden Verzeichnisse enthalten Scripte und Konfigurationsdateien zur Steuerung der Betriebssysteminstallation. Während der Installation wirken diese Verzeichnisse zusammen, indem die Dateien aus custom Vorrang haben.

Das Verzeichnis opsi enthält Dateien, die mit Updates jederzeit überspielt werden können. Hier sollten also keine Änderungen vorgenommen werden. Für Anpassungen können Sie Änderungen im Verzeichnis custom vornehmen, welches bei Updates nicht überspielt wird.

Das Unterverzeichnis `postinst.d` enthält Scripte, welche nach der eigentlichen Installation des Betriebssystems über die `postinst.cmd` gestartet werden, um z.B. den opsi-client-agent zu installieren. Die Scripte werden dabei in alphabetischer Reihenfolge abgearbeitet. Um die Reihenfolge zu verdeutlichen, fangen die Dateinamen mit einer zweistelligen Nummer an (`10_dhcp.cmd`). Wollen Sie hier Erweiterungen vornehmen, so können Sie im Verzeichnis custom/postinst.d Scripte mit Nummern zwischen den vollen 10ern ablegen (`13_myscript.cmd`). Die vollen 10er sind für die Pflege durch opsi.org/uib reserviert. Das Script `99_cleanup.cmd` ist das letzte und endet mit einem Reboot.

[[firststeps-osinstall-structure-drivers]]
=== Verzeichnis *drivers*

Dieses Verzeichnis dient der Treiberintegration und ist im folgenden Kapitel beschrieben.

[[firststeps-osinstall-driverintegration]]
== Vereinfachte Treiberintegration 

Administriert man einen Pool von PCs, die Geräte besitzen, deren Treiber nicht in der Windows-Standardinstallation enthalten sind, so ist es meist sinnvoll, diese Treiber direkt in die Installation zu integrieren. Bei Netzwerkgeräten kann dies teilweise sogar unumgänglich sein, denn ein startendes Windows ohne Netzwerkkarte ist für den Administrator nicht ohne weiteres erreichbar.

Opsi unterstützt Sie durch eine Automatisierung der Treibereinbindung und vereinfacht so die Bereitstellung der Treiber. Dabei müssen die Treiber nur in dem korrekten Verzeichnis abgelegt werden. Durch den Aufruf eines Scripts werden dann die Treiberverzeichnisse durchsucht und ein Katalog erstellt, anhand dessen das Bootimage automatisch die richtigen Treiber erkennen und einbinden kann. Dabei können sowohl Standard-Treiber, USB-Treiber, HD-Audio-Treiber wie auch Treiber für Festplattencontroller (Textmode Treiber) abgelegt und automatisch eingebunden werden.

Damit die Treiber sofort bei der Windowsinstallation mit installiert werden, müssen Sie in einer bestimmten Form auf dem Server hinterlegt werden. Hierzu sind Treiberverzeichnisse geeignet, die eine '\*.inf'-Datei enthalten, die den Treiber für das Windows-Setupprogramm beschreibt. Irgendwelche in `setup.exe`, '*.zip' oder anders verpackten Treiber sind hier unbrauchbar. Mit dem Programm 'double driver' (http://www.boozet.org/dd.htm) können Sie von einem installierten Rechner die Treiber im geeigneten Format extrahieren.

Es stehen mehrere Ebenen zur Bereitstellung von Treibern zur Verfügung:

//(historische Aufzählung, Schulung nur noch: Treiber die über die Felder <vendor>/<model> der Inventarisierung automatisch den Rechnern zu geordnet werden, Reihenfolge ändern

* Allgemeine Treiber Pakete 
//1. Verfahren, doch nicht so gut?

* Treiber die zu Ihrer Hardware gehören aber nicht speziell zu geordnet sind
//preferred

* Treiber die manuell Rechnern zu geordnet sind
//Verzeichnis additional, 

* Treiber die über die Felder <vendor>/<model> der Inventarisierung automatisch den Rechnern zu geordnet werden.
//insbes. für Firmen gut, additional byAudit

Wie diese unterschiedlichen Ebenen verwendet werden können ist im folgenden beschrieben:

[[firststeps-osinstall-driverintegration-generaldrivers]]
=== Allgemeine Treiberpakete

Wenn die Hardwareausstattung sehr heterogen ist, kann es sinnvoll sein mit allgemeinen Treiberpaketen zu arbeiten. +
Allgemeine Treiber legen Sie ab unter `./drivers/drivers`. +

//.inf-Datei: 55 min Aufzeichnung
##Screenshots##

////
Solche allg. Treiber Pakete finden Sie http://driverpacks.net/ . +
Laden Sie die gewünschten Treiber Pakete in ein temporäres Verzeichnis herunter und entpacken die Treiberpakete mit:
[source,shell]
----
./extract_driver_pack.py <pfad zu dem temporären Verzeichnis mit den komprimierten driverpacks>
----
Hiermit werden die Treiber entpackt und in das Verzeichnis `./drivers/drivers/` abgelegt. +
Nachteil dieser Pakete ist, das sich hier auch Treiber finden welche zwar von der Beschreibung zu Ihrer Hardware passen aber nicht unbedingt mit Ihrer Hardware funktionieren. +
////
Treiber welche im Verzeichnis `./drivers/drivers/` liegen, werden anhand der PCI-Kennungen (bzw. USB- oder HD_Audio-Kennung) in der Beschreibungsdatei des Treibers als zur Hardware passend erkannt und in das Windows Setup mit eingebunden.

[[firststeps-osinstall-driverintegration-preferred]]
=== Spezielle Hardwaretreiber

Treiber, die zu Ihrer Hardware gehören, aber nicht speziell zugeordnet sind

Haben Sie nur wenige unterschiedliche Hardware zu unterstützen, so können Sie die Treiber bei den Herstellern suchen. +
Zusätzliche bzw. geprüfte Treiber gehören in jeweils eigene Verzeichnisse (Name und Tiefe der Verzeichnisstruktur egal) unterhalb des Verzeichnisses +
`./drivers/drivers/preferred`. +
Treiber welche im Verzeichnis `./drivers/drivers/preferred` liegen,
werden gegenüber den Treibern in `./drivers/drivers/` bevorzugt anhand der PCI-Kennungen (bzw. USB- oder HD_Audio-Kennung) in der Beschreibungsdatei des Treibers als zur Hardware passend erkannt und in das Windows Setup mit eingebunden. +
Finden sich z.B. zu eine PCI-ID in unterschiedlichen Treiber unter `preferred`, so kann dies zu Problemen bei der Treiber Zuordnung führen. In diesem Fall ist eine direkte Zuordnung der Treiber zu dem Client notwendig.

[[firststeps-osinstall-driverintegration-additional]]
=== Zusätzliche Treiber

Treiber, die manuell Rechnern zugeordnet sind

Zusätzliche Treiber, die unabhängig von ihrer Zuordnung bzw. Erkennung über die PCI- oder USB-IDs installiert werden sollen, gehören in jeweils eigene Verzeichnisse (Name und Tiefe der Verzeichnisstruktur egal) unterhalb des Verzeichnisses `./drivers/drivers/additional`. Über das Produkt-Property 'additional_drivers' können Sie einen oder mehrere Pfade von Treiberverzeichnissen innerhalb von `./drivers/drivers/additional` einem Client zu ordnen. Im Produkt-Property 'additional_drivers' angegebene Verzeichnisse werden rekursiv durchsucht und alle enthaltenen Treiber eingebunden. Dabei wird auch symbolischen Links gefolgt. Dies können Sie nutzen, um für bestimmte Rechner-Typen ein Verzeichnis zu erstellen (z.B. dell-optiplex-815).

Wird in den über 'additional_drivers' angegebenen Treiberverzeichnissen ein Treiber für ein vorhandenes PCI-Gerät (oder HD-Audio, USB) gefunden, so wird für dieses Gerät kein weiterer Treiber aus `drivers/preferred/` oder `drivers/` mehr eingebunden ('additional_drivers' ist sozusagen 'super-preferred'). Damit hat 'additional_drivers' die Funktion Treiber hinzuzufügen, welche über die normale Treibererkennung nicht gefunden würden.

[[firststeps-osinstall-driverintegration-byaudit]]
=== Treiber automatisch zuordnen


//Verweis opsi-win-driver-update bei Localboot-Produkte, ab min 1:20, 4.2-Branch

Treiber, die über die Felder `<vendor>/<model>` der Inventarisierung automatisch den Rechnern zugeordnet werden, ...

Der im vorigen Abschnitt beschriebene Mechanismus der direkten Zuordnung von Treibern zu Geräten, kann seit dem 2 Teil des Service Release opsi 4.0.2 automatisiert werden. Dazu wird in dem Verzeichnis `./drivers/drivers/additional/byAudit` nach einem Verzeichnisnamen gesucht der dem bei der Hardwareinventarisierung gefundenen 'Vendor' entspricht. In diesem 'Vendor' Verzeichnis wird nun nach einem Verzeichnisnamen gesucht, das dem bei der Hardwareinventarisierung gefundenen 'Model' entspricht. Wird ein solches Verzeichnis gefunden, so wird dieses Verzeichnis genauso behandelt, als wäre es über das Produkt-Property 'additional_drivers' manuell zugewiesen.

Dabei können seit opsi 4.0.5 die Treiber für einen opsi-Client über den opsi-configed im Reiter Hardwareinventarisiering bereitgestellt werden (vgl.:opsi-Handbuch Automatisierte Treiberintegration).

Die Abarbeitung im opsi-Linux-Bootimage erfolgt in der Reihenfolge

* `<vendor>/<model> (<sku>)`
* ohne Fund greift der Fallback auf `<system vendor>/<system model>`
* ohne Fund greift der Fallback auf `<motherboard vendor>/<motherboard model>`.

Einige Hersteller verwenden Modellbezeichnungen, die für diese Methode sehr ungünstig sind, da man einige Sonderzeichen wie / nicht in Datei- oder Verzeichnisnamen verwenden darf. Ein Beispiel dafür wäre als Modelbezeichnung: "5000/6000/7000". Ein Verzeichnis mit dieser Bezeichnung ist wegen den Sonderzeichen nicht gestattet. Seit der dritten Service Release opsi 4.0.3 werden deshalb folgende Sonderzeichen: < > ? " : | \ / * intern durch ein _ ersetzt. Mit dieser Änderung kann man oben genanntes schlechtes Beispiel als: "5000_6000_7000" anlegen und das Verzeichnis wird automatisch zu gewiesen, obwohl die Information in der Hardwareinventarisierung nicht der Verzeichnisstruktur enstprechen.


[[firststeps-osinstall-driverintegration-structure]]
=== Ablage im Verzeichnis *drivers*

Struktur des Treiber Verzeichnisses und Ablage der Treiber

[source,configfile]
----
/var/
  !-lib/
     !-opsi/depot/
        !-<productid>/
           !-drivers
              |-classes/		(Links auf Treiber über Geräteklassen)
              |-hdaudioids/		(Links auf HD-Audio Treiber)
              |-pciids/			(Links auf Treiber über PCI-Kennung)
              |-pci.ids			(PCI Datenbank)
              |-usbids/			(Links auf Treiber über USB-Kennung)
              |-usb.ids			(USB Datenbank)
              |-vendors/		(Links auf Treiber über Hersteller)
              !-drivers			(Platz für allg. Treiber Packs)
                 |-additional/		(Für manuell zugeordnete Treiber)
                    |-byAudit/		Modell spezifische Treiber welche
                       |-<vendor>		über die Hardwareinventarisierung
                          |-<model>		zugeordnet werden
                 |-buildin/		(Daten aus dem i386 Baum)
                 |-preferred/		(geprüfte Treiber)
                 |-exclude/		(ausgeschlossene Treiber)
                 !-mydriverpacks/	(Beispiel Treiber Pack)
----

[[firststeps-osinstall-driverintegration-processing]]
=== Priorität der Treiber

Abarbeitung der unterschiedlichen Ebenen der Treiberintegration

Als oberste Priorität werden alle Treiber eingebunden, welche über das Property 'additional_drivers' bzw. die über die Inventarisierungsdaten in `./drivers/drivers/additional/byAudit` gefunden werden. Im Rahmen der Einbindung von Treibern wird geprüft für welche der Hardware eines Geräts (anhand der PCI-,USB-,HDAudio-Kennungen) hierdurch ein Treiber bereit gestellt wurde. Nur für Geräte für die auf diese Weise noch kein Treiber bereitgestellt wurde wird über die nachfolgenden Methoden ein Treiber gesucht.

Für Geräte denen nicht über 'additional_drivers' (bzw. 'byAudit') ein Treiber zu geordnet wurde wird anhand der PCI Kennung (bzw. USB-, HDAudio-Kennung) ein passender Treiber gesucht und eingebunden.

'Einbindung' von Treiber bedeutet dabei:

* Der Treiber wird auf die lokale Festplatte nach `c:\drv\<num>` kopiert.

* Dem Windows Setup wird in der unattended Datei mitgeteilt, in den Verzeichnissen unterhalb von `c:\drv\` nach passenden Treibern zu suchen.

[[firststeps-osinstall-driverintegration-drivercheck]]
=== Treiber hinzufügen und prüfen

Nach jedem Hinzufügen eines Treibers oder jeden anderen Änderung im `./drivers/drivers` Verzeichnis (oder darunter) rufen Sie im Stammverzeichnis des netboot Produktes Verzeichnis folgenden Befehl auf, um die Rechte korrekt zu setzen:
[source,shell]
----
opsi-set-rights ./drivers
----

Wenn Sie Treiber in die Verzeichnisse `./drivers/drivers` oder `./drivers/drivers/preferred` abgelegt haben, dann
 rufen Sie das Script `./create_driver_links.py` auf. Dieses durchsucht die Verzeichnisse und erzeugt eine Reihe von Links anhand deren die Zuordnung der Treiber zu bestimmter Hardware (PCI-IDs, USB-IDs, HD-Audio-IDs) zu erkennen ist. Die Treiber aus dem preferred Verzeichnis werden von dem Script bevorzugt verwendet.

Das `setup.py` Script des Bootimages untersucht die Hardware des zu installierenden Computers und identifiziert die notwendigen Treiber. Diese werden dann auf die Festplatte kopiert und die unattend.xml entsprechend gepatcht.
////
Das Script `create_driver_links.py` durchsucht auch bei NT5 Produkten einmalig den 'i386' Baum und extrahiert die Inf-Dateien der von Windows mitgelieferten Treiber nach 'windows_builtin'. Sollten Sie am i386-Baum eine Änderung vornehmen (z.B. durch das Einspielen eines Servicepacks) so löschen Sie dieses Verzeichnis und führen `create_driver_links.py` erneut aus. Bei NT6 Produkten werden die Treiber welche sich im WinPE finden als 'windows_builtin' erkannt.
////

Liegt zu einem Client eine Hardware-Inventarisierung vor, so kann über den Befehl:
[source,shell]
----
./show_drivers.py <clientname>
----
ausgegeben werden, welche Treiber das Bootimage via PCI-IDs, USB-IDs, HD-Audio-IDs und 'additional_drivers' (bzw. 'byAudit') zur Installation auswählen würde und zu welcher Hardware noch kein Treiber bereit steht.

Kontrollieren Sie die Ausgabe von `show_drivers.py` um zu prüfen ob die gewünschten Treiber eingebunden werden.

Es kann vorkommen, das Treiberverzeichnisse von Herstellern Treiber für unterschiedliche Betriebssystemversionen ( z.B. Windows 7/8.1/10) oder Konfigurationen (SATA / SATA-Raid) enthalten. Das kann nicht automatisch unterschieden werden. Wenn Sie die Vermutung haben, das ein erkannter Treiber falsch ist, so verschieben Sie diesen Treiber in das Verzeichnis `drivers/exclude` und führen `create_driver_links.py` bzw. `show_drivers.py <clientname>` erneut aus. Treiber die in
`drivers/exclude` liegen werden bei der Treiberintegration nicht berücksichtigt.

Beispiel einer `show_drivers.py` Ausgabe für einen Client:

[source,shell]
----
./show_drivers.py pcdummy

PCI-Devices
   [(Standardsystemgeräte), PCI Standard-PCI-zu-PCI-Brücke]
      No driver - device directory  /var/lib/opsi/depot/<productid>/drivers/pciids/1022/9602 not found
   [ATI Technologies Inc., Rage Fury Pro (Microsoft Corporation)]
      Using build-in windows driver
   [(Standard-IDE-ATA/ATAPI-Controller), Standard-Zweikanal-PCI-IDE-Controller]
      /var/lib/opsi/depot/<productid>/drivers/drivers/D/M/N/123
   [Realtek Semiconductor Corp., Realtek RTL8168C(P)/8111C(P) PCI-E Gigabit Ethernet NIC]
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/realtek_gigabit_net_8111_8168b
   [IEEE 1394 OHCI-konformer Hostcontroller-Hersteller, OHCI-konformer IEEE 1394-Hostcontroller]
      No driver - device directory '/var/lib/opsi/depot/<productid>/drivers/pciids/197B/2380' not found
   [Advanced Micro Devices, Inc., AMD AHCI Compatible RAID Controller]
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/ati_raid_sb7xx
   [(Standard-USB-Hostcontroller), Standard OpenHCD USB-Hostcontroller]
      No driver - device directory '/var/lib/opsi/depot/<productid>/drivers/pciids/1002/4397' not found
   [ATI Technologies Inc, ATI SMBus]
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/ati_smbus

USB-Devices
   [(Standard-USB-Hostcontroller), USB-Verbundgerät]
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/brother_844x_pGerb
   [Microsoft, USB-Druckerunterstützung]
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/brother_844x_pGerb

Additional drivers
   [ati_hdaudio_azalia]
     /var/lib/opsi/depot/<productid>/drivers/drivers/additional/ati_hdaudio_azalia
----

Beispiel für einen Client mit 'additional_drivers':
[source,shell]
----
 ./show_drivers.py e5800
Manually selected drivers (additional)
   [hp_e5800]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp52852/Vista64/HDXHPAI3.inf]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp52852/Vista64/HDX861A.inf]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp52852/Vista64/HDXHPAI1.inf]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp52852/Vista64/HDXCPC.inf]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp52852/Vista64/HDXHPAI2.inf]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp50134/autorun.inf]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp50134/ibxHDMI/IntcDAud.inf]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp50134/HDMI/IntcHdmi.inf]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp50134/Graphics/kit24890.inf]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp50134/IIPS/Impcd.inf]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp54284/Realtek 64bit/hp64win7.inf]

PCI-Devices
   [8086:27C8]  Intel : Intel(R) N10/ICH7 Family USB Universal Host Controller - 27C8
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/R293337/WIN7
   [8086:27DA]  Intel : Intel(R) N10/ICH7 Family SMBus Controller - 27DA
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/R293337/WIN7
   [8086:27C9]  Intel : Intel(R) N10/ICH7 Family USB Universal Host Controller - 27C9
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/R293337/WIN7
   [8086:27DF]  Intel : Intel(R) ICH7 Family Ultra ATA Storage Controllers - 27DF
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/R293337/WIN7
   [8086:27CA]  Intel : Intel(R) N10/ICH7 Family USB Universal Host Controller - 27CA
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/R293337/WIN7
   [8086:2E30]  Intel : Intel(R) 4 Series Chipset Processor to I/O Controller - 2E30
      /var/lib/opsi/depot/<productid>/drivers/drivers/not_preferred/x64/C/Intel/1
   [8086:27CB]  Intel : Intel(R) N10/ICH7 Family USB Universal Host Controller - 27CB
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/R293337/WIN7
   [8086:2E32]  Intel Corporation : Intel(R) G41 Express Chipset
      Manually selected [hp_e5800] /var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp50134/Graphics
   [8086:27CC]  Intel : Intel(R) N10/ICH7 Family USB2 Enhanced Host Controller - 27CC
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/R293337/WIN7
   [8086:244E]  Intel : Intel(R) 82801 PCI-Brücke - 244E
      Using build-in windows driver
      This driver will not be integrated, because same device already integrated in: '/var/lib/opsi/depot/<productid>n/drivers/drivers/not_preferred/x64/C/Intel/1/dmi_pci.inf'
   [8086:27D0]  Intel : Intel(R) N10/ICH7 Family PCI Express Root Port - 27D0
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/R293337/WIN7
   [8086:27B8]  Intel : Intel(R) ICH7 Family LPC Interface Controller - 27B8
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/R293337/WIN7
   [8086:27D2]  Intel : Intel(R) N10/ICH7 Family PCI Express Root Port - 27D2
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/R293337/WIN7
   [8086:27C0]  Intel : Intel(R) N10/ICH7 Family Serial ATA Storage Controller - 27C0
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/R293337/WIN7
   [8086:27D8]  Microsoft : High Definition Audio-Controller
      No driver - device directory '/var/lib/opsi/depot/<productid>/drivers/pciids/8086/27D8' not found
   [10EC:8136]  Realtek : Realtek RTL8102E/RTL8103E-Familie-PCI-E-Fast-Ethernet-NIC (NDIS 6.20)
      Manually selected [hp_e5800] /var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp54284/Realtek 64bit

USB-Devices
   [0461:0010]  (Standardsystemgeräte) : USB-Eingabegerät
      No driver - vendor directory '/var/lib/opsi/depot/<productid>/drivers/usbids/0461' not found
   [0461:4D20]  (Standardsystemgeräte) : USB-Eingabegerät
      No driver - vendor directory '/var/lib/opsi/depot/<productid>/drivers/usbids/0461' not found
   [058F:6366]  Kompatibles USB-Speichergerät : USB-Massenspeichergerät
      No driver - vendor directory '/var/lib/opsi/depot/<productid>/drivers/usbids/058F' not found
   [0461:0010]  (Standard-USB-Hostcontroller) : USB-Verbundgerät
      No driver - vendor directory '/var/lib/opsi/depot/<productid>/drivers/usbids/0461' not found

HD-Audio-Devices
   [10EC:0662]  Realtek High Definition Audio
      Manually selected [hp_e5800] /var/lib/opsi/depot/<productid>/drivers/drivers/additional/hp_e5800/sp52852/Vista64
----

Beispiel für einen Client mit 'byAudit':
[source,shell]
----
 ./show_drivers.py pctry5detlef
Manually selected drivers (additional)
   [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi/pctry5detlef/Display/Radeon X300-X550-X1050 Series Secondary (Microsoft Corporation - WDDM)/atiilhag.inf]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi/pctry5detlef/Display/Radeon X300-X550-X1050 Series (Microsoft Corporation - WDDM)/atiilhag.inf]
      [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi/pctry5detlef/MEDIA/Realtek AC'97 Audio/oem21.inf]

PCI-Devices
   [1002:5B70]  ATI Technologies Inc. : Radeon X300/X550/X1050 Series Secondary (Microsoft Corporation - WDDM)
      Manually selected [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi] /var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi/pctry5detlef/Display/Radeon X300-X550-X1050 Series Secondary (Microsoft Corporation - WDDM)
      Multiple selected [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi] /var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi/pctry5detlef/Display/Radeon X300-X550-X1050 Series (Microsoft Corporation - WDDM)
   [10DE:0053]  (Standard-IDE-ATA/ATAPI-Controller) : Standard-Zweikanal-PCI-IDE-Controller
      No driver - device directory '/var/lib/opsi/depot/<productid>/drivers/pciids/10DE/0053' not found
   [10DE:005D]  (Standardsystemgeräte) : PCI Standard-PCI-zu-PCI-Brücke
      No driver - device directory '/var/lib/opsi/depot/<productid>/drivers/pciids/10DE/005D' not found
   [1022:1100]  AMD : AMD HyperTransport(tm)-Konfiguration
      Using build-in windows driver
   [10DE:0054]  (Standard-IDE-ATA/ATAPI-Controller) : Standard-Zweikanal-PCI-IDE-Controller
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/fsc__esprimo_p625/FTS_NVIDIASATAAHCIDRIVERVISTA64V103042MCP78__1026963/NVIDIA_SATA_AHCI_DRIVER_Vista64_V10.3.0.42_MCP78 (textmode capable)
   [1022:1101]  AMD : AMD-Adresszuordnungskonfiguration
      Using build-in windows driver
   [10DE:0055]  (Standard-IDE-ATA/ATAPI-Controller) : Standard-Zweikanal-PCI-IDE-Controller
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/fsc__esprimo_p625/FTS_NVIDIASATAAHCIDRIVERVISTA64V103042MCP78__1026963/NVIDIA_SATA_AHCI_DRIVER_Vista64_V10.3.0.42_MCP78 (textmode capable)
   [1022:1102]  AMD : AMD DRAM und HyperTransport(tm)-Nachverfolgungsmoduskonfiguration
      Using build-in windows driver
   [10DE:0057]  NVIDIA : NVIDIA nForce-Netzwerkcontroller
      Using build-in windows driver
   [1022:1103]  AMD : Sonstige AMD-Konfiguration
      Using build-in windows driver
   [10DE:0059]  Realtek : Realtek AC'97 Audio
      Manually selected [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi] /var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi/pctry5detlef/MEDIA/Realtek AC'97 Audio
   [10DE:005E]  NVIDIA : NVIDIA nForce4 HyperTransport-Brücke
      /var/lib/opsi/depot/<productid>/drivers/drivers/preferred/ga-ma78-pcbon4/chipset_win7-64/SMBUS
   [104C:8025]  Texas Instruments : OHCI-konformer Texas Instruments 1394-Hostcontroller
      No driver - device directory '/var/lib/opsi/depot/<productid>/drivers/pciids/104C/8025' not found
   [10DE:005A]  (Standard-USB-Hostcontroller) : Standard OpenHCD USB-Hostcontroller
      No driver - device directory '/var/lib/opsi/depot/<productid>/drivers/pciids/10DE/005A' not found
   [10DE:0050]  (StandardsystemgerÃ¤te) : PCI Standard-ISA-BrÃ¼cke
      No driver - device directory '/var/lib/opsi/depot/<productid>/drivers/pciids/10DE/0050' not found
   [10DE:005B]  (Standard-USB-Hostcontroller) : Standard PCI-zu-USB erweiterter Hostcontroller
      No driver - device directory '/var/lib/opsi/depot/<productid>/drivers/pciids/10DE/005B' not found
   [1002:5B60]  ATI Technologies Inc. : Radeon X300/X550/X1050 Series (Microsoft Corporation - WDDM)
      Manually selected [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi] /var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi/pctry5detlef/Display/Radeon X300-X550-X1050 Series Secondary (Microsoft Corporation - WDDM)
      Multiple selected [/var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi] /var/lib/opsi/depot/<productid>/drivers/drivers/additional/byAudit/nvidia/awrdacpi/pctry5detlef/Display/Radeon X300-X550-X1050 Series (Microsoft Corporation - WDDM)
   [10DE:0052]  NVIDIA : NVIDIA nForce PCI-Systemverwaltung
      Using build-in windows driver
   [10DE:005C]  (StandardsystemgerÃ¤te) : PCI Standard-PCI-zu-PCI-Brücke
      No driver - device directory '/var/lib/opsi/depot/<productid>/drivers/pciids/10DE/005C' not found

USB-Devices
   [1241:1111]  (StandardsystemgerÃ¤te) : USB-Eingabegerät
      No driver - vendor directory '/var/lib/opsi/depot/<productid>/drivers/usbids/1241' not found

HD-Audio-Devices
   No devices installed
----

TIPPS::
* Treiberverzeichnisname `NDIS1` sind Vista-Treiber ; `NDIS2` sind Win7-Treiber

* NDIS Versionen: +
(https://en.wikipedia.org/wiki/Network_Driver_Interface_Specification)

----
NDIS 6.0: Windows Vista
NDIS 6.1: Windows Vista SP1, Server 2008, Windows Embedded Compact 7, Windows Embedded Compact 2013
NDIS 6.20: Windows 7, Server 2008 R2
NDIS 6.30: Windows 8, Windows Server 2012
NDIS 6.40: Windows 8.1, Windows Server 2012 R2
NDIS 6.50: Windows 10, version 1507
NDIS 6.60: Windows Server 2016 and Windows 10, version 1607
NDIS 6.70: Windows 10, version 1703
NDIS 6.80: Windows 10, version 1709
NDIS 6.81: Windows 10, version 1803
NDIS 6.82: Windows 10, version 1809
NDIS 6.83: Windows 10, version 1903

//
NDIS 6.81: Windows 10, version 1803[8]
NDIS 6.82: Windows 10, version 1809 and Windows Server 2019[9]
NDIS 6.83: Windows 10, version 1903 and Windows Server 2022[10]
NDIS 6.84: Windows 10, version 2004[11]
NDIS 6.85: Windows 10, version 21H2[12]
NDIS 6.86: Windows 11, version 21H2[13]
----

* Manche Chipsatztreiber enthalten Beschreibungsdateien, welche sehr viel Hardware aufführen ohne hierzu tatsächlich Treiber zu liefern. Ein Beispiel hierfür ist z.B. die `cougar.inf` oder `ibexahci.inf` von Intel. Wird ein solches 'Pseudo-Treiber' Verzeichnis per 'additional_drivers' (bzw. 'byAudit') zu geordnet, so führt dies dazu, das die hier aufgeführte Hardware von der weiteren Suche nach Treibern im 'preferred' Verzeichnis ausgeschlossen wird.

* SATA-Treiber und SATA-RAID Treiber beziehen sich auf die selbe PCI-Kennung. Ein SATA-RAID Treiber wird aber mit einem Einzelplatten System nicht funktionieren.

* Kontrollieren Sie die Ausgabe von `./show_drivers.py` genau !

